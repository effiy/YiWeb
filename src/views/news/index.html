<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI智能助手，为您提供问答、数据分析、代码编写等多种智能服务">
    <meta name="keywords" content="AI, 智能助手, 数据分析, 代码编写, 生图创造, YiWeb">
    <meta name="author" content="liangliang">

    <title>YiWeb - 智能新闻助手</title>
    
    <!-- 页面样式 -->
    <link rel="stylesheet" href="../../views/news/index.css">
    <!-- 图标库 -->
    <link rel="stylesheet" href="../../libs/font-awesome/css/all.min.css" crossorigin="anonymous">

    <!-- Vue3 CDN -->
    <script src="../../libs/vue/vue.global.js"></script>
    <!-- Marked.js for Markdown rendering -->
    <script src="../../libs/marked/marked.min.js"></script>
    <!-- Mermaid.js for diagram rendering -->
    <script src="../../libs/mermaid/mermaid.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- 顶部搜索与分类区域 -->
        <search-header
            v-model:search-query="searchQuery"
            :categories="categories"
            :selected-categories="selectedCategories"
            :active-category="activeCategory"
            :sidebar-collapsed="sidebarCollapsed"
            :original-data="originalData"
            :available-views="categories"
            :current-view="activeCategory"
            @search-keydown="handleSearchKeydown"
            @clear-search="handleClearSearch"
            @toggle-category="handleToggleCategory"
            @toggle-sidebar="handleToggleSidebar"
            @open-rss-manager="handleOpenRssManager"
            @set-current-view="handleToggleCategory"
        ></search-header>
        
        <main class="main-content" role="main">
            <!-- 功能卡片区域 -->
            <section class="container">
                <div class="content-wrapper">
                    <!-- 主要内容区域 -->
                    <div class="main-column">
                        <!-- 新闻列表组件模板 -->
                        <news-list
                            v-show="activeCategory === 'all' || activeCategory === 'news'"
                            :loading="loading"
                            :error="error"
                            :current-date-display="currentDateDisplay"
                            :search-query="searchQuery"
                            :search-results="filteredNewsData"
                            :display-categories="displayCategories"
                            :selected-categories="selectedCategories"
                            :clicked-items="clickedItems"
                            :read-items="readItems"
                            :favorite-items="favoriteItems"
                            :has-news-data="hasNewsData"
                            @load-news-data="handleLoadNewsData"
                            @news-click="handleNewsClick"
                            @toggle-favorite="handleToggleFavorite"
                        ></news-list>
                    </div>
                    
                    <!-- 侧边栏区域 -->
                    <aside class="sidebar-navigation" :class="{ collapsed: sidebarCollapsed }" role="complementary" aria-label="日期导航">
                        <calendar
                            :current-date="currentDate"
                            :current-date-display="currentDateDisplay"
                            :current-date-subtitle="currentDateSubtitle"
                            :is-today="isToday"
                            :is-future-date="isFutureDate"
                            :sidebar-collapsed="sidebarCollapsed"
                            :calendar-date="calendarMonth"
                            :calendar-title="calendarTitle"
                            :is-current-month="isCurrentMonth"
                            :calendar-days="calendarDays"
                            :selected-date="selectedDate"
                            @go-to-previous-day="goToPreviousDay"
                            @go-to-next-day="goToNextDay"
                            @go-to-today="goToToday"
                            @previous-month="previousMonth"
                            @next-month="nextMonth"
                            @select-date="selectDate"
                        ></calendar>
                    </aside>
                </div>
            </section>
        </main>

        <div v-if="rssManagerOpen" class="edit-card-modal" role="dialog" aria-modal="true" aria-label="RSS 管理" @click.self="handleCloseRssManager">
            <div class="edit-card-content">
                <div class="edit-card-header">
                    <h3>
                        <i class="fas fa-rss" aria-hidden="true"></i>
                        <span>RSS 管理</span>
                    </h3>
                    <button type="button" class="edit-card-close" @click="handleCloseRssManager" aria-label="关闭 RSS 管理">×</button>
                </div>

                <div class="edit-card-form">
                    <div class="edit-card-section">
                        <div class="edit-card-section-header">
                            <h4 class="edit-card-section-title">抓取设置</h4>
                            <div class="rss-manager-actions">
                                <button type="button" class="btn btn-outline btn-small" @click="handleRefreshRssSchedulerStatus" :disabled="rssSchedulerLoading || rssManagerBusy" aria-label="刷新定时状态">
                                    <i v-if="rssSchedulerLoading" class="fas fa-spinner fa-spin" aria-hidden="true"></i>
                                    <i v-else class="fas fa-rotate" aria-hidden="true"></i>
                                    <span>刷新</span>
                                </button>
                                <button type="button" class="btn btn-primary btn-small" @click="handleRunRssFetchNow" :disabled="rssFetchingNow || rssManagerBusy" aria-label="立即抓取RSS">
                                    <i v-if="rssFetchingNow" class="fas fa-spinner fa-spin" aria-hidden="true"></i>
                                    <i v-else class="fas fa-bolt" aria-hidden="true"></i>
                                    <span>立即抓取</span>
                                </button>
                            </div>
                        </div>

                        <div class="edit-card-fields rss-scheduler-grid">
                            <div class="edit-card-field">
                                <div class="edit-card-label">启用定时抓取</div>
                                <label class="rss-switch" aria-label="启用定时抓取">
                                    <input type="checkbox" v-model="rssSchedulerEnabled" />
                                    <span class="rss-switch-track" aria-hidden="true"></span>
                                </label>
                            </div>
                            <div class="edit-card-field">
                                <div class="edit-card-label">模式</div>
                                <select class="edit-card-input" v-model="rssSchedulerType" aria-label="定时模式">
                                    <option value="interval">间隔</option>
                                    <option value="cron">定点</option>
                                </select>
                            </div>
                            <div class="edit-card-field" v-if="rssSchedulerType === 'interval'">
                                <div class="edit-card-label">间隔(分钟)</div>
                                <input class="edit-card-input" type="number" min="1" step="1" v-model="rssSchedulerIntervalMinutes" placeholder="例如：60" aria-label="间隔分钟" />
                            </div>
                            <template v-else>
                                <div class="edit-card-field">
                                    <div class="edit-card-label">分钟(0-59)</div>
                                    <input class="edit-card-input" v-model="rssSchedulerCronMinute" placeholder="例如：5" aria-label="Cron 分钟" />
                                </div>
                                <div class="edit-card-field">
                                    <div class="edit-card-label">小时(0-23)</div>
                                    <input class="edit-card-input" v-model="rssSchedulerCronHour" placeholder="例如：9" aria-label="Cron 小时" />
                                </div>
                                <div class="edit-card-field">
                                    <div class="edit-card-label">星期(0-6, 周一=0)</div>
                                    <input class="edit-card-input" v-model="rssSchedulerCronDayOfWeek" placeholder="例如：0" aria-label="Cron 星期" />
                                </div>
                            </template>
                        </div>
                    </div>

                    <div class="edit-card-section">
                        <div class="edit-card-section-header">
                            <h4 class="edit-card-section-title">订阅源</h4>
                            <button type="button" class="btn btn-outline btn-small" @click="handleAddRssSource" aria-label="新增订阅源">
                                <i class="fas fa-plus" aria-hidden="true"></i>
                                <span>新增</span>
                            </button>
                        </div>

                        <div v-if="!rssSources || rssSources.length === 0" class="empty-state" role="status">
                            <div class="empty-icon" aria-hidden="true">
                                <i class="fas fa-rss" aria-hidden="true"></i>
                            </div>
                            <div class="empty-title">暂无订阅源</div>
                            <div class="empty-subtitle">点击“新增”添加 RSS 地址</div>
                        </div>

                        <div v-else class="edit-card-list rss-source-list">
                            <div class="rss-source-row" :class="{ 'is-disabled': source && source.enabled === false }" v-for="(source, idx) in rssSources" :key="source.key || idx">
                                <input class="edit-card-input" v-model="source.title" placeholder="名称" aria-label="订阅源名称" />
                                <input class="edit-card-input" v-model="source.url" placeholder="https://example.com/rss" aria-label="订阅源URL" />
                                <label class="rss-switch" aria-label="启用该订阅源">
                                    <input type="checkbox" v-model="source.enabled" />
                                    <span class="rss-switch-track" aria-hidden="true"></span>
                                </label>
                                <button type="button" class="edit-card-row-delete" @click="handleDeleteRssSource(idx)" aria-label="删除订阅源">
                                    <i class="fas fa-trash" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="edit-card-footer">
                    <button type="button" class="btn btn-secondary" @click="handleCloseRssManager">关闭</button>
                    <button type="button" class="btn btn-primary" @click="handleSaveRssManager" :disabled="rssManagerBusy">
                        <i v-if="rssManagerBusy" class="fas fa-spinner fa-spin" aria-hidden="true"></i>
                        <span>保存</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    

    <!-- 错误提示 -->
    <section id="error-message" class="error-message" role="alert" aria-live="assertive" hidden></section>

    <!-- 通知容器 -->
    <section id="notifications" class="notifications-container" role="region" aria-label="通知区域"></section>

    <script type="module" src="../../config.js"></script>

    <!-- Mermaid 工具函数 -->
    <script type="module" src="../../utils/mermaid.js"></script>
    <script type="module" src="../../utils/mermaidDebug.js"></script>
    <script type="module" src="../../utils/mermaidRenderer.js"></script>
    <!-- 主功能脚本 -->
    <script type="module" src="../../components/common/searchHeader/index.js"></script>
    <script type="module" src="../../components/calendar/index.js"></script>
    <script type="module" src="../../components/business/newsList/index.js"></script>
    <script type="module" src="../../views/news/index.js"></script>
    <!-- 性能监控脚本 -->
    <script type="module" src="../../utils/performance.js"></script>
</body>
</html>






