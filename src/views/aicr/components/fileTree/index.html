<!-- 文件树组件模板 -->
<aside class="file-tree-container" :class="{ 'collapsed': collapsed }" role="navigation" aria-label="文件目录树">
    <!-- 收起按钮 -->
    <div 
        class="file-tree-toggle" 
        @click="$emit('toggle-collapse')" 
        :title="collapsed ? '展开文件目录树' : '收起文件目录树'"
        role="button"
        tabindex="0"
        @keydown.enter="$emit('toggle-collapse')"
        @keydown.space.prevent="$emit('toggle-collapse')"
        :aria-label="collapsed ? '展开文件目录树' : '收起文件目录树'"
    >
        <i class="fas fa-chevron-left" :class="{ 'rotated': collapsed }"></i>
    </div>
    
    <!-- 加载状态 -->
    <div v-if="loading" class="loading-container" role="status" aria-live="polite">
        <div class="loading-spinner" aria-hidden="true"></div>
        <div class="loading-text">正在加载文件树...</div>
    </div>

    <!-- 错误状态 -->
    <div v-else-if="error" class="error-container" role="alert">
        <div class="error-icon" aria-hidden="true">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="error-message">{{ error }}</div>
        <button type="button" @click="$emit('reload')" class="retry-button">
            <i class="fas fa-redo"></i>
            重新加载
        </button>
    </div>

    <!-- 文件树内容 -->
    <div v-else-if="tree.length > 0" class="file-tree-content">
        <!-- 树形视图 -->
        <ul v-if="viewMode === 'tree'" class="file-tree" role="tree">
            <template v-for="item in sortedTree" :key="item.id">
                <!-- 递归组件：文件树节点 -->
                <file-tree-node 
                    :item="item" 
                    :selected-file-id="selectedFileId"
                    :expanded-folders="expandedFolders"
                    :comments="comments"
                    :batch-mode="batchMode"
                    :selected-file-ids="selectedFileIds"
                    @file-select="$emit('file-select', $event)"
                    @folder-toggle="$emit('folder-toggle', $event)"
                    @create-folder="$emit('create-folder', $event)"
                    @create-file="$emit('create-file', $event)"
                    @rename-item="$emit('rename-item', $event)"
                    @delete-item="$emit('delete-item', $event)"
                    @create-session="$emit('create-session', $event)"
                    @batch-select-file="$emit('batch-select-file', $event)"
                ></file-tree-node>
            </template>
        </ul>
        
        <!-- 标签视图 -->
        <div v-else-if="viewMode === 'tags'" class="file-tags-view">
            <div class="tags-container">
                <div 
                    v-for="file in flattenedFiles" 
                    :key="file.id"
                    :class="['file-tag', { 
                        'selected': !batchMode && isFileSelected(file.id),
                        'batch-selected': batchMode && isFileSelected(file.id)
                    }]"
                    @click="handleTagClick(file.id)"
                    :title="`文件: ${file.name}`"
                >
                    <span class="tag-icon">{{ getFileIcon(file) }}</span>
                    <span class="tag-name">{{ file.name }}</span>
                    <span v-if="getCommentCount(file.id) > 0" class="tag-comment-count">
                        {{ getCommentCount(file.id) }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- 空状态 -->
    <div v-else class="empty-state" role="status">
        <div class="empty-icon" aria-hidden="true">
            <i class="fas fa-folder-open"></i>
        </div>
        <div class="empty-title">暂无文件</div>
        <div class="empty-subtitle">请检查文件目录或联系管理员</div>
    </div>
</aside>







