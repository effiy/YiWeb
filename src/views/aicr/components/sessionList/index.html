<div class="session-list-container">
    <!-- ÊâπÈáèÊìç‰ΩúÂ∑•ÂÖ∑Ê†è -->
    <div class="session-batch-toolbar" v-if="sessionBatchMode">
        <div class="batch-toolbar-left">
            <label class="batch-select-all">
                <input 
                    type="checkbox" 
                    :checked="filteredSessions.length > 0 && filteredSessions.every(s => isSessionSelected(s.id))"
                    @change="handleSelectAll"
                >
                <span>ÂÖ®ÈÄâ</span>
            </label>
            <span class="batch-selected-count" v-if="selectedSessionKeys.size > 0">
                Â∑≤ÈÄâ {{ selectedSessionKeys.size }} È°π
            </span>
        </div>
        <div class="batch-toolbar-right">
            <button 
                type="button" 
                class="batch-action-btn batch-delete-btn"
                :disabled="selectedSessionKeys.size === 0"
                @click="handleBatchDelete"
                title="Âà†Èô§ÈÄâ‰∏≠‰ºöËØù">
                <i class="fas fa-trash-alt"></i> Âà†Èô§
            </button>
            <button 
                type="button" 
                class="batch-action-btn batch-cancel-btn"
                @click="handleBatchCancel"
                title="ÈÄÄÂá∫ÊâπÈáèÊ®°Âºè">
                ÂèñÊ∂à
            </button>
        </div>
    </div>

    <!-- Ê†áÁ≠æËøáÊª§Âô®ÔºàÂèÇËÄÉ YiPet È°πÁõÆÔºâ -->
    <div class="session-list-tags" v-if="!sessionBatchMode && (allTags.length > 0 || tagCounts.noTagsCount > 0)">
        <div class="tags-header">
            <span class="tags-title">Ê†áÁ≠æÁ≠õÈÄâ</span>
            <div class="tags-header-actions">
                <!-- Á≠õÈÄâÊó†Ê†áÁ≠æÊåâÈíÆ -->
                <button 
                    type="button"
                    class="tag-filter-btn tag-filter-no-tags-btn"
                    :class="{ active: tagFilterNoTags }"
                    @click="toggleNoTags"
                    :title="tagFilterNoTags ? 'ÂèñÊ∂àÁ≠õÈÄâÊó†Ê†áÁ≠æ‰ºöËØù' : 'Á≠õÈÄâÊ≤°ÊúâÊ†áÁ≠æÁöÑ‰ºöËØù'"
                    aria-label="Á≠õÈÄâÊó†Ê†áÁ≠æ">
                    <span class="tag-icon-wrapper">
                        <i class="fas fa-tag"></i>
                        <i v-if="tagFilterNoTags" class="fas fa-ban tag-ban-overlay"></i>
                    </span>
                </button>
                <!-- ÂèçÂêëËøáÊª§ÊåâÈíÆ -->
                <button 
                    type="button"
                    class="tag-filter-btn tag-filter-reverse"
                    :class="{ active: tagFilterReverse }"
                    @click="toggleReverse"
                    :title="tagFilterReverse ? 'ÂèñÊ∂àÂèçÂêëËøáÊª§' : 'ÂèçÂêëËøáÊª§ÔºàÊéíÈô§ÈÄâ‰∏≠Ê†áÁ≠æÔºâ'"
                    aria-label="ÂèçÂêëËøáÊª§">
                    <i class="fas fa-exchange-alt"></i>
                </button>
                <!-- Â±ïÂºÄ/ÊäòÂè†ÊåâÈíÆ -->
                <button 
                    type="button"
                    class="tag-filter-btn"
                    :class="{ active: tagFilterExpanded }"
                    @click="toggleExpand"
                    :title="tagFilterExpanded ? 'Êî∂Ëµ∑Ê†áÁ≠æÂàóË°®' : 'Â±ïÂºÄÊ†áÁ≠æÂàóË°®'"
                    aria-label="Â±ïÂºÄ/ÊäòÂè†Ê†áÁ≠æ">
                    <i class="fas" :class="tagFilterExpanded ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                </button>
                <!-- Ê∏ÖÈô§ÊâÄÊúâËøáÊª§ÊåâÈíÆ -->
                <button 
                    type="button"
                    class="tags-clear-btn"
                    :class="{ active: selectedTags.length > 0 || tagFilterNoTags || tagFilterSearchKeyword }"
                    @click="clearAllFilters"
                    :title="(selectedTags.length > 0 || tagFilterNoTags || tagFilterSearchKeyword) ? 'Ê∏ÖÈô§ÊâÄÊúâËøáÊª§Êù°‰ª∂' : 'Êó†ËøáÊª§Êù°‰ª∂'"
                    :disabled="selectedTags.length === 0 && !tagFilterNoTags && !tagFilterSearchKeyword">
                    Ê∏ÖÈô§
                </button>
            </div>
        </div>
        
        <!-- Ê†áÁ≠æÊêúÁ¥¢Ê°Ü -->
        <div class="tag-search-container">
            <input
                type="text"
                class="tag-search-input"
                :value="tagFilterSearchKeyword"
                @input="updateTagSearch($event.target.value)"
                placeholder="ÊêúÁ¥¢Ê†áÁ≠æ..."
                aria-label="ÊêúÁ¥¢Ê†áÁ≠æ"
            />
            <button
                type="button"
                v-if="tagFilterSearchKeyword"
                class="tag-search-clear"
                @click="updateTagSearch('')"
                title="Ê∏ÖÈô§ÊêúÁ¥¢"
                aria-label="Ê∏ÖÈô§ÊêúÁ¥¢">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <!-- Ê†áÁ≠æÂàóË°® -->
        <div class="tags-list">
            <!-- Ê≤°ÊúâÊ†áÁ≠æÊåâÈíÆÔºà‰∏çÂÖÅËÆ∏ÊãñÊãΩÔºâ -->
            <button
                type="button"
                v-if="tagCounts.noTagsCount > 0"
                class="tag-item tag-no-tags"
                :class="{ active: tagFilterNoTags }"
                :draggable="false"
                @click="toggleNoTags"
                :title="tagFilterNoTags ? 'ÂèñÊ∂àÁ≠õÈÄâÊó†Ê†áÁ≠æ‰ºöËØù' : 'Á≠õÈÄâÊ≤°ÊúâÊ†áÁ≠æÁöÑ‰ºöËØù'">
                Ê≤°ÊúâÊ†áÁ≠æ ({{ tagCounts.noTagsCount }})
            </button>
            
            <!-- Ê†áÁ≠æÈ°πÔºàÊîØÊåÅÊãñÊãΩÊéíÂ∫èÔºâ -->
            <button
                type="button"
                v-for="tag in visibleTags"
                :key="tag"
                class="tag-item"
                :class="{ active: selectedTags.includes(tag) }"
                :draggable="true"
                :data-tag-name="tag"
                @click="toggleTag(tag)"
                @dragstart="handleDragStart($event, tag)"
                @dragend="handleDragEnd($event)"
                @dragover="handleDragOver($event)"
                @dragleave="handleDragLeave($event)"
                @drop="handleDrop($event, tag)"
                :title="selectedTags.includes(tag) ? 'ÂèñÊ∂àÈÄâÊã© | ÊãñÊãΩË∞ÉÊï¥È°∫Â∫è' : 'ÈÄâÊã©Ê†áÁ≠æ | ÊãñÊãΩË∞ÉÊï¥È°∫Â∫è'">
                {{ tag }} ({{ tagCounts.counts[tag] || 0 }})
            </button>
            
            <!-- Â±ïÂºÄ/ÊäòÂè†ÊåâÈíÆÔºà‰ªÖÂú®Ê†áÁ≠æÂàóË°®Â∫ïÈÉ®ÊòæÁ§∫ÔºåÂΩìÊúâÊõ¥Â§öÊ†áÁ≠æÊó∂Ôºå‰∏çÂÖÅËÆ∏ÊãñÊãΩÔºâ -->
            <button
                type="button"
                v-if="hasMoreTags && !tagFilterSearchKeyword"
                class="tag-item tag-expand-btn"
                :draggable="false"
                @click="toggleExpand"
                :title="tagFilterExpanded ? 'Êî∂Ëµ∑Ê†áÁ≠æ' : 'Â±ïÂºÄÊ†áÁ≠æ'">
                <i class="fas" :class="tagFilterExpanded ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                {{ tagFilterExpanded ? 'Êî∂Ëµ∑' : `Â±ïÂºÄ (${filteredTags.length - visibleTags.length})` }}
            </button>
        </div>
    </div>
    
    <!-- ‰ºöËØùÂàóË°® -->
    <div class="session-list-content">
        <div v-if="loading" class="session-list-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <span>Âä†ËΩΩ‰∏≠...</span>
        </div>
        <div v-else-if="error" class="session-list-error">
            <i class="fas fa-exclamation-circle"></i>
            <span>{{ error }}</span>
        </div>
        <div v-else-if="filteredSessions.length === 0" class="session-list-empty">
            <i class="fas fa-inbox"></i>
            <span>ÊöÇÊó†‰ºöËØù</span>
        </div>
        <div v-else class="session-list-items">
            <div 
                v-for="session in filteredSessions"
                :key="session.id"
                class="session-item"
                :class="{ 
                    active: selectedSessionId === session.id,
                    'batch-selected': sessionBatchMode && isSessionSelected(session.id)
                }"
                @click="handleSessionClick(session, $event)"
                @mousedown="startLongPress(session, $event)"
                @mouseup="cancelLongPress"
                @mouseleave="cancelLongPress"
                @touchstart="startLongPress(session, $event)"
                @touchend="cancelLongPress"
                @touchcancel="cancelLongPress">
                
                <!-- Á¨¨‰∏ÄË°åÔºöÊ†áÈ¢òÂíåÊî∂ËóèÊåâÈíÆ -->
                <div class="session-item-header">
                    <div class="session-item-title-group">
                        <!-- ÊâπÈáèÈÄâÊã©Â§çÈÄâÊ°ÜÔºà‰ªÖÂú®ÊâπÈáèÊ®°Âºè‰∏ãÊòæÁ§∫Ôºâ -->
                        <input
                            v-if="sessionBatchMode"
                            type="checkbox"
                            class="session-batch-checkbox"
                            :checked="isSessionSelected(session.id)"
                            @click.stop="handleBatchSelect(session.id, $event)"
                            :title="isSessionSelected(session.id) ? 'ÂèñÊ∂àÈÄâÊã©' : 'ÈÄâÊã©'"
                            aria-label="ÊâπÈáèÈÄâÊã©"
                        />
                        <!-- Êù•Ëá™newsÁöÑ‰ºöËØùÊòæÁ§∫Á¨¨‰∏Ä‰∏™Â≠óÁ¨¶ÂõæÊ†á -->
                        <div v-if="getSessionFirstChar(session)" class="session-first-char-icon" :title="'Êù•Ëá™news'">
                            {{ getSessionFirstChar(session) }}
                        </div>
                        <i v-if="getSessionSourceIcon(session)" :class="[getSessionSourceIcon(session), 'session-source-icon', { 'session-source-icon-news': getSessionSource(session) === 'news', 'session-source-icon-file': getSessionSource(session) === 'file-tree' }]"></i>
                        <span class="session-title-text">{{ session.pageTitle || session.title || 'Êú™ÂëΩÂêç‰ºöËØù' }}</span>
                    </div>
                    
                    <!-- Êî∂ËóèÊåâÈíÆÔºàÊâπÈáèÊ®°Âºè‰∏ãÈöêËóèÔºåÂú®Ê†áÈ¢òË°åÂè≥‰æßÔºâ -->
                    <button 
                        type="button"
                        v-if="!sessionBatchMode"
                        class="session-favorite-btn"
                        :class="{ active: session.isFavorite }"
                        @click.stop="handleFavoriteClick(session)"
                        :title="session.isFavorite ? 'ÂèñÊ∂àÊî∂Ëóè' : 'Êî∂Ëóè'"
                        aria-label="Êî∂Ëóè">
                        {{ session.isFavorite ? '‚ù§Ô∏è' : 'ü§ç' }}
                    </button>
                </div>

                <!-- Á¨¨‰∫åË°åÔºöÊ†áÁ≠æÔºàÂ¶ÇÊûúÊúâÔºâ -->
                <div class="session-item-tags" v-if="session.tags && session.tags.length > 0">
                    <span 
                        v-for="tag in session.tags" 
                        :key="tag"
                        class="session-tag">
                        {{ tag }}
                    </span>
                </div>

                <!-- Á¨¨‰∏âË°åÔºöÂ∫ïÈÉ®‰ø°ÊÅØÔºàÊó∂Èó¥‰∏éÊìç‰ΩúÔºâ -->
                <div class="session-item-footer">
                    <span class="session-item-time">{{ formatTime(session.updatedAt || session.createdAt) }}</span>
                    <!-- Êìç‰ΩúÊåâÈíÆÂÆπÂô®ÔºàÂ∫ïÈÉ®ÔºåÊâπÈáèÊ®°Âºè‰∏ãÈöêËóèÔºâ -->
                    <div 
                        v-if="!sessionBatchMode"
                        class="session-item-actions session-item-actions-footer">
                        <!-- ÁºñËæëÊåâÈíÆ -->
                        <button 
                            type="button"
                            class="session-action-btn session-edit-btn"
                            @click.stop="handleEditClick(session)"
                            title="ÁºñËæëÊ†áÈ¢ò"
                            aria-label="ÁºñËæëÊ†áÈ¢ò">
                            <i class="fas fa-edit"></i>
                        </button>
                        <!-- Ê†áÁ≠æÁÆ°ÁêÜÊåâÈíÆ -->
                        <button 
                            type="button"
                            class="session-action-btn session-tag-btn"
                            @click.stop="handleTagClick(session)"
                            title="ÁÆ°ÁêÜÊ†áÁ≠æ"
                            aria-label="ÁÆ°ÁêÜÊ†áÁ≠æ">
                            <i class="fas fa-tags"></i>
                        </button>
                        <!-- ÂâØÊú¨ÊåâÈíÆ -->
                        <button 
                            type="button"
                            class="session-action-btn session-duplicate-btn"
                            @click.stop="handleDuplicateClick(session)"
                            title="ÂàõÂª∫ÂâØÊú¨"
                            aria-label="ÂàõÂª∫ÂâØÊú¨">
                            <i class="fas fa-copy"></i>
                        </button>
                        <!-- È°µÈù¢‰∏ä‰∏ãÊñáÊåâÈíÆ -->
                        <button 
                            type="button"
                            class="session-action-btn session-context-btn"
                            @click.stop="handleContextClick(session)"
                            title="È°µÈù¢‰∏ä‰∏ãÊñá"
                            aria-label="È°µÈù¢‰∏ä‰∏ãÊñá">
                            <i class="fas fa-file-alt"></i>
                        </button>
                        <!-- ÊâìÂºÄURLÊåâÈíÆÔºàÂ¶ÇÊûúURL‰ª•https://ÂºÄÂ§¥Ôºâ -->
                        <button 
                            type="button"
                            v-if="session.url && session.url.startsWith('https://')"
                            class="session-action-btn session-open-url-btn"
                            @click.stop="handleOpenUrlClick(session)"
                            title="Âú®Êñ∞Ê†áÁ≠æÈ°µÊâìÂºÄ"
                            aria-label="Âú®Êñ∞Ê†áÁ≠æÈ°µÊâìÂºÄ">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                        <!-- ÁõÆÂΩïÊé•Âè£ÊåâÈíÆÔºà‰ªÖÂΩì‰ºöËØù‰∏çÊòØÊù•Ëá™Ê†ëÂΩ¢Êñá‰ª∂Êó∂ÊòæÁ§∫Ôºâ -->
                        <button 
                            type="button"
                            v-if="!isSessionFromTree(session)"
                            class="session-action-btn session-tree-btn"
                            @click.stop="handleTreeClick(session)"
                            title="ËΩ¨ÊàêÊ†ëÂΩ¢Êñá‰ª∂ÂÜÖÂÆπ"
                            aria-label="ËΩ¨ÊàêÊ†ëÂΩ¢Êñá‰ª∂ÂÜÖÂÆπ">
                            <i class="fas fa-sitemap"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

