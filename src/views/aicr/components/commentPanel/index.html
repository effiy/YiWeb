<!-- ‰ª£Á†ÅËØÑÂÆ°ËØÑËÆ∫Èù¢ÊùøÁªÑ‰ª∂Ê®°Êùø -->
<aside class="comment-panel-container" :class="{ 'collapsed': collapsed }" role="complementary" aria-label="‰ª£Á†ÅËØÑÂÆ°ËØÑËÆ∫Èù¢Êùø">

    <!-- ÂÖ®Â±ÄÂä†ËΩΩÁä∂ÊÄÅ -->
    <div v-if="loading || commentsLoading" class="loading-container" role="status" aria-live="polite">
        <div class="loading-spinner" aria-hidden="true"></div>
        <div class="loading-text">Ê≠£Âú®Âä†ËΩΩËØÑËÆ∫...</div>
    </div>

    <!-- ÈîôËØØÁä∂ÊÄÅ -->
    <div v-else-if="error" class="error-container" role="alert" aria-live="polite">
        <div class="error-icon" aria-hidden="true">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="error-text">{{ error }}</div>
    </div>

    <!-- ËØÑËÆ∫ÂÜÖÂÆπ -->
    <div v-else class="comment-panel-content">
        <div v-if="isSessionChatMode" class="aicr-session-chat">
            <div v-if="sessionChatLoading" class="loading-container" role="status" aria-live="polite">
                <div class="loading-spinner" aria-hidden="true"></div>
                <div class="loading-text">Ê≠£Âú®Âä†ËΩΩ‰ºöËØù...</div>
            </div>

            <div v-else-if="sessionChatError" class="error-container" role="alert" aria-live="polite">
                <div class="error-icon" aria-hidden="true">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="error-text">{{ sessionChatError }}</div>
            </div>

            <div v-else class="aicr-session-chat-body">
                <div v-if="!sessionChatSession" class="no-file-state" role="status">
                    <div class="no-file-icon" aria-hidden="true">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="no-file-title">Êú™ÈÄâÊã©‰ºöËØù</div>
                    <div class="no-file-subtitle">ËØ∑‰ªéÂ∑¶‰æß‰ºöËØùÂàóË°®ÈÄâÊã©‰∏Ä‰∏™‰ºöËØù</div>
                </div>

                <div v-else class="aicr-session-chat-right-panel">
                    <div class="aicr-session-chat-messages" role="log" aria-live="polite">
                        <div v-for="(m, idx) in sessionChatMessages" :key="`${m.timestamp || 0}_${idx}`"
                            class="chat-message" :class="{
                                'is-pet': m.type === 'pet',
                                'is-user': m.type !== 'pet',
                                'is-error': !!m.error,
                                'is-aborted': !!m.aborted,
                                'is-streaming': isSessionChatStreamingMessage(m, idx)
                            }" :data-chat-idx="idx" :data-chat-timestamp="m.timestamp || 0"
                            :data-chat-type="m.type === 'pet' ? 'pet' : 'user'">
                            <div class="chat-bubble">
                                <div v-if="Array.isArray(m.imageDataUrls) && m.imageDataUrls.length > 0"
                                    class="chat-images">
                                    <img v-for="(src, imgIdx) in m.imageDataUrls" :key="`${m.timestamp || 0}_${imgIdx}`"
                                        class="chat-image" :src="src" alt="ÂõæÁâáÊ∂àÊÅØ" />
                                </div>
                                <img v-else-if="m.imageDataUrl" class="chat-image" :src="m.imageDataUrl" alt="ÂõæÁâáÊ∂àÊÅØ" />
                                <div v-if="m.type === 'pet' && (!(m.message || m.content) || !String(m.message || m.content).trim()) && sessionChatSending && idx === (sessionChatMessages.length - 1)"
                                    class="chat-typing" aria-label="ÁîüÊàê‰∏≠">...</div>
                                <div v-else-if="(m.message || m.content) && String(m.message || m.content).trim() && isSessionChatStreamingMessage(m, idx)"
                                    class="chat-content md-preview-body chat-content-streaming"
                                    v-html="renderSessionChatStreamingHtml(m.message || m.content)"></div>
                                <div v-else-if="(m.message || m.content) && String(m.message || m.content).trim()"
                                    class="chat-content md-preview-body"
                                    v-html="renderSessionChatMarkdown(m.message || m.content)"></div>
                                <div class="chat-meta">
                                    <div class="chat-meta-actions">
                                        <button v-if="(m.message || m.content) && String(m.message || m.content).trim()"
                                            type="button" class="chat-meta-btn"
                                            @click="copySessionChatMessage(m.message || m.content, m, idx)"
                                            aria-label="Â§çÂà∂Ê∂àÊÅØ" title="Â§çÂà∂">{{ sessionChatCopyButtonLabel(m, idx)
                                            }}</button>
                                        <template
                                            v-if="Array.isArray(sessionChatWeChatRobots) && sessionChatWeChatRobots.length > 0 && m.type === 'pet' && (m.message || m.content) && String(m.message || m.content).trim()">
                                            <button v-for="(bot, bi) in sessionChatWeChatRobots"
                                                :key="bot.id || ('wrb_' + bi)" type="button" class="chat-meta-btn"
                                                :title="'ÂèëÈÄÅÂà∞Ôºö' + (bot.name || 'Êú∫Âô®‰∫∫')"
                                                :aria-label="'ÂèëÈÄÅÂà∞Êú∫Âô®‰∫∫Ôºö' + (bot.name || 'Êú∫Âô®‰∫∫')"
                                                @click="sendSessionChatMessageToRobot(bot, m, idx)">{{ bot.name || 'Êú∫Âô®‰∫∫'
                                                }}</button>
                                        </template>
                                        <button v-if="m.type !== 'pet'" type="button" class="chat-meta-btn"
                                            :disabled="sessionChatSending" @click="editSessionChatMessageAt(idx)"
                                            aria-label="ÁºñËæëÊ∂àÊÅØ" title="ÁºñËæë">‚úèÔ∏è</button>
                                        <button v-if="m.type !== 'pet'" type="button" class="chat-meta-btn"
                                            :disabled="sessionChatSending" @click="resendSessionChatMessageAt(idx)"
                                            aria-label="ÈáçÊñ∞ÂèëÈÄÅ" title="ÈáçÊñ∞ÂèëÈÄÅ">üì®</button>
                                        <button type="button" class="chat-meta-btn"
                                            @click="moveSessionChatMessageUp(idx)" aria-label="‰∏äÁßªÊ∂àÊÅØ"
                                            title="‰∏äÁßª">‚¨ÜÔ∏è</button>
                                        <button type="button" class="chat-meta-btn"
                                            @click="moveSessionChatMessageDown(idx)" aria-label="‰∏ãÁßªÊ∂àÊÅØ"
                                            title="‰∏ãÁßª">‚¨áÔ∏è</button>
                                        <button v-if="m.type === 'pet' && canRegenerateSessionChatMessage(idx)"
                                            type="button" class="chat-meta-btn"
                                            :disabled="sessionChatSending || isSessionChatRegenerating(m, idx)"
                                            @click="regenerateSessionChatMessageAt(idx)" aria-label="ÈáçÊñ∞ÁîüÊàêÂõûÂ§ç"
                                            title="ÈáçÊñ∞ÁîüÊàê">{{ sessionChatRegenerateButtonLabel(m, idx) }}</button>
                                        <button type="button" class="chat-meta-btn" :disabled="sessionChatSending"
                                            @click="deleteSessionChatMessageAt(idx)" aria-label="Âà†Èô§Ê∂àÊÅØ"
                                            title="Âà†Èô§">üóëÔ∏è</button>
                                    </div>
                                    <time class="chat-time" :datetime="m.timestamp">{{ formatTime(m.timestamp) }}</time>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="chat-input-container chat-input-container">
                        <div class="chat-toolbar chat-input-toolbar">
                            <div class="chat-toolbar-left chat-input-btn-group">
                                <button type="button" class="chat-btn chat-input-btn chat-input-text-btn"
                                    @click="openSessionChatContextEditor" title="È°µÈù¢‰∏ä‰∏ãÊñá" aria-label="È°µÈù¢‰∏ä‰∏ãÊñá">üìù
                                    È°µÈù¢‰∏ä‰∏ãÊñá</button>
                                <button type="button" class="chat-btn chat-input-btn chat-input-text-btn"
                                    @click="openSessionChatFaq" title="Â∏∏ËßÅÈóÆÈ¢ò" aria-label="Â∏∏ËßÅÈóÆÈ¢ò">üí° Â∏∏ËßÅÈóÆÈ¢ò</button>
                                <button type="button" class="chat-btn chat-input-btn chat-input-text-btn"
                                    @click="openSessionChatWeChatSettings" title="ÂæÆ‰ø°Êú∫Âô®‰∫∫ËÆæÁΩÆ" aria-label="ÂæÆ‰ø°Êú∫Âô®‰∫∫ËÆæÁΩÆ">ü§ñ
                                    ÂæÆ‰ø°Êú∫Âô®‰∫∫</button>
                                <button type="button" class="chat-btn chat-input-btn chat-input-text-btn"
                                    @click="openSessionChatImagePicker" title="‰∏ä‰º†ÂõæÁâá" aria-label="‰∏ä‰º†ÂõæÁâá">üñºÔ∏è ÂõæÁâá</button>
                                <input id="session-chat-image-input" type="file" accept="image/*" multiple
                                    style="display:none" @change="onSessionChatImageInputChange" />
                            </div>
                            <div class="chat-toolbar-right chat-input-btn-group">
                                <div class="context-switch-container" :class="{ active: sessionChatIncludePageContext }"
                                    title="ÂºÄÂêØ/ÂÖ≥Èó≠È°µÈù¢‰∏ä‰∏ãÊñá">
                                    <span class="context-switch-label">È°µÈù¢‰∏ä‰∏ãÊñá</span>
                                    <label class="context-switch-wrapper" for="session-chat-context-switch">
                                        <div class="context-switch-thumb"></div>
                                    </label>
                                    <input id="session-chat-context-switch" class="context-switch-input" type="checkbox"
                                        :checked="sessionChatIncludePageContext"
                                        @change="sessionChatIncludePageContext = $event.target.checked"
                                        aria-label="È°µÈù¢‰∏ä‰∏ãÊñáÂºÄÂÖ≥" />
                                </div>
                                <button type="button" class="chat-input-status-btn"
                                    :class="{ active: sessionChatSending }" :disabled="!sessionChatSending"
                                    @click="abortSessionChatRequest"
                                    :title="sessionChatSending ? 'ËØ∑Ê±ÇÁä∂ÊÄÅÔºöÁîüÊàê‰∏≠ÔºàÁÇπÂáªÂÅúÊ≠¢Ôºâ' : 'ËØ∑Ê±ÇÁä∂ÊÄÅÔºöÁ©∫Èó≤'" aria-label="ËØ∑Ê±ÇÁä∂ÊÄÅ">{{
                                    sessionChatSending ? '‚è∏Ô∏è' : '‚èπÔ∏è' }}</button>
                            </div>
                        </div>

                        <div class="chat-input-wrapper">
                            <div v-if="Array.isArray(sessionChatDraftImages) && sessionChatDraftImages.length > 0"
                                class="chat-draft-images" aria-label="ÂæÖÂèëÈÄÅÂõæÁâá">
                                <div v-for="(src, imgIdx) in sessionChatDraftImages" :key="`draft_${imgIdx}`"
                                    class="chat-draft-image">
                                    <img class="chat-draft-image-preview" :src="src" alt="ÂæÖÂèëÈÄÅÂõæÁâá" />
                                    <button type="button" class="chat-draft-image-remove"
                                        @click="removeSessionChatDraftImage(imgIdx)" aria-label="ÁßªÈô§ÂõæÁâá"
                                        title="ÁßªÈô§">‚úï</button>
                                </div>
                                <button type="button" class="chat-draft-images-clear"
                                    @click="clearSessionChatDraftImages" aria-label="Ê∏ÖÁ©∫ÂõæÁâá" title="Ê∏ÖÁ©∫ÂõæÁâá">Ê∏ÖÁ©∫ÂõæÁâá</button>
                            </div>

                            <div class="chat-input-row">
                                <textarea id="session-chat-input" class="chat-textarea chat-message-input"
                                    :value="sessionChatInputText" @input="onSessionChatInput"
                                    @keydown="onSessionChatKeydown" @compositionstart="onSessionChatCompositionStart"
                                    @compositionupdate="onSessionChatCompositionUpdate"
                                    @compositionend="onSessionChatCompositionEnd" @paste="onSessionChatPaste"
                                    placeholder="ËæìÂÖ•Ê∂àÊÅØ... (Enter ÂèëÈÄÅ, Shift+Enter Êç¢Ë°å)" rows="2"
                                    aria-label="‰ºöËØùËæìÂÖ•Ê°Ü"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-else>
            <!-- ‰ºöËØùÊ®°Âºè‰∏ãÁöÑËØÑËÆ∫ÂàóË°®Ôºà‰ª•‰ºöËØùÊ∂àÊÅØÊ†ºÂºèÊòæÁ§∫ÔºåÂåÖÂê´ÂÆåÊï¥ÁöÑËÅäÂ§©ÂäüËÉΩÔºâ -->
            <div v-if="isSessionChatMode" class="aicr-session-chat-body comment-chat-mode">
                <!-- ËØÑËÆ∫Ê∂àÊÅØÂàóË°® -->
                <div v-if="commentsAsSessionMessages && commentsAsSessionMessages.length > 0"
                    class="aicr-session-chat-messages comment-list-as-messages" role="log" aria-live="polite">
                    <div v-for="(m, idx) in commentsAsSessionMessages" :key="`comment_${m._commentKey || m.key}_${idx}`"
                        class="chat-message" :class="{
                            'is-pet': m.type === 'pet',
                            'is-user': m.type !== 'pet',
                            'is-comment': m._isComment,
                            'is-error': !!m.error,
                            'is-aborted': !!m.aborted,
                            'is-streaming': isSessionChatStreamingMessage(m, idx)
                        }" :data-chat-idx="idx" :data-chat-timestamp="m.timestamp || 0"
                        :data-chat-type="m.type === 'pet' ? 'pet' : 'user'">
                        <div class="chat-bubble">
                            <div v-if="Array.isArray(m.imageDataUrls) && m.imageDataUrls.length > 0"
                                class="chat-images">
                                <img v-for="(src, imgIdx) in m.imageDataUrls" :key="`${m.timestamp || 0}_${imgIdx}`"
                                    class="chat-image" :src="src" alt="ÂõæÁâáÊ∂àÊÅØ" />
                            </div>
                            <img v-else-if="m.imageDataUrl" class="chat-image" :src="m.imageDataUrl" alt="ÂõæÁâáÊ∂àÊÅØ" />
                            <div v-if="m.type === 'pet' && (!(m.message || m.content) || !String(m.message || m.content).trim()) && sessionChatSending && idx === (commentsAsSessionMessages.length - 1)"
                                class="chat-typing" aria-label="ÁîüÊàê‰∏≠">...</div>
                            <div v-else-if="(m.message || m.content) && String(m.message || m.content).trim() && isSessionChatStreamingMessage(m, idx)"
                                class="chat-content md-preview-body chat-content-streaming"
                                v-html="renderSessionChatStreamingHtml(m.message || m.content)"></div>
                            <div v-else-if="(m.message || m.content) && String(m.message || m.content).trim()"
                                class="chat-content md-preview-body"
                                v-html="renderSessionChatMarkdown(m.message || m.content)"></div>
                            <div class="chat-meta">
                                <div class="chat-meta-actions">
                                    <button v-if="(m.message || m.content) && String(m.message || m.content).trim()"
                                        type="button" class="chat-meta-btn" @click="copyCommentAsMessage(m, idx)"
                                        aria-label="Â§çÂà∂Ê∂àÊÅØ" title="Â§çÂà∂">{{ sessionChatCopyButtonLabel(m, idx) }}</button>
                                    <template
                                        v-if="Array.isArray(sessionChatWeChatRobots) && sessionChatWeChatRobots.length > 0 && m.type === 'pet' && (m.message || m.content) && String(m.message || m.content).trim()">
                                        <button v-for="(bot, bi) in sessionChatWeChatRobots"
                                            :key="bot.id || ('wrb_' + bi)" type="button" class="chat-meta-btn"
                                            :title="'ÂèëÈÄÅÂà∞Ôºö' + (bot.name || 'Êú∫Âô®‰∫∫')"
                                            :aria-label="'ÂèëÈÄÅÂà∞Êú∫Âô®‰∫∫Ôºö' + (bot.name || 'Êú∫Âô®‰∫∫')"
                                            @click="sendSessionChatMessageToRobot(bot, m, idx)">{{ bot.name || 'Êú∫Âô®‰∫∫'
                                            }}</button>
                                    </template>
                                    <button v-if="m.type !== 'pet' && m._isComment" type="button" class="chat-meta-btn"
                                        :disabled="sessionChatSending" @click="editCommentAsMessage(m)"
                                        aria-label="ÁºñËæëËØÑËÆ∫" title="ÁºñËæë">‚úèÔ∏è</button>
                                    <button v-if="m.type !== 'pet' && m._isComment" type="button" class="chat-meta-btn"
                                        :disabled="sessionChatSending" @click="deleteCommentAsMessage(m)"
                                        aria-label="Âà†Èô§ËØÑËÆ∫" title="Âà†Èô§">üóëÔ∏è</button>
                                    <button v-if="m.type === 'pet' && canRegenerateSessionChatMessage(idx)"
                                        type="button" class="chat-meta-btn"
                                        :disabled="sessionChatSending || isSessionChatRegenerating(m, idx)"
                                        @click="regenerateSessionChatMessageAt(idx)" aria-label="ÈáçÊñ∞ÁîüÊàêÂõûÂ§ç" title="ÈáçÊñ∞ÁîüÊàê">{{
                                        sessionChatRegenerateButtonLabel(m, idx) }}</button>
                                </div>
                                <time class="chat-time" :datetime="m.timestamp">{{ formatTime(m.timestamp) }}</time>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Á©∫Áä∂ÊÄÅÊèêÁ§∫ -->
                <div v-else class="no-comments-state" role="status">
                    <div class="no-comments-icon" aria-hidden="true">
                        <i class="fas fa-comment-slash"></i>
                    </div>
                    <div class="no-comments-title">ÊöÇÊó†ËØÑËÆ∫</div>
                    <div class="no-comments-subtitle">ÂºÄÂßãÂØπËØùÔºåÊ∑ªÂä†Á¨¨‰∏ÄÊù°Ê∂àÊÅØ</div>
                </div>

                <!-- ËØÑËÆ∫ÂàóË°®ÁöÑËæìÂÖ•Ê°ÜÔºàÁ±ª‰ºº‰ºöËØùËÅäÂ§©Ôºâ -->
                <div class="chat-input-container chat-input-container comment-chat-input">
                    <div class="chat-toolbar chat-input-toolbar">
                        <div class="chat-toolbar-left chat-input-btn-group">
                            <button type="button" class="chat-btn chat-input-btn chat-input-text-btn"
                                @click="openSessionChatContextEditor" title="È°µÈù¢‰∏ä‰∏ãÊñá" aria-label="È°µÈù¢‰∏ä‰∏ãÊñá">üìù È°µÈù¢‰∏ä‰∏ãÊñá</button>
                            <button type="button" class="chat-btn chat-input-btn chat-input-text-btn"
                                @click="openSessionChatFaq" title="Â∏∏ËßÅÈóÆÈ¢ò" aria-label="Â∏∏ËßÅÈóÆÈ¢ò">üí° Â∏∏ËßÅÈóÆÈ¢ò</button>
                            <button type="button" class="chat-btn chat-input-btn chat-input-text-btn"
                                @click="openSessionChatWeChatSettings" title="ÂæÆ‰ø°Êú∫Âô®‰∫∫ËÆæÁΩÆ" aria-label="ÂæÆ‰ø°Êú∫Âô®‰∫∫ËÆæÁΩÆ">ü§ñ
                                ÂæÆ‰ø°Êú∫Âô®‰∫∫</button>
                            <button type="button" class="chat-btn chat-input-btn chat-input-text-btn"
                                @click="openSessionChatImagePicker" title="‰∏ä‰º†ÂõæÁâá" aria-label="‰∏ä‰º†ÂõæÁâá">üñºÔ∏è ÂõæÁâá</button>
                            <input id="comment-chat-image-input" type="file" accept="image/*" multiple
                                style="display:none" @change="onSessionChatImageInputChange" />
                        </div>
                        <div class="chat-toolbar-right chat-input-btn-group">
                            <div class="context-switch-container" :class="{ active: sessionChatIncludePageContext }"
                                title="ÂºÄÂêØ/ÂÖ≥Èó≠È°µÈù¢‰∏ä‰∏ãÊñá">
                                <span class="context-switch-label">È°µÈù¢‰∏ä‰∏ãÊñá</span>
                                <label class="context-switch-wrapper" for="comment-chat-context-switch">
                                    <div class="context-switch-thumb"></div>
                                </label>
                                <input id="comment-chat-context-switch" class="context-switch-input" type="checkbox"
                                    :checked="sessionChatIncludePageContext"
                                    @change="sessionChatIncludePageContext = $event.target.checked"
                                    aria-label="È°µÈù¢‰∏ä‰∏ãÊñáÂºÄÂÖ≥" />
                            </div>
                            <button type="button" class="chat-input-status-btn" :class="{ active: sessionChatSending }"
                                :disabled="!sessionChatSending" @click="abortSessionChatRequest"
                                :title="sessionChatSending ? 'ËØ∑Ê±ÇÁä∂ÊÄÅÔºöÁîüÊàê‰∏≠ÔºàÁÇπÂáªÂÅúÊ≠¢Ôºâ' : 'ËØ∑Ê±ÇÁä∂ÊÄÅÔºöÁ©∫Èó≤'" aria-label="ËØ∑Ê±ÇÁä∂ÊÄÅ">{{
                                sessionChatSending ? '‚è∏Ô∏è' : '‚èπÔ∏è' }}</button>
                        </div>
                    </div>

                    <div class="chat-input-wrapper">
                        <div v-if="Array.isArray(sessionChatDraftImages) && sessionChatDraftImages.length > 0"
                            class="chat-draft-images" aria-label="ÂæÖÂèëÈÄÅÂõæÁâá">
                            <div v-for="(src, imgIdx) in sessionChatDraftImages" :key="`draft_${imgIdx}`"
                                class="chat-draft-image">
                                <img class="chat-draft-image-preview" :src="src" alt="ÂæÖÂèëÈÄÅÂõæÁâá" />
                                <button type="button" class="chat-draft-image-remove"
                                    @click="removeSessionChatDraftImage(imgIdx)" aria-label="ÁßªÈô§ÂõæÁâá" title="ÁßªÈô§">‚úï</button>
                            </div>
                            <button type="button" class="chat-draft-images-clear" @click="clearSessionChatDraftImages"
                                aria-label="Ê∏ÖÁ©∫ÂõæÁâá" title="Ê∏ÖÁ©∫ÂõæÁâá">Ê∏ÖÁ©∫ÂõæÁâá</button>
                        </div>

                        <div class="chat-input-row">
                            <textarea id="comment-chat-input" class="chat-textarea chat-message-input"
                                :value="sessionChatInputText" @input="onSessionChatInput"
                                @keydown="onSessionChatKeydown" @compositionstart="onSessionChatCompositionStart"
                                @compositionupdate="onSessionChatCompositionUpdate"
                                @compositionend="onSessionChatCompositionEnd" @paste="onSessionChatPaste"
                                placeholder="ËæìÂÖ•Ê∂àÊÅØ... (Enter ÂèëÈÄÅ, Shift+Enter Êç¢Ë°å)" rows="2"
                                aria-label="ËØÑËÆ∫ËÅäÂ§©ËæìÂÖ•Ê°Ü"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‰º†ÁªüËØÑËÆ∫ÂàóË°®ÔºàÈùû‰ºöËØùÊ®°ÂºèÔºâ -->
            <div v-else-if="!isSessionChatMode && renderComments && renderComments.length > 0" class="comment-list"
                role="list">
                <!-- Ë∞ÉËØï‰ø°ÊÅØ -->
                <div v-if="false" class="debug-info"
                    style="background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; font-size: 12px;">
                    <p>Ë∞ÉËØï‰ø°ÊÅØ:</p>
                    <p>ËØÑËÆ∫Êï∞Èáè: {{ renderComments.length }}</p>
                    <p>Êñá‰ª∂‰ø°ÊÅØ: {{ file ? file.name : 'Êó†Êñá‰ª∂' }}</p>
                    <p>Âä†ËΩΩÁä∂ÊÄÅ: {{ loading }}</p>
                    <p>ÈîôËØØ‰ø°ÊÅØ: {{ error }}</p>
                </div>
                <article v-for="comment in renderComments" :key="comment.key" class="comment-item"
                    :class="getCommentStatusClass(comment.status)" role="listitem">
                    <!-- ËØÑËÆ∫Â§¥ÈÉ® -->
                    <div class="comment-header-section">
                        <div class="comment-meta">
                            <div class="comment-author-info">
                                <div class="comment-avatar" :style="getAuthorAvatar(comment.author)">
                                    {{ getAuthorAvatar(comment.author).text }}
                                </div>
                                <div class="comment-author-details">
                                    <span class="comment-author">{{ comment.author }}</span>
                                    <time class="comment-time" :datetime="comment.timestamp">
                                        {{ formatTime(comment.timestamp) }}
                                    </time>
                                </div>
                            </div>

                            <!-- ËØÑËÆ∫Á±ªÂûãÂíåÁä∂ÊÄÅ -->
                            <div class="comment-badges">
                                <span v-if="comment.type" class="comment-type" :class="`type-${comment.type}`">
                                    <i :class="getCommentTypeIcon(comment.type)"></i>
                                    {{ getCommentTypeLabel(comment.type) }}
                                </span>
                                <span v-if="comment.status" class="comment-status" :class="`status-${comment.status}`">
                                    <i :class="getCommentStatusIcon(comment.status)"></i>
                                    {{ getCommentStatusLabel(comment.status) }}
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- ËØÑËÆ∫ÂÜÖÂÆπ -->
                    <div class="comment-body">
                        <!-- ÂõæÁâáÊ∂àÊÅØÔºàÁ±ª‰ºº‰ºöËØùËÅäÂ§©Ôºâ -->
                        <div v-if="Array.isArray(comment.imageDataUrls) && comment.imageDataUrls.length > 0"
                            class="chat-images comment-images">
                            <img v-for="(src, imgIdx) in comment.imageDataUrls" :key="`${comment.key}_img_${imgIdx}`"
                                class="chat-image" :src="src" alt="ËØÑËÆ∫ÂõæÁâá" />
                        </div>
                        <img v-else-if="comment.imageDataUrl" class="chat-image comment-image"
                            :src="comment.imageDataUrl" alt="ËØÑËÆ∫ÂõæÁâá" />

                        <div v-if="comment.text && comment.text !== comment.content" class="comment-quote">
                            <div class="quote-header">
                                <i class="fas fa-quote-left"></i>
                                <span>ÂºïÁî®‰ª£Á†Å</span>
                            </div>
                            <pre class="quote-code" role="button" tabindex="0" title="ÊâìÂºÄÂπ∂ÂÆö‰ΩçÂà∞ÂºïÁî®‰ΩçÁΩÆ"
                                @click="openFileAtAnchor(comment)" @keydown.enter="openFileAtAnchor(comment)"
                                @keydown.space.prevent="openFileAtAnchor(comment)">{{ comment.text }}</pre>
                        </div>
                        <!-- ËØÑËÆ∫ÂÜÖÂÆπÂ±ïÁ§∫ -->
                        <div class="comment-content md-preview-body" v-html="renderMarkdown(comment.content)"></div>

                        <!-- ÊîπËøõ‰ª£Á†ÅÂ±ïÁ§∫Âå∫ÂüüÔºå‰ªÖÂΩìÊúâÊîπËøõ‰ª£Á†ÅÊó∂ÊòæÁ§∫ -->
                        <div v-if="comment.improvementText" class="comment-improvement">
                            <div class="improvement-header">
                                <i class="fas fa-magic"></i>
                                <span>ÊîπËøõ‰ª£Á†Å</span>
                            </div>
                            <pre class="improvement-code">{{ comment.improvementText }}</pre>
                        </div>

                        <!-- ËØÑËÆ∫Êìç‰ΩúÔºàÁ±ª‰ºº‰ºöËØùËÅäÂ§©ÁöÑÊìç‰ΩúÊåâÈíÆÔºâ -->
                        <div class="comment-actions comment-chat-actions">
                            <!-- ÂèëÈÄÅÂà∞Êú∫Âô®‰∫∫ÊåâÈíÆ -->
                            <template
                                v-if="Array.isArray(sessionChatWeChatRobots) && sessionChatWeChatRobots.length > 0 && comment.author !== 'ÊâãÂä®ËØÑËÆ∫'">
                                <button v-for="(bot, bi) in sessionChatWeChatRobots" :key="bot.id || ('wrb_' + bi)"
                                    type="button" class="chat-meta-btn comment-action-btn"
                                    :title="'ÂèëÈÄÅÂà∞Ôºö' + (bot.name || 'Êú∫Âô®‰∫∫')" :aria-label="'ÂèëÈÄÅÂà∞Êú∫Âô®‰∫∫Ôºö' + (bot.name || 'Êú∫Âô®‰∫∫')"
                                    @click="sendCommentToRobot(bot, comment)">{{ bot.name || 'Êú∫Âô®‰∫∫' }}</button>
                            </template>

                            <!-- ÁºñËæëÊåâÈíÆ -->
                            <button type="button" v-if="comment.author === 'ÊâãÂä®ËØÑËÆ∫'" @click="openCommentEditor(comment)"
                                class="chat-meta-btn comment-action-btn" title="ÁºñËæëËØÑËÆ∫" aria-label="ÁºñËæëËØÑËÆ∫">
                                ‚úèÔ∏è ÁºñËæë
                            </button>

                            <!-- Áä∂ÊÄÅÂàáÊç¢ÊåâÈíÆ -->
                            <button type="button" v-if="comment.status === 'pending'"
                                @click="resolveComment(comment.key)"
                                class="chat-meta-btn comment-action-btn action-resolve" title="Ê†áËÆ∞‰∏∫Â∑≤Ëß£ÂÜ≥"
                                aria-label="Ê†áËÆ∞‰∏∫Â∑≤Ëß£ÂÜ≥">
                                ‚úì Ëß£ÂÜ≥
                            </button>

                            <button type="button" v-if="comment.status === 'resolved'"
                                @click="reopenComment(comment.key)"
                                class="chat-meta-btn comment-action-btn action-reopen" title="ÈáçÊñ∞ÊâìÂºÄ" aria-label="ÈáçÊñ∞ÊâìÂºÄ">
                                ‚Ü∫ ÈáçÂºÄ
                            </button>

                            <!-- Âà†Èô§ÊåâÈíÆ -->
                            <button type="button" @click="deleteComment(comment.key)"
                                class="chat-meta-btn comment-action-btn action-delete"
                                :class="{ 'deleting': deletingComments[comment.key] }"
                                :disabled="deletingComments[comment.key]" title="Âà†Èô§ËØÑËÆ∫"
                                :aria-label="`Âà†Èô§ËØÑËÆ∫ ${comment.author}`">
                                üóëÔ∏è {{ deletingComments[comment.key] ? 'Âà†Èô§‰∏≠...' : 'Âà†Èô§' }}
                            </button>
                        </div>
                    </div>
                </article>
            </div>

            <!-- Âä†ËΩΩÁä∂ÊÄÅ - ‰ºòÂÖàÊòæÁ§∫ -->
            <div v-if="commentsLoading" class="loading-container" role="status" aria-live="polite">
                <div class="loading-spinner" aria-hidden="true"></div>
                <div class="loading-text">Ê≠£Âú®Âä†ËΩΩËØÑËÆ∫...</div>
            </div>

            <!-- Êú™ÈÄâ‰∏≠Êñá‰ª∂Áä∂ÊÄÅ -->
            <div v-else-if="!file && (!renderComments || renderComments.length === 0)" class="no-file-state"
                role="status">
                <div class="no-file-icon" aria-hidden="true">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="no-file-title">Êú™ÈÄâ‰∏≠Êñá‰ª∂</div>
                <div class="no-file-subtitle">ËØ∑‰ªéÂ∑¶‰æßÊñá‰ª∂Ê†ë‰∏≠ÈÄâÊã©‰∏Ä‰∏™Êñá‰ª∂Êù•Êü•ÁúãËØÑËÆ∫</div>
            </div>

            <!-- Êó†ËØÑËÆ∫Áä∂ÊÄÅ -->
            <div v-else-if="file && (!renderComments || renderComments.length === 0)" class="no-comments-state"
                role="status">
                <div class="no-comments-icon" aria-hidden="true">
                    <i class="fas fa-comment-slash"></i>
                </div>
                <div class="no-comments-title">ÊöÇÊó†ËØÑËÆ∫</div>
                <div class="no-comments-subtitle">ÂºÄÂßã‰ª£Á†ÅËØÑÂÆ°ÔºåÊ∑ªÂä†Á¨¨‰∏Ä‰∏™ËØÑËÆ∫</div>
            </div>
        </div>
    </div>

    <!-- ‰º†ÁªüËØÑËÆ∫ÂàóË°®ÁöÑ‰∏ä‰∏ãÊñáÁºñËæëÂô® -->
    <div v-if="commentChatContextEditorVisible" class="aicr-session-context-modal" role="dialog" aria-modal="true"
        aria-label="ËØÑËÆ∫‰∏ä‰∏ãÊñáÁºñËæëÂô®">
        <div class="aicr-session-context-modal-mask" @click="closeCommentChatContextEditor"></div>
        <div class="aicr-session-context-modal-body">
            <div class="aicr-session-context-modal-header">
                <div class="aicr-session-context-modal-title">
                    ËØÑËÆ∫‰∏ä‰∏ãÊñá
                    <span class="aicr-session-context-modal-subtitle">ÔºàMarkdownÔºâ</span>
                </div>
                <div class="aicr-session-context-modal-header-right">
                    <div class="aicr-session-context-mode-group" role="tablist" aria-label="‰∏ä‰∏ãÊñáËßÜÂõæÂàáÊç¢">
                        <button type="button" class="aicr-session-context-mode-btn"
                            :class="{ active: commentChatContextEditMode === 'split' }"
                            @click="commentChatContextEditMode = 'split'" role="tab" aria-label="Âπ∂Êéí">Âπ∂Êéí</button>
                        <button type="button" class="aicr-session-context-mode-btn"
                            :class="{ active: commentChatContextEditMode === 'edit' }"
                            @click="commentChatContextEditMode = 'edit'" role="tab" aria-label="‰ªÖÁºñËæë">‰ªÖÁºñËæë</button>
                        <button type="button" class="aicr-session-context-mode-btn"
                            :class="{ active: commentChatContextEditMode === 'preview' }"
                            @click="commentChatContextEditMode = 'preview'" role="tab" aria-label="‰ªÖÈ¢ÑËßà">‰ªÖÈ¢ÑËßà</button>
                    </div>
                    <button type="button" class="aicr-session-context-toolbar-btn" @click="copyCommentChatContext"
                        title="Â§çÂà∂ÂÜÖÂÆπ" aria-label="Â§çÂà∂ÂÜÖÂÆπ">Â§çÂà∂</button>
                    <button type="button" class="aicr-session-context-toolbar-btn primary"
                        @click="saveCommentChatContext" title="‰øùÂ≠ò‰øÆÊîπ" aria-label="‰øùÂ≠ò‰øÆÊîπ">‰øùÂ≠ò</button>
                    <button type="button" class="aicr-session-context-modal-close"
                        @click="closeCommentChatContextEditor" aria-label="ÂÖ≥Èó≠">‚úï</button>
                </div>
            </div>
            <div class="aicr-session-context-modal-content">
                <div class="aicr-session-context-editor-body" :data-mode="commentChatContextEditMode">
                    <div v-if="commentChatContextEditMode === 'split'" class="aicr-session-context-split">
                        <textarea class="aicr-session-context-textarea" :value="commentChatEditingContext"
                            @input="commentChatEditingContext = $event.target.value" aria-label="ËØÑËÆ∫‰∏ä‰∏ãÊñáÂÜÖÂÆπ"></textarea>
                        <div class="aicr-session-context-preview md-preview-body"
                            v-html="renderMarkdown(commentChatEditingContext)" aria-label="ËØÑËÆ∫‰∏ä‰∏ãÊñáÈ¢ÑËßà"></div>
                    </div>
                    <textarea v-else-if="commentChatContextEditMode === 'edit'" class="aicr-session-context-textarea"
                        :value="commentChatEditingContext" @input="commentChatEditingContext = $event.target.value"
                        aria-label="ËØÑËÆ∫‰∏ä‰∏ãÊñáÂÜÖÂÆπ"></textarea>
                    <div v-else class="aicr-session-context-preview md-preview-body"
                        v-html="renderMarkdown(commentChatEditingContext)" aria-label="ËØÑËÆ∫‰∏ä‰∏ãÊñáÈ¢ÑËßà"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ‰º†ÁªüËØÑËÆ∫ÂàóË°®ÁöÑÂ∏∏ËßÅÈóÆÈ¢òÈù¢ÊùøÔºàÂ§çÁî®‰ºöËØùËÅäÂ§©ÁöÑÈÄªËæëÔºâ -->
    <div v-if="commentChatFaqVisible" class="aicr-session-context-modal" role="dialog" aria-modal="true"
        aria-label="Â∏∏ËßÅÈóÆÈ¢ò">
        <div class="aicr-session-context-modal-mask" @click="closeCommentChatFaq"></div>
        <div class="aicr-session-context-modal-body aicr-session-faq-modal-body">
            <div class="aicr-session-context-modal-header">
                <div class="aicr-session-context-modal-title">
                    üí° Â∏∏ËßÅÈóÆÈ¢ò
                    <span class="aicr-session-context-modal-subtitle">Ôºà‰∏ÄÈîÆÊèíÂÖ•ËØÑËÆ∫Ôºâ</span>
                </div>
                <div class="aicr-session-context-modal-header-right">
                    <button type="button" class="aicr-session-context-modal-close" @click="closeCommentChatFaq"
                        aria-label="ÂÖ≥Èó≠">‚úï</button>
                </div>
            </div>
            <div class="aicr-session-context-modal-content">
                <div class="aicr-session-faq-empty">Â∏∏ËßÅÈóÆÈ¢òÂäüËÉΩÂç≥Â∞ÜÊé®Âá∫</div>
            </div>
        </div>
    </div>

    <!-- ‰º†ÁªüËØÑËÆ∫ÂàóË°®ÁöÑÂæÆ‰ø°Êú∫Âô®‰∫∫ËÆæÁΩÆ -->
    <div v-if="commentChatWeChatSettingsVisible" class="aicr-session-context-modal" role="dialog" aria-modal="true"
        aria-label="ÂæÆ‰ø°Êú∫Âô®‰∫∫ËÆæÁΩÆ">
        <div class="aicr-session-context-modal-mask" @click="closeCommentChatWeChatSettings"></div>
        <div class="aicr-session-context-modal-body aicr-session-settings-modal-body">
            <div class="aicr-session-context-modal-header">
                <div class="aicr-session-context-modal-title">
                    ü§ñ ÂæÆ‰ø°Êú∫Âô®‰∫∫
                    <span class="aicr-session-context-modal-subtitle">ÔºàÂΩìÂâçÊµèËßàÂô®Êú¨Âú∞Ôºâ</span>
                </div>
                <div class="aicr-session-context-modal-header-right">
                    <button type="button" class="aicr-session-context-toolbar-btn primary"
                        @click="saveCommentChatWeChatSettings" aria-label="‰øùÂ≠ò" title="‰øùÂ≠ò">‰øùÂ≠ò</button>
                    <button type="button" class="aicr-session-context-modal-close"
                        @click="closeCommentChatWeChatSettings" aria-label="ÂÖ≥Èó≠">‚úï</button>
                </div>
            </div>
            <div class="aicr-session-context-modal-content aicr-session-settings-modal-content">
                <div class="aicr-session-settings-field">
                    <p>ÂæÆ‰ø°Êú∫Âô®‰∫∫ËÆæÁΩÆ‰∏é‰ºöËØùËÅäÂ§©ÂÖ±‰∫´ÔºåËØ∑Âú®‰ºöËØùËßÜÂõæ‰∏≠ÈÖçÁΩÆ„ÄÇ</p>
                    <button type="button" class="aicr-session-context-toolbar-btn"
                        @click="closeCommentChatWeChatSettings" aria-label="ÂÖ≥Èó≠">Áü•ÈÅì‰∫Ü</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‰º†ÁªüËØÑËÆ∫ÂàóË°®ÁöÑAIËÆæÁΩÆ -->
    <div v-if="commentChatSettingsVisible" class="aicr-session-context-modal" role="dialog" aria-modal="true"
        aria-label="AIËÆæÁΩÆ">
        <div class="aicr-session-context-modal-mask" @click="closeCommentChatSettings"></div>
        <div class="aicr-session-context-modal-body aicr-session-settings-modal-body">
            <div class="aicr-session-context-modal-header">
                <div class="aicr-session-context-modal-title">
                    ‚öôÔ∏è AI ËÆæÁΩÆ
                    <span class="aicr-session-context-modal-subtitle">ÔºàÂΩìÂâçÊµèËßàÂô®Êú¨Âú∞Ôºâ</span>
                </div>
                <div class="aicr-session-context-modal-header-right">
                    <button type="button" class="aicr-session-context-toolbar-btn primary"
                        @click="saveCommentChatSettings" aria-label="‰øùÂ≠ò" title="‰øùÂ≠ò">‰øùÂ≠ò</button>
                    <button type="button" class="aicr-session-context-modal-close" @click="closeCommentChatSettings"
                        aria-label="ÂÖ≥Èó≠">‚úï</button>
                </div>
            </div>
            <div class="aicr-session-context-modal-content aicr-session-settings-modal-content">
                <div class="aicr-session-settings-field">
                    <p>AI ËÆæÁΩÆ‰∏é‰ºöËØùËÅäÂ§©ÂÖ±‰∫´ÔºåËØ∑Âú®‰ºöËØùËßÜÂõæ‰∏≠ÈÖçÁΩÆ„ÄÇ</p>
                    <button type="button" class="aicr-session-context-toolbar-btn" @click="closeCommentChatSettings"
                        aria-label="ÂÖ≥Èó≠">Áü•ÈÅì‰∫Ü</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‰ºöËØùÈ°µÈù¢‰∏ä‰∏ãÊñáÁºñËæëÂô® -->
    <div v-if="sessionChatContextEditorVisible" class="aicr-session-context-modal" role="dialog" aria-modal="true"
        aria-label="È°µÈù¢‰∏ä‰∏ãÊñáÁºñËæëÂô®">
        <div class="aicr-session-context-modal-mask" @click="closeSessionChatContextEditor"></div>
        <div class="aicr-session-context-modal-body">
            <div class="aicr-session-context-modal-header">
                <div class="aicr-session-context-modal-title">
                    È°µÈù¢‰∏ä‰∏ãÊñá
                    <span class="aicr-session-context-modal-subtitle">ÔºàMarkdownÔºâ</span>
                </div>
                <div class="aicr-session-context-modal-header-right">
                    <div class="aicr-session-context-mode-group" role="tablist" aria-label="‰∏ä‰∏ãÊñáËßÜÂõæÂàáÊç¢">
                        <button type="button" class="aicr-session-context-mode-btn"
                            :class="{ active: sessionChatContextEditMode === 'split' }"
                            @click="sessionChatContextEditMode = 'split'" role="tab"
                            :aria-selected="sessionChatContextEditMode === 'split'" aria-label="Âπ∂Êéí">Âπ∂Êéí</button>
                        <button type="button" class="aicr-session-context-mode-btn"
                            :class="{ active: sessionChatContextEditMode === 'edit' }"
                            @click="sessionChatContextEditMode = 'edit'" role="tab"
                            :aria-selected="sessionChatContextEditMode === 'edit'" aria-label="‰ªÖÁºñËæë">‰ªÖÁºñËæë</button>
                        <button type="button" class="aicr-session-context-mode-btn"
                            :class="{ active: sessionChatContextEditMode === 'preview' }"
                            @click="sessionChatContextEditMode = 'preview'" role="tab"
                            :aria-selected="sessionChatContextEditMode === 'preview'" aria-label="‰ªÖÈ¢ÑËßà">‰ªÖÈ¢ÑËßà</button>
                    </div>
                    <button type="button" class="aicr-session-context-toolbar-btn" @click="copySessionChatContextDraft"
                        title="Â§çÂà∂ÂÜÖÂÆπ" aria-label="Â§çÂà∂ÂÜÖÂÆπ">Â§çÂà∂</button>
                    <button type="button" class="aicr-session-context-toolbar-btn primary"
                        @click="saveSessionChatPageContext" title="‰øùÂ≠ò‰øÆÊîπ" aria-label="‰øùÂ≠ò‰øÆÊîπ">‰øùÂ≠ò</button>
                    <button type="button" class="aicr-session-context-modal-close"
                        @click="closeSessionChatContextEditor" aria-label="ÂÖ≥Èó≠">‚úï</button>
                </div>
            </div>
            <div class="aicr-session-context-modal-content">
                <div class="aicr-session-context-editor-body" :data-mode="sessionChatContextEditMode">
                    <div v-if="sessionChatContextEditMode === 'split'" class="aicr-session-context-split">
                        <textarea class="aicr-session-context-textarea" :value="sessionChatEditingPageContent"
                            @input="sessionChatEditingPageContent = $event.target.value"
                            aria-label="È°µÈù¢‰∏ä‰∏ãÊñáÂÜÖÂÆπ"></textarea>
                        <div class="aicr-session-context-preview md-preview-body"
                            v-html="renderSessionChatMarkdown(sessionChatEditingPageContent)" aria-label="È°µÈù¢‰∏ä‰∏ãÊñáÈ¢ÑËßà">
                        </div>
                    </div>
                    <textarea v-else-if="sessionChatContextEditMode === 'edit'" class="aicr-session-context-textarea"
                        :value="sessionChatEditingPageContent"
                        @input="sessionChatEditingPageContent = $event.target.value" aria-label="È°µÈù¢‰∏ä‰∏ãÊñáÂÜÖÂÆπ"></textarea>
                    <div v-else class="aicr-session-context-preview md-preview-body"
                        v-html="renderSessionChatMarkdown(sessionChatEditingPageContent)" aria-label="È°µÈù¢‰∏ä‰∏ãÊñáÈ¢ÑËßà"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ËØÑËÆ∫ÁºñËæëÊ®°ÊÄÅÊ°ÜÔºàÊ∂àÊÅØÂØπËØùÊ®°ÂºèÔºâ -->
    <div v-if="showCommentEditor" class="comment-editor-modal editing-comment-chat-modal" @click="closeCommentEditor">
        <div class="comment-editor-content editing-comment-chat-content" @click.stop>
            <div class="editor-header editing-comment-chat-header">
                <div class="editor-header-left">
                    <h3 class="editor-title">ÁºñËæëËØÑËÆ∫</h3>
                    <div class="editor-meta">
                        <input v-model="editingCommentAuthor" type="text" class="editor-meta-input" placeholder="ËØÑËÆ∫ËÄÖ" />
                        <input v-model="editingCommentTimestamp" type="datetime-local" class="editor-meta-input"
                            aria-label="ËØÑËÆ∫Êó∂Èó¥" />
                        <select v-model="editingCommentType" class="editor-meta-select" aria-label="ËØÑËÆ∫Á±ªÂûã">
                            <option value="">Á±ªÂûã</option>
                            <option value="suggestion">Âª∫ËÆÆ</option>
                            <option value="question">ÈóÆÈ¢ò</option>
                            <option value="bug">ÈîôËØØ</option>
                            <option value="discussion">ËÆ®ËÆ∫</option>
                            <option value="praise">Ë°®Êâ¨</option>
                            <option value="nitpick">ÁªÜËäÇ</option>
                        </select>
                        <select v-model="editingCommentStatus" class="editor-meta-select" aria-label="ËØÑËÆ∫Áä∂ÊÄÅ">
                            <option value="pending">ÂæÖÂ§ÑÁêÜ</option>
                            <option value="resolved">Â∑≤Ëß£ÂÜ≥</option>
                            <option value="closed">Â∑≤ÂÖ≥Èó≠</option>
                            <option value="wontfix">‰∏ç‰øÆÂ§ç</option>
                        </select>
                    </div>
                </div>
                <div class="editor-header-right">
                    <button type="button" @click="saveEditedComment" class="save-btn" :disabled="editingSaving"
                        title="‰øùÂ≠ò (Ctrl/Cmd + Enter)">
                        <i class="fas fa-save"></i>
                        ‰øùÂ≠ò
                    </button>
                    <button type="button" @click="closeCommentEditor" class="close-btn" title="ÂÖ≥Èó≠ (Esc)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <div class="editor-body editing-comment-chat-body">
                <!-- Ê∂àÊÅØÂàóË°® -->
                <div class="editing-comment-messages aicr-session-chat-messages" role="log" aria-live="polite">
                    <div v-for="(m, idx) in editingCommentMessagesList" :key="`editing_${m.timestamp || 0}_${idx}`"
                        class="chat-message" :class="{
                            'is-pet': m.type === 'pet',
                            'is-user': m.type !== 'user',
                            'is-original': m._isOriginal
                        }" :data-chat-idx="idx" :data-chat-timestamp="m.timestamp || 0"
                        :data-chat-type="m.type === 'pet' ? 'pet' : 'user'">
                        <div class="chat-bubble">
                            <div v-if="Array.isArray(m.imageDataUrls) && m.imageDataUrls.length > 0"
                                class="chat-images">
                                <img v-for="(src, imgIdx) in m.imageDataUrls" :key="`${m.timestamp || 0}_${imgIdx}`"
                                    class="chat-image" :src="src" alt="ÂõæÁâáÊ∂àÊÅØ" />
                            </div>
                            <img v-else-if="m.imageDataUrl" class="chat-image" :src="m.imageDataUrl" alt="ÂõæÁâáÊ∂àÊÅØ" />
                            <div v-if="(m.message || m.content) && String(m.message || m.content).trim()"
                                class="chat-content md-preview-body"
                                v-html="renderSessionChatMarkdown(m.message || m.content)"></div>
                            <div class="chat-meta">
                                <div class="chat-meta-actions">
                                    <button v-if="(m.message || m.content) && String(m.message || m.content).trim()"
                                        type="button" class="chat-meta-btn" @click="copyEditingCommentMessage(m, idx)"
                                        aria-label="Â§çÂà∂Ê∂àÊÅØ" title="Â§çÂà∂">{{ getEditingCommentCopyButtonLabel(m, idx)
                                        }}</button>
                                    <button v-if="m.type === 'user'" type="button" class="chat-meta-btn"
                                        :disabled="editingCommentSending" @click="editEditingCommentMessage(idx)"
                                        aria-label="ÁºñËæëÊ∂àÊÅØ" title="ÁºñËæë">‚úèÔ∏è</button>
                                    <button v-if="m.type === 'user' && !m._isOriginal" type="button"
                                        class="chat-meta-btn" :disabled="editingCommentSending"
                                        @click="deleteEditingCommentMessage(idx)" aria-label="Âà†Èô§Ê∂àÊÅØ"
                                        title="Âà†Èô§">üóëÔ∏è</button>
                                </div>
                                <time class="chat-time" :datetime="m.timestamp">{{ formatTime(m.timestamp) }}</time>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Âà†Èô§Á°ÆËÆ§ÂØπËØùÊ°Ü -->
    <div v-if="showDeleteDialog" class="delete-confirmation-dialog show" role="dialog"
        aria-labelledby="delete-dialog-title" aria-modal="true">
        <div class="dialog-overlay" @click="cancelDelete"></div>
        <div class="dialog-content">
            <div class="dialog-header">
                <i class="fas fa-exclamation-triangle"></i>
                <h3 id="delete-dialog-title">Á°ÆËÆ§Âà†Èô§ËØÑËÆ∫</h3>
            </div>
            <div class="dialog-body">
                <p>Á°ÆÂÆöË¶ÅÂà†Èô§ <strong>{{ deleteTargetAuthor }}</strong> ÁöÑËØÑËÆ∫ÂêóÔºü</p>
                <p class="warning-text">Ê≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºåËØ∑Ë∞®ÊÖéÊìç‰Ωú„ÄÇ</p>
            </div>
            <div class="dialog-actions">
                <button class="btn-cancel" @click="cancelDelete" aria-label="ÂèñÊ∂àÂà†Èô§">ÂèñÊ∂à</button>
                <button class="btn-confirm" @click="confirmDelete" aria-label="Á°ÆËÆ§Âà†Èô§">Á°ÆËÆ§Âà†Èô§</button>
            </div>
        </div>
    </div>
</aside>