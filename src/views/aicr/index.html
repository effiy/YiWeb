<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YiWeb - ‰ª£Á†ÅÂÆ°Êü•</title>
    <link rel="stylesheet" href="../../views/aicr/index.css">
    <link rel="stylesheet" href="../../views/aicr/components/sessionList/index.css">
    <link rel="stylesheet" href="../../libs/font-awesome/css/all.min.css">
    <script src="../../libs/vue/vue.global.js"></script>
    <!-- Highlight.js for Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- Marked.js for Markdown rendering -->
    <script src="../../libs/marked/marked.min.js"></script>
    <!-- Mermaid.js for diagram rendering -->
    <script src="../../libs/mermaid/mermaid.min.js"></script>
</head>
<body>
    <div id="app">
      <!-- È°∂ÈÉ®ÊêúÁ¥¢‰∏éÂàÜÁ±ªÂå∫Âüü -->
      <header class="header-row" role="banner">
        <section class="search-row">
            <form class="search-box" role="search" aria-label="‰ª£Á†ÅÂÆ°Êü•ÊêúÁ¥¢">
                <span class="search-logo" aria-hidden="true" @click="openLink('/index.html')">
                    <i class="fas fa-globe" aria-label="‰ª£Á†ÅÂÆ°Êü•ÂõæÊ†á"></i>
                </span>
                <div class="search-input-wrapper">
                    <label for="messageInput" class="visually-hidden">ÊêúÁ¥¢ËæìÂÖ•Ê°Ü</label>
                    <textarea 
                        id="messageInput" 
                        placeholder="ÊêúÁ¥¢ÁΩëÁ´ô„ÄÅÊ†áÁ≠æÊàñÊèèËø∞..." 
                        rows="1" 
                        maxlength="2000"
                        aria-label="ÊêúÁ¥¢ËæìÂÖ•Ê°Ü"
                        aria-describedby="category-filters"
                        autocomplete="off"
                        spellcheck="false"
                        @keydown="handleMessageInput"
                        @compositionstart="handleCompositionStart"
                        @compositionend="handleCompositionEnd"
                        @input="handleSearchInput"></textarea>
                    
                    <!-- Ê∏ÖÈô§ÊêúÁ¥¢ÊåâÈíÆ -->
                    <div class="search-clear" v-if="searchQueryValue">
                        <button 
                            type="button"
                            @click.prevent="clearSearch"
                            class="clear-search-btn"
                            title="Ê∏ÖÈô§ÊêúÁ¥¢"
                            aria-label="Ê∏ÖÈô§ÊêúÁ¥¢ÂÜÖÂÆπ"
                        >
                            <i class="fas fa-times" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
            </form>
            
            <!-- È°πÁõÆÈÄâÊã©Âô® -->
            <nav class="category-filters" id="category-filters" role="toolbar" aria-label="È°πÁõÆËøáÊª§Âô®">
                <ul class="filter-buttons">

                </ul>
            </nav>
            
        </section>
        </header>
        <main class="aicr-main">
            <!-- ‰æßËæπÊ†èÂ±ïÂºÄÊääÊâã (Êî∂Ëµ∑Êó∂ÊòæÁ§∫) -->
            <button 
                type="button"
                class="sidebar-expand-handle"
                v-show="sidebarCollapsed"
                @click="toggleSidebar"
                aria-label="Â±ïÂºÄ‰æßËæπÊ†è"
                title="Â±ïÂºÄ‰æßËæπÊ†è">
                <i class="fas fa-chevron-right" aria-hidden="true"></i>
                <span class="label">Â±ïÂºÄ</span>
            </button>

            <!-- ‰æßËæπÊ†èÊî∂Ëµ∑ÊåâÈíÆ (Â±ïÂºÄÊó∂ÊòæÁ§∫ÔºåË∑üÈöè‰æßËæπÊ†èÂÆΩÂ∫¶) -->
            <div 
                class="file-tree-toggle" 
                v-show="!sidebarCollapsed"
                @click="toggleSidebar"
                title="Êî∂Ëµ∑‰æßËæπÊ†è"
                :style="{ left: (sidebarWidth - 14) + 'px', right: 'auto' }">
                <i class="fas fa-chevron-left"></i>
            </div>

            <aside class="aicr-sidebar" aria-label="‰æßËæπÊ†è" v-show="!sidebarCollapsed" :style="{ width: sidebarWidth + 'px' }">
                <!-- ÂÖ±‰∫´ÊêúÁ¥¢ÂÆπÂô®Ôºà‰∏§ÁßçËßÜÂõæÊ®°ÂºèÂÖ±Áî®Ôºâ -->
                <div v-if="!sidebarCollapsed" class="file-tree-header-container">

                    
                    <!-- ÊêúÁ¥¢ËæìÂÖ•Ê°ÜÂíåËßÜÂõæÂàáÊç¢ -->
                    <div class="file-tree-search-container">
                        <div class="file-tree-search-wrapper">
                            <span class="file-tree-search-icon">üîç</span>
                            <input
                                type="text"
                                class="file-tree-search-input"
                                :value="viewMode === 'tree' ? (searchQuery || '') : (sessionSearchQuery || '')"
                                @input="viewMode === 'tree' ? handleSearchInput($event) : handleSessionSearchChange($event.target.value)"
                                @keydown.esc="viewMode === 'tree' ? clearSearch() : handleSessionSearchChange('')"
                                :placeholder="viewMode === 'tree' ? 'ÊêúÁ¥¢Êñá‰ª∂...' : 'ÊêúÁ¥¢‰ºöËØù...'"
                                aria-label="ÊêúÁ¥¢"
                            />
                            <button
                                v-if="(viewMode === 'tree' && searchQuery) || (viewMode === 'tags' && sessionSearchQuery)"
                                class="file-tree-search-clear"
                                @click="viewMode === 'tree' ? clearSearch() : handleSessionSearchChange('')"
                                type="button"
                                aria-label="Ê∏ÖÈô§ÊêúÁ¥¢"
                                title="Ê∏ÖÈô§ÊêúÁ¥¢ (ESC)"
                            >
                                ‚úï
                            </button>
                            <!-- ËßÜÂõæÂàáÊç¢ÊåâÈíÆÔºàÈõÜÊàêÂú®ÊêúÁ¥¢Ê°ÜÂÜÖÔºâ -->
                            <div class="view-mode-toggle">
                                <button 
                                    type="button"
                                    class="view-mode-btn"
                                    :class="{ 'active': viewMode === 'tree' }"
                                    @click="setViewMode('tree')"
                                    :disabled="loading"
                                    title="Ê†ëÂΩ¢ËßÜÂõæ"
                                    aria-label="ÂàáÊç¢Âà∞Ê†ëÂΩ¢ËßÜÂõæ">
                                    <i class="fas fa-sitemap" aria-hidden="true"></i>
                                </button>
                                <button 
                                    type="button"
                                    class="view-mode-btn"
                                    :class="{ 'active': viewMode === 'tags' }"
                                    @click="setViewMode('tags')"
                                    :disabled="loading"
                                    title="Ê†áÁ≠æËßÜÂõæ"
                                    aria-label="ÂàáÊç¢Âà∞Ê†áÁ≠æËßÜÂõæ">
                                    <i class="fas fa-tags" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Â∑•ÂÖ∑Ê†èÔºàÂ∑≤ÁßªËá≥‰ºöËØùÂàóË°®ÁªÑ‰ª∂ÂÜÖÈÉ®Ôºâ -->
                    
                </div>
                
                <!-- Ê†ëÂΩ¢ËßÜÂõæÔºöÊòæÁ§∫Êñá‰ª∂Ê†ë -->
                <file-tree 
                    v-show="viewMode === 'tree'"
                    :tree="fileTree" 
                    :selected-key="selectedKey" 
                    :expanded-folders="expandedFolders" 
                    :loading="loading" 
                    :error="errorMessage" 
                    :comments="comments"
                    :collapsed="sidebarCollapsed"
                    :search-query="searchQuery"
                    :batch-mode="batchMode"
                    :selected-keys="selectedKeys"
                    :view-mode="viewMode"
                    :selected-tags="(selectedSessionTags && Array.isArray(selectedSessionTags)) ? selectedSessionTags : []"
                    :tag-filter-reverse="tagFilterReverse || false"
                    :tag-filter-no-tags="tagFilterNoTags || false"
                    :tag-filter-expanded="tagFilterExpanded || false"
                    :tag-filter-search-keyword="tagFilterSearchKeyword || ''"
                    @file-select="handleFileSelect"  
                    @folder-toggle="handleFolderToggle"
                    @create-folder="handleCreateFolder"
                    @create-file="handleCreateFile"
                    @rename-item="handleRenameItem"
                    @delete-item="handleDeleteItem"
                    @create-session="handleCreateSession"
                    @toggle-collapse="toggleSidebar"
                    @search-change="handleSearchChange"
                    @toggle-batch-mode="toggleBatchMode"
                    @batch-select-file="toggleFileSelection"
                    @download-project="handleDownloadProjectVersion"
                    @upload-project="handleUploadProjectVersion"
                    @view-mode-change="setViewMode"
                    @tag-select="handleTagSelect"
                    @tag-clear="handleTagClear"
                    @tag-filter-reverse="handleTagFilterReverse"
                    @tag-filter-no-tags="handleTagFilterNoTags"
                    @tag-filter-expand="handleTagFilterExpand"
                    @tag-filter-search="handleTagFilterSearch"
                ></file-tree>
                
                <!-- Ê†áÁ≠æËßÜÂõæÔºöÊòæÁ§∫‰ºöËØùÂàóË°® -->
                <session-list 
                    v-show="viewMode === 'tags'"
                    :sessions="(sessions && Array.isArray(sessions)) ? sessions : []"
                    :loading="sessionLoading || false"
                    :error="sessionError || null"
                    :selected-tags="(selectedSessionTags && Array.isArray(selectedSessionTags)) ? selectedSessionTags : []"
                    :search-query="sessionSearchQuery || ''"
                    :tag-filter-reverse="tagFilterReverse || false"
                    :tag-filter-no-tags="tagFilterNoTags || false"
                    :tag-filter-expanded="tagFilterExpanded || false"
                    :tag-filter-visible-count="tagFilterVisibleCount || 8"
                    :tag-filter-search-keyword="tagFilterSearchKeyword || ''"
                    :session-batch-mode="sessionBatchMode || false"
                    :selected-session-keys="selectedSessionKeys || new Set()"
                    :is-all-sessions-selected="isAllSessionsSelected"
                    @session-select="handleSessionSelect"
                    @session-delete="handleSessionDelete"
                    @session-create="handleSessionCreate"
                    @session-favorite="handleSessionFavorite"
                    @session-edit="handleSessionEdit"
                    @session-tag="handleSessionTag"
                    @session-duplicate="handleSessionDuplicate"
                    @session-context="handleSessionContext"
                    @session-open-url="handleSessionOpenUrl"
                    @session-tree="handleSessionTree"
                    @session-batch-select="handleSessionBatchSelect"
                    @session-batch-select-all="handleToggleSelectAllSessions"
                    @session-batch-delete="handleBatchDeleteSessions"
                    @session-batch-cancel="toggleSessionBatchMode"
                    @toggle-batch-mode="toggleSessionBatchMode"
                    @session-import-file="handleSessionImportFile"
                    @session-export="handleSessionExport"
                    @tag-select="handleTagSelect"
                    @tag-clear="handleTagClear"
                    @search-change="handleSessionSearchChange"
                    @tag-filter-reverse="handleTagFilterReverse"
                    @tag-filter-no-tags="handleTagFilterNoTags"
                    @tag-filter-expand="handleTagFilterExpand"
                    @tag-filter-search="handleTagFilterSearch"
                    @toggle-collapse="handleSessionViewBack"
                ></session-list>
            </aside>
            

            <section class="aicr-code" :class="{ 'with-sidebar-collapsed': sidebarCollapsed, 'with-comments-collapsed': commentsCollapsed }" aria-label="‰ª£Á†ÅÂå∫">
                <code-view 
                    :file="currentFile" 
                    :loading="loading" 
                    :error="errorMessage"
                    :comments="currentComments"
                    @comment-delete="handleCommentDelete"
                    @comment-resolve="handleCommentResolve"
                    @comment-reopen="handleCommentReopen"
                    @reload-comments="handleReloadComments"
                ></code-view>
            </section>
            <aside class="aicr-comments" aria-label="ËØÑËÆ∫Âå∫" v-show="!commentsCollapsed" :style="{ width: commentsWidth + 'px' }">
                <comment-panel 
                    :comments="currentComments" 
                    :file="currentFile"
                    :new-comment="newComment" 
                    :loading="loading" 
                    :error="errorMessage" 
                    :collapsed="commentsCollapsed"
                    @comment-submit="handleCommentSubmit" 
                    @comment-input="handleCommentInput"
                    @comment-delete="handleCommentDelete"
                    @comment-resolve="handleCommentResolve"
                    @comment-reopen="handleCommentReopen"
                    @toggle-collapse="toggleComments"
                ></comment-panel>
            </aside>
            <!-- ËØÑËÆ∫Âå∫Êî∂Ëµ∑ÂêéÁöÑÂ±ïÂºÄÊääÊâã -->
            <button 
                type="button"
                class="comments-expand-handle" 
                v-show="commentsCollapsed"
                @click="toggleComments"
                aria-label="Â±ïÂºÄËØÑËÆ∫Âå∫"
                title="Â±ïÂºÄËØÑËÆ∫Âå∫">
                <i class="fas fa-chevron-left" aria-hidden="true"></i>
            </button>
            
        </main>
    </div>

    <!-- ÂÖ®Â±ÄÂä†ËΩΩÊåáÁ§∫Âô® -->
    <section id="global-loading-indicator" class="loading-indicator" aria-hidden="true" aria-label="ÂÖ®Â±ÄÂä†ËΩΩ‰∏≠">
      <div class="loading-content">
          <div class="loading-spinner" role="status" aria-live="polite" aria-label="Ê≠£Âú®Âä†ËΩΩ"></div>
          <p class="loading-text" id="loading-text">Ê≠£Âú®Âä†ËΩΩ...</p>
      </div>
    </section>

    
    
    <!-- ËÑöÊú¨Ê†áÁ≠æÁßªÂà∞VueÂ∫îÁî®ÂÆπÂô®Â§ñÈÉ® -->
    <!-- Âü∫Á°ÄÈÖçÁΩÆÂíåÂ∑•ÂÖ∑ -->
    <script type="module" src="../../config.js"></script>
    <script type="module" src="../../utils/chartViewer.js"></script>
    
    <!-- Mermaid Áõ∏ÂÖ≥ËÑöÊú¨ÔºàÊåâ‰æùËµñÈ°∫Â∫èÂä†ËΩΩÔºâ -->
    <script type="module" src="../../utils/mermaid.js"></script>
    <script type="module" src="../../utils/mermaidDebug.js"></script>
    <script type="module" src="../../utils/mermaidRenderer.js"></script>
    
    <!-- Êèí‰ª∂ÁªÑ‰ª∂ -->
    <script type="module" src="../../views/aicr/components/fileTree/index.js"></script>
    <script type="module" src="../../views/aicr/components/codeView/index.js"></script>
    <script type="module" src="../../views/aicr/components/commentPanel/index.js"></script>
    <script type="module" src="../../views/aicr/components/sessionList/index.js"></script>
    
    <!-- ‰∏ªÂ∫îÁî®ÂÖ•Âè£ -->
    <script type="module" src="../../views/aicr/index.js"></script>
    
    <!-- ÊÄßËÉΩÁõëÊéßÔºàÊúÄÂêéÂä†ËΩΩÔºâ -->
    <script type="module" src="../../utils/performance.js"></script>
</body>
</html>







