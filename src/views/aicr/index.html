<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YiWeb - ‰ª£Á†ÅÂÆ°Êü•</title>
    <link rel="stylesheet" href="../../views/aicr/index.css">
    <link rel="stylesheet" href="../../views/aicr/components/sessionList/index.css">
    <link rel="stylesheet" href="../../libs/font-awesome/css/all.min.css">
    <script src="../../libs/vue/vue.global.js"></script>
    <!-- Highlight.js for Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- Marked.js for Markdown rendering -->
    <script src="../../libs/marked/marked.min.js"></script>
    <!-- Mermaid.js for diagram rendering -->
    <script src="../../libs/mermaid/mermaid.min.js"></script>
</head>
<body>
    <div id="app">
      <!-- È°∂ÈÉ®ÊêúÁ¥¢‰∏éÂàÜÁ±ªÂå∫Âüü -->
      <header class="header-row" role="banner">
        <section class="search-row">
            <form class="search-box" role="search" aria-label="‰ª£Á†ÅÂÆ°Êü•ÊêúÁ¥¢">
                <span class="search-logo" aria-hidden="true" @click="openLink('/index.html')">
                    <i class="fas fa-globe" aria-label="‰ª£Á†ÅÂÆ°Êü•ÂõæÊ†á"></i>
                </span>
                <div class="search-input-wrapper">
                    <label for="messageInput" class="visually-hidden">ÊêúÁ¥¢ËæìÂÖ•Ê°Ü</label>
                    <textarea 
                        id="messageInput" 
                        placeholder="ÊêúÁ¥¢ÁΩëÁ´ô„ÄÅÊ†áÁ≠æÊàñÊèèËø∞..." 
                        rows="1" 
                        maxlength="2000"
                        aria-label="ÊêúÁ¥¢ËæìÂÖ•Ê°Ü"
                        aria-describedby="category-filters"
                        autocomplete="off"
                        spellcheck="false"
                        @keydown="handleMessageInput"
                        @compositionstart="handleCompositionStart"
                        @compositionend="handleCompositionEnd"
                        @input="handleSearchInput"></textarea>
                    
                    <!-- Ê∏ÖÈô§ÊêúÁ¥¢ÊåâÈíÆ -->
                    <div class="search-clear" v-if="searchQueryValue">
                        <button 
                            type="button"
                            @click.prevent="clearSearch"
                            class="clear-search-btn"
                            title="Ê∏ÖÈô§ÊêúÁ¥¢"
                            aria-label="Ê∏ÖÈô§ÊêúÁ¥¢ÂÜÖÂÆπ"
                        >
                            <i class="fas fa-times" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
            </form>
            
            <!-- È°πÁõÆÈÄâÊã©Âô® -->
            <nav class="category-filters" id="category-filters" role="toolbar" aria-label="È°πÁõÆËøáÊª§Âô®">
                <ul class="filter-buttons">

                </ul>
            </nav>
            
        </section>
        </header>
        <main class="aicr-main">
            <aside class="aicr-sidebar" aria-label="‰æßËæπÊ†è" v-show="!sidebarCollapsed" :style="{ width: sidebarWidth + 'px' }">
                <!-- ÂÖ±‰∫´ÊêúÁ¥¢ÂÆπÂô®Ôºà‰∏§ÁßçËßÜÂõæÊ®°ÂºèÂÖ±Áî®Ôºâ -->
                <div v-if="!sidebarCollapsed" class="file-tree-header-container">
                    <!-- ‰ºöËØùÊâπÈáèÊìç‰ΩúÂ∑•ÂÖ∑Ê†èÔºà‰ªÖÂú®Ê†áÁ≠æËßÜÂõæÁöÑÊâπÈáèÊ®°Âºè‰∏ãÊòæÁ§∫Ôºâ -->
                    <div v-if="viewMode === 'tags' && sessionBatchMode" class="session-batch-toolbar">
                        <span class="batch-toolbar-selected-count" :class="{ 'has-selection': selectedSessionIds && selectedSessionIds.size > 0 }">
                            Â∑≤ÈÄâÊã© {{ selectedSessionIds ? selectedSessionIds.size : 0 }} ‰∏™
                        </span>
                        <button 
                            type="button"
                            class="batch-toolbar-btn batch-toolbar-select-all"
                            @click="handleToggleSelectAllSessions"
                            :title="isAllSessionsSelected ? 'ÂèñÊ∂àÂÖ®ÈÄâ' : 'ÂÖ®ÈÄâ'"
                            aria-label="ÂÖ®ÈÄâ/ÂèñÊ∂àÂÖ®ÈÄâ">
                            {{ isAllSessionsSelected ? 'ÂèñÊ∂àÂÖ®ÈÄâ' : 'ÂÖ®ÈÄâ' }}
                        </button>
                        <button 
                            type="button"
                            class="batch-toolbar-btn batch-toolbar-delete"
                            @click="handleBatchDeleteSessions"
                            :disabled="!selectedSessionIds || selectedSessionIds.size === 0"
                            :title="selectedSessionIds && selectedSessionIds.size > 0 ? `Âà†Èô§ÈÄâ‰∏≠ÁöÑ ${selectedSessionIds.size} ‰∏™‰ºöËØù` : 'ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑ‰ºöËØù'"
                            aria-label="ÊâπÈáèÂà†Èô§‰ºöËØù">
                            <i class="fas fa-trash" aria-hidden="true"></i>
                            <span>Âà†Èô§</span>
                        </button>
                        <button 
                            type="button"
                            class="batch-toolbar-btn batch-toolbar-cancel"
                            @click="toggleSessionBatchMode"
                            title="ÈÄÄÂá∫ÊâπÈáèÈÄâÊã©Ê®°Âºè"
                            aria-label="ÈÄÄÂá∫ÊâπÈáèÈÄâÊã©">
                            <i class="fas fa-times" aria-hidden="true"></i>
                            <span>ÂèñÊ∂à</span>
                        </button>
                    </div>
                    
                    <!-- ÊêúÁ¥¢ËæìÂÖ•Ê°ÜÂíåËßÜÂõæÂàáÊç¢ -->
                    <div class="file-tree-search-container">
                        <div class="file-tree-search-wrapper">
                            <span class="file-tree-search-icon">üîç</span>
                            <input
                                type="text"
                                class="file-tree-search-input"
                                :value="viewMode === 'tree' ? (searchQuery || '') : (sessionSearchQuery || '')"
                                @input="viewMode === 'tree' ? handleSearchInput($event) : handleSessionSearchChange($event.target.value)"
                                @keydown.esc="viewMode === 'tree' ? clearSearch() : handleSessionSearchChange('')"
                                :placeholder="viewMode === 'tree' ? 'ÊêúÁ¥¢Êñá‰ª∂...' : 'ÊêúÁ¥¢‰ºöËØù...'"
                                aria-label="ÊêúÁ¥¢"
                            />
                            <button
                                v-if="(viewMode === 'tree' && searchQuery) || (viewMode === 'tags' && sessionSearchQuery)"
                                class="file-tree-search-clear"
                                @click="viewMode === 'tree' ? clearSearch() : handleSessionSearchChange('')"
                                type="button"
                                aria-label="Ê∏ÖÈô§ÊêúÁ¥¢"
                                title="Ê∏ÖÈô§ÊêúÁ¥¢ (ESC)"
                            >
                                ‚úï
                            </button>
                            <!-- ËßÜÂõæÂàáÊç¢ÊåâÈíÆÔºàÈõÜÊàêÂú®ÊêúÁ¥¢Ê°ÜÂÜÖÔºâ -->
                            <div class="view-mode-toggle">
                                <button 
                                    type="button"
                                    class="view-mode-btn"
                                    :class="{ 'active': viewMode === 'tree' }"
                                    @click="setViewMode('tree')"
                                    :disabled="loading"
                                    title="Ê†ëÂΩ¢ËßÜÂõæ"
                                    aria-label="ÂàáÊç¢Âà∞Ê†ëÂΩ¢ËßÜÂõæ">
                                    <i class="fas fa-sitemap" aria-hidden="true"></i>
                                </button>
                                <button 
                                    type="button"
                                    class="view-mode-btn"
                                    :class="{ 'active': viewMode === 'tags' }"
                                    @click="setViewMode('tags')"
                                    :disabled="loading"
                                    title="Ê†áÁ≠æËßÜÂõæ"
                                    aria-label="ÂàáÊç¢Âà∞Ê†áÁ≠æËßÜÂõæ">
                                    <i class="fas fa-tags" aria-hidden="true"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Â∑•ÂÖ∑Ê†èÔºà‰∏§ÁßçËßÜÂõæÊ®°ÂºèÈÉΩÊòæÁ§∫Ôºâ -->
                    <div class="file-tree-toolbar">
                        <!-- Ê†ëÂΩ¢ËßÜÂõæÂ∑•ÂÖ∑Ê†è -->
                        <template v-if="viewMode === 'tree'">
                            <div class="toolbar-group">
                                <!-- ÊâπÈáèÈÄâÊã©ÊåâÈíÆ -->
                                <button 
                                    type="button"
                                    class="toolbar-btn"
                                    :class="{ 'active': batchMode }"
                                    @click="toggleBatchMode"
                                    :title="batchMode ? 'ÈÄÄÂá∫ÊâπÈáèÈÄâÊã©' : 'ÊâπÈáèÈÄâÊã©'"
                                    aria-label="ÊâπÈáèÈÄâÊã©">
                                    <i class="fas" :class="batchMode ? 'fa-check-square' : 'fa-square'" aria-hidden="true"></i>
                                    <span>ÊâπÈáè</span>
                                </button>
                            </div>
                            <div class="toolbar-group">
                                <!-- ‰∏ãËΩΩÊåâÈíÆ -->
                                <button 
                                    type="button"
                                    class="toolbar-btn"
                                    @click="handleDownloadProjectVersion"
                                    :disabled="loading"
                                    title="‰∏ãËΩΩÈ°πÁõÆ"
                                    aria-label="‰∏ãËΩΩÈ°πÁõÆ">
                                    <i class="fas fa-download" aria-hidden="true"></i>
                                    <span>‰∏ãËΩΩ</span>
                                </button>
                                <!-- ‰∏ä‰º†ÊåâÈíÆ -->
                                <button 
                                    type="button"
                                    class="toolbar-btn"
                                    @click="triggerUploadProjectVersion"
                                    :disabled="loading"
                                    title="‰∏ä‰º†È°πÁõÆ"
                                    aria-label="‰∏ä‰º†È°πÁõÆ">
                                    <i class="fas fa-upload" aria-hidden="true"></i>
                                    <span>‰∏ä‰º†</span>
                                </button>
                                <input
                                    id="aicrUploadZipInput"
                                    ref="uploadInput"
                                    type="file" 
                                    accept=".zip"
                                    @change="handleUploadProjectVersion"
                                    style="display:none" 
                                    aria-label="‰∏ä‰º†È°πÁõÆZIP">
                            </div>
                        </template>
                        
                        <!-- Ê†áÁ≠æËßÜÂõæÂ∑•ÂÖ∑Ê†è -->
                        <template v-else-if="viewMode === 'tags'">
                            <div class="toolbar-group">
                                <!-- ÊâπÈáèÈÄâÊã©ÊåâÈíÆ -->
                                <button 
                                    type="button"
                                    class="toolbar-btn"
                                    :class="{ 'active': sessionBatchMode }"
                                    @click="toggleSessionBatchMode"
                                    :title="sessionBatchMode ? 'ÈÄÄÂá∫ÊâπÈáèÈÄâÊã©' : 'ÊâπÈáèÈÄâÊã©'"
                                    aria-label="ÊâπÈáèÈÄâÊã©">
                                    <i class="fas" :class="sessionBatchMode ? 'fa-check-square' : 'fa-square'" aria-hidden="true"></i>
                                    <span>ÊâπÈáè</span>
                                </button>
                            </div>
                            <div class="toolbar-group">
                                <!-- Êñ∞Âª∫‰ºöËØùÊåâÈíÆ -->
                                <button 
                                    type="button"
                                    class="toolbar-btn"
                                    @click="handleSessionCreate"
                                    :disabled="loading"
                                    title="Êñ∞Âª∫‰ºöËØù"
                                    aria-label="Êñ∞Âª∫‰ºöËØù">
                                    <i class="fas fa-plus" aria-hidden="true"></i>
                                    <span>Êñ∞Âª∫</span>
                                </button>
                                <!-- ÂØºÂÖ•ÊåâÈíÆ -->
                                <button 
                                    type="button"
                                    class="toolbar-btn"
                                    @click="handleSessionImport"
                                    :disabled="loading"
                                    title="ÂØºÂÖ•‰ºöËØù"
                                    aria-label="ÂØºÂÖ•‰ºöËØù">
                                    <i class="fas fa-file-import" aria-hidden="true"></i>
                                    <span>ÂØºÂÖ•</span>
                                </button>
                                <!-- ÂØºÂá∫ÊåâÈíÆ -->
                                <button 
                                    type="button"
                                    class="toolbar-btn"
                                    @click="handleSessionExport"
                                    :disabled="loading || !sessions || sessions.length === 0"
                                    title="ÂØºÂá∫‰ºöËØù"
                                    aria-label="ÂØºÂá∫‰ºöËØù">
                                    <i class="fas fa-file-export" aria-hidden="true"></i>
                                    <span>ÂØºÂá∫</span>
                                </button>
                                <input
                                    ref="sessionImportInput"
                                    type="file" 
                                    accept=".json,.zip"
                                    @change="handleSessionImportFile"
                                    class="hidden-input"
                                    aria-label="ÂØºÂÖ•‰ºöËØùÊñá‰ª∂">
                            </div>
                        </template>
                    </div>
                </div>
                
                <!-- Ê†ëÂΩ¢ËßÜÂõæÔºöÊòæÁ§∫Êñá‰ª∂Ê†ë -->
                <file-tree 
                    v-show="viewMode === 'tree'"
                    :tree="fileTree" 
                    :selected-key="selectedKey" 
                    :expanded-folders="expandedFolders" 
                    :loading="loading" 
                    :error="errorMessage" 
                    :comments="comments"
                    :collapsed="sidebarCollapsed"
                    :search-query="searchQuery"
                    :batch-mode="batchMode"
                    :selected-keys="selectedKeys"
                    :view-mode="viewMode"
                    @file-select="handleFileSelect"  
                    @folder-toggle="handleFolderToggle"
                    @create-folder="handleCreateFolder"
                    @create-file="handleCreateFile"
                    @rename-item="handleRenameItem"
                    @delete-item="handleDeleteItem"
                    @create-session="handleCreateSession"
                    @toggle-collapse="toggleSidebar"
                    @search-change="handleSearchChange"
                    @toggle-batch-mode="toggleBatchMode"
                    @batch-select-file="toggleFileSelection"
                    @download-project="handleDownloadProjectVersion"
                    @upload-project="handleUploadProjectVersion"
                    @view-mode-change="setViewMode"
                ></file-tree>
                
                <!-- Ê†áÁ≠æËßÜÂõæÔºöÊòæÁ§∫‰ºöËØùÂàóË°® -->
                <session-list 
                    v-show="viewMode === 'tags'"
                    :sessions="(sessions && Array.isArray(sessions)) ? sessions : []"
                    :loading="sessionLoading || false"
                    :error="sessionError || null"
                    :selected-tags="(selectedSessionTags && Array.isArray(selectedSessionTags)) ? selectedSessionTags : []"
                    :search-query="sessionSearchQuery || ''"
                    :tag-filter-reverse="tagFilterReverse || false"
                    :tag-filter-no-tags="tagFilterNoTags || false"
                    :tag-filter-expanded="tagFilterExpanded || false"
                    :tag-filter-visible-count="tagFilterVisibleCount || 8"
                    :tag-filter-search-keyword="tagFilterSearchKeyword || ''"
                    :session-batch-mode="sessionBatchMode || false"
                    :selected-session-keys="selectedSessionKeys || new Set()"
                    :is-all-sessions-selected="isAllSessionsSelected"
                    @session-select="handleSessionSelect"
                    @session-delete="handleSessionDelete"
                    @session-create="handleSessionCreate"
                    @session-favorite="handleSessionFavorite"
                    @session-edit="handleSessionEdit"
                    @session-tag="handleSessionTag"
                    @session-duplicate="handleSessionDuplicate"
                    @session-context="handleSessionContext"
                    @session-open-url="handleSessionOpenUrl"
                    @session-tree="handleSessionTree"
                    @session-batch-select="handleSessionBatchSelect"
                    @session-batch-select-all="handleToggleSelectAllSessions"
                    @session-batch-delete="handleBatchDeleteSessions"
                    @session-batch-cancel="toggleSessionBatchMode"
                    @tag-select="handleTagSelect"
                    @tag-clear="handleTagClear"
                    @search-change="handleSessionSearchChange"
                    @tag-filter-reverse="handleTagFilterReverse"
                    @tag-filter-no-tags="handleTagFilterNoTags"
                    @tag-filter-expand="handleTagFilterExpand"
                    @tag-filter-search="handleTagFilterSearch"
                    @toggle-collapse="handleSessionViewBack"
                ></session-list>
            </aside>
            
            <!-- ‰æßËæπÊ†èÊî∂Ëµ∑ÂêéÁöÑÂ±ïÂºÄÊääÊâã -->
            <button 
                type="button"
                class="sidebar-expand-handle" 
                v-show="sidebarCollapsed"
                @click="toggleSidebar"
                aria-label="Â±ïÂºÄÊñá‰ª∂ÁõÆÂΩïÊ†ë"
                title="Â±ïÂºÄÊñá‰ª∂ÁõÆÂΩïÊ†ë">
                <i class="fas fa-chevron-right" aria-hidden="true"></i>
            </button>
            <section class="aicr-code" :class="{ 'with-sidebar-collapsed': sidebarCollapsed, 'with-comments-collapsed': commentsCollapsed }" aria-label="‰ª£Á†ÅÂå∫">
                <code-view 
                    :file="currentFile" 
                    :loading="loading" 
                    :error="errorMessage"
                    :comments="currentComments"
                    @comment-delete="handleCommentDelete"
                    @comment-resolve="handleCommentResolve"
                    @comment-reopen="handleCommentReopen"
                    @reload-comments="handleReloadComments"
                ></code-view>
            </section>
            <aside class="aicr-comments" aria-label="ËØÑËÆ∫Âå∫" v-show="!commentsCollapsed" :style="{ width: commentsWidth + 'px' }">
                <comment-panel 
                    :comments="currentComments" 
                    :file="currentFile"
                    :new-comment="newComment" 
                    :loading="loading" 
                    :error="errorMessage" 
                    :collapsed="commentsCollapsed"
                    @comment-submit="handleCommentSubmit" 
                    @comment-input="handleCommentInput"
                    @comment-delete="handleCommentDelete"
                    @comment-resolve="handleCommentResolve"
                    @comment-reopen="handleCommentReopen"
                    @toggle-collapse="toggleComments"
                ></comment-panel>
            </aside>
            <!-- ËØÑËÆ∫Âå∫Êî∂Ëµ∑ÂêéÁöÑÂ±ïÂºÄÊääÊâã -->
            <button 
                type="button"
                class="comments-expand-handle" 
                v-show="commentsCollapsed"
                @click="toggleComments"
                aria-label="Â±ïÂºÄËØÑËÆ∫Âå∫"
                title="Â±ïÂºÄËØÑËÆ∫Âå∫">
                <i class="fas fa-chevron-left" aria-hidden="true"></i>
            </button>
            
        </main>
    </div>

    <!-- ÂÖ®Â±ÄÂä†ËΩΩÊåáÁ§∫Âô® -->
    <section id="global-loading-indicator" class="loading-indicator" aria-hidden="true" aria-label="ÂÖ®Â±ÄÂä†ËΩΩ‰∏≠">
      <div class="loading-content">
          <div class="loading-spinner" role="status" aria-live="polite" aria-label="Ê≠£Âú®Âä†ËΩΩ"></div>
          <p class="loading-text" id="loading-text">Ê≠£Âú®Âä†ËΩΩ...</p>
      </div>
    </section>

    
    
    <!-- ËÑöÊú¨Ê†áÁ≠æÁßªÂà∞VueÂ∫îÁî®ÂÆπÂô®Â§ñÈÉ® -->
    <!-- Âü∫Á°ÄÈÖçÁΩÆÂíåÂ∑•ÂÖ∑ -->
    <script type="module" src="../../config.js"></script>
    <script type="module" src="../../utils/chartViewer.js"></script>
    
    <!-- Mermaid Áõ∏ÂÖ≥ËÑöÊú¨ÔºàÊåâ‰æùËµñÈ°∫Â∫èÂä†ËΩΩÔºâ -->
    <script type="module" src="../../utils/mermaid.js"></script>
    <script type="module" src="../../utils/mermaidDebug.js"></script>
    <script type="module" src="../../utils/mermaidRenderer.js"></script>
    
    <!-- Êèí‰ª∂ÁªÑ‰ª∂ -->
    <script type="module" src="../../views/aicr/components/fileTree/index.js"></script>
    <script type="module" src="../../views/aicr/components/codeView/index.js"></script>
    <script type="module" src="../../views/aicr/components/commentPanel/index.js"></script>
    <script type="module" src="../../views/aicr/components/sessionList/index.js"></script>
    
    <!-- ‰∏ªÂ∫îÁî®ÂÖ•Âè£ -->
    <script type="module" src="../../views/aicr/index.js"></script>
    
    <!-- ÊÄßËÉΩÁõëÊéßÔºàÊúÄÂêéÂä†ËΩΩÔºâ -->
    <script type="module" src="../../utils/performance.js"></script>
</body>
</html>







