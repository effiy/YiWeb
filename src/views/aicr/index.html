<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YiWeb - ‰ª£Á†ÅÂÆ°Êü•</title>
    <link rel="stylesheet" href="../../views/aicr/index.css">
    <link rel="stylesheet" href="../../views/aicr/components/sessionList/index.css">
    <link rel="stylesheet" href="../../libs/font-awesome/css/all.min.css">
    <script src="../../libs/vue/vue.global.js"></script>
    <!-- Highlight.js for Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- Marked.js for Markdown rendering -->
    <script src="../../libs/marked/marked.min.js"></script>
    <!-- Mermaid.js for diagram rendering -->
    <script src="../../libs/mermaid/mermaid.min.js"></script>
</head>
<body>
    <div id="app">
      <!-- È°∂ÈÉ®ÊêúÁ¥¢‰∏éÂàÜÁ±ªÂå∫Âüü -->
      <header class="header-row" role="banner">
        <section class="search-row">
            <form class="search-box" role="search" aria-label="‰ª£Á†ÅÂÆ°Êü•ÊêúÁ¥¢">
                <span class="search-logo" aria-hidden="true" @click="openLink('/index.html')">
                    <i class="fas fa-globe" aria-label="‰ª£Á†ÅÂÆ°Êü•ÂõæÊ†á"></i>
                </span>
                <div class="search-input-wrapper">
                    <label for="messageInput" class="visually-hidden">ÊêúÁ¥¢ËæìÂÖ•Ê°Ü</label>
                    <textarea 
                        id="messageInput" 
                        placeholder="ÊêúÁ¥¢ÁΩëÁ´ô„ÄÅÊ†áÁ≠æÊàñÊèèËø∞..." 
                        rows="1" 
                        maxlength="2000"
                        aria-label="ÊêúÁ¥¢ËæìÂÖ•Ê°Ü"
                        aria-describedby="category-filters"
                        autocomplete="off"
                        spellcheck="false"
                        @keydown="handleMessageInput"
                        @compositionstart="handleCompositionStart"
                        @compositionend="handleCompositionEnd"
                        @input="handleSearchInput"></textarea>
                    
                    <!-- Ê∏ÖÈô§ÊêúÁ¥¢ÊåâÈíÆ -->
                    <div class="search-clear" v-if="searchQueryValue">
                        <button 
                            type="button"
                            @click.prevent="clearSearch"
                            class="clear-search-btn"
                            title="Ê∏ÖÈô§ÊêúÁ¥¢"
                            aria-label="Ê∏ÖÈô§ÊêúÁ¥¢ÂÜÖÂÆπ"
                        >
                            <i class="fas fa-times" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
            </form>
            
            <!-- È°πÁõÆÈÄâÊã©Âô® -->
            <nav class="category-filters" id="category-filters" role="toolbar" aria-label="È°πÁõÆËøáÊª§Âô®">
                <ul class="filter-buttons">

                </ul>
            </nav>
            
        </section>
        </header>
        <main class="aicr-main">
            <!-- ‰æßËæπÊ†èÂ±ïÂºÄÊääÊâã (Êî∂Ëµ∑Êó∂ÊòæÁ§∫) -->
            <button 
                type="button"
                class="sidebar-expand-handle"
                v-show="sidebarCollapsed"
                @click="toggleSidebar"
                aria-label="Â±ïÂºÄ‰æßËæπÊ†è"
                title="Â±ïÂºÄ‰æßËæπÊ†è">
                <i class="fas fa-chevron-right" aria-hidden="true"></i>
                <span class="label">Â±ïÂºÄ</span>
            </button>

            <!-- ‰æßËæπÊ†èÊî∂Ëµ∑ÊåâÈíÆ (Â±ïÂºÄÊó∂ÊòæÁ§∫ÔºåË∑üÈöè‰æßËæπÊ†èÂÆΩÂ∫¶) -->
            <div 
                class="file-tree-toggle" 
                v-show="!sidebarCollapsed"
                @click="toggleSidebar"
                title="Êî∂Ëµ∑‰æßËæπÊ†è"
                :style="{ left: ((viewMode === 'tree' ? sidebarWidth : sessionSidebarWidth) - 14) + 'px', right: 'auto' }">
                <i class="fas fa-chevron-left"></i>
            </div>

            <aside class="aicr-sidebar" aria-label="‰æßËæπÊ†è" v-show="!sidebarCollapsed" :style="{ width: (viewMode === 'tree' ? sidebarWidth : sessionSidebarWidth) + 'px' }">
                <div class="sidebar-scroll-container">
                    <!-- ÂÖ±‰∫´ÊêúÁ¥¢ÂÆπÂô®Ôºà‰∏§ÁßçËßÜÂõæÊ®°ÂºèÂÖ±Áî®Ôºâ -->
                    <div v-if="!sidebarCollapsed" class="file-tree-header-container">

                    
                        <!-- ÊêúÁ¥¢ËæìÂÖ•Ê°ÜÂíåËßÜÂõæÂàáÊç¢ -->
                        <div class="file-tree-search-container">
                            <div class="file-tree-search-wrapper">
                                <span class="file-tree-search-icon">üîç</span>
                                <input
                                    type="text"
                                    class="file-tree-search-input"
                                    :value="viewMode === 'tree' ? (searchQuery || '') : (sessionSearchQuery || '')"
                                    @input="viewMode === 'tree' ? handleSearchInput($event) : handleSessionSearchChange($event.target.value)"
                                    @keydown.esc="viewMode === 'tree' ? clearSearch() : handleSessionSearchChange('')"
                                    :placeholder="viewMode === 'tree' ? 'ÊêúÁ¥¢Êñá‰ª∂...' : 'ÊêúÁ¥¢‰ºöËØù...'"
                                    aria-label="ÊêúÁ¥¢"
                                />
                                <button
                                    v-if="(viewMode === 'tree' && searchQuery) || (viewMode === 'tags' && sessionSearchQuery)"
                                    class="file-tree-search-clear"
                                    @click="viewMode === 'tree' ? clearSearch() : handleSessionSearchChange('')"
                                    type="button"
                                    aria-label="Ê∏ÖÈô§ÊêúÁ¥¢"
                                    title="Ê∏ÖÈô§ÊêúÁ¥¢ (ESC)"
                                >
                                    ‚úï
                                </button>
                                <!-- ËßÜÂõæÂàáÊç¢ÊåâÈíÆÔºàÈõÜÊàêÂú®ÊêúÁ¥¢Ê°ÜÂÜÖÔºâ -->
                                <div class="view-mode-toggle">
                                    <button 
                                        type="button"
                                        class="view-mode-btn"
                                        :class="{ 'active': viewMode === 'tree' }"
                                        @click="setViewMode('tree')"
                                        :disabled="loading"
                                        title="Ê†ëÂΩ¢ËßÜÂõæ"
                                        aria-label="ÂàáÊç¢Âà∞Ê†ëÂΩ¢ËßÜÂõæ">
                                        <i class="fas fa-sitemap" aria-hidden="true"></i>
                                    </button>
                                    <button 
                                        type="button"
                                        class="view-mode-btn"
                                        :class="{ 'active': viewMode === 'tags' }"
                                        @click="setViewMode('tags')"
                                        :disabled="loading"
                                        title="Ê†áÁ≠æËßÜÂõæ"
                                        aria-label="ÂàáÊç¢Âà∞Ê†áÁ≠æËßÜÂõæ">
                                        <i class="fas fa-tags" aria-hidden="true"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Â∑•ÂÖ∑Ê†èÔºàÂ∑≤ÁßªËá≥‰ºöËØùÂàóË°®ÁªÑ‰ª∂ÂÜÖÈÉ®Ôºâ -->
                        
                    </div>
                    
                    <!-- Ê†ëÂΩ¢ËßÜÂõæÔºöÊòæÁ§∫Êñá‰ª∂Ê†ë -->
                    <file-tree 
                        v-show="viewMode === 'tree'"
                        :tree="fileTree" 
                        :selected-key="selectedKey" 
                        :expanded-folders="expandedFolders" 
                        :loading="loading" 
                        :error="errorMessage" 
                        :comments="comments"
                        :collapsed="sidebarCollapsed"
                        :search-query="searchQuery"
                        :batch-mode="batchMode"
                        :selected-keys="selectedKeys"
                        :view-mode="viewMode"
                        :selected-tags="(selectedSessionTags && Array.isArray(selectedSessionTags)) ? selectedSessionTags : []"
                        :tag-filter-reverse="tagFilterReverse || false"
                        :tag-filter-no-tags="tagFilterNoTags || false"
                        :tag-filter-expanded="tagFilterExpanded || false"
                        :tag-filter-search-keyword="tagFilterSearchKeyword || ''"
                        @file-select="handleFileSelect"  
                        @folder-toggle="handleFolderToggle"
                        @create-folder="handleCreateFolder"
                        @create-file="handleCreateFile"
                        @rename-item="handleRenameItem"
                        @delete-item="handleDeleteItem"
                        @create-session="handleCreateSession"
                        @toggle-collapse="toggleSidebar"
                        @search-change="handleSearchChange"
                        @toggle-batch-mode="toggleBatchMode"
                        @batch-select-file="toggleFileSelection"
                        @download-project="handleDownloadProjectVersion"
                        @upload-project="handleUploadProjectVersion"
                        @view-mode-change="setViewMode"
                        @tag-select="handleTagSelect"
                        @tag-clear="handleTagClear"
                        @tag-filter-reverse="handleTagFilterReverse"
                        @tag-filter-no-tags="handleTagFilterNoTags"
                        @tag-filter-expand="handleTagFilterExpand"
                        @tag-filter-search="handleTagFilterSearch"
                    ></file-tree>
                    
                    <!-- Ê†áÁ≠æËßÜÂõæÔºöÊòæÁ§∫‰ºöËØùÂàóË°® -->
                    <session-list 
                        v-show="viewMode === 'tags'"
                        :sessions="(sessions && Array.isArray(sessions)) ? sessions : []"
                        :loading="sessionLoading || false"
                        :error="sessionError || null"
                        :selected-tags="(selectedSessionTags && Array.isArray(selectedSessionTags)) ? selectedSessionTags : []"
                        :search-query="sessionSearchQuery || ''"
                        :tag-filter-reverse="tagFilterReverse || false"
                        :tag-filter-no-tags="tagFilterNoTags || false"
                        :tag-filter-expanded="tagFilterExpanded || false"
                        :tag-filter-visible-count="tagFilterVisibleCount || 8"
                        :tag-filter-search-keyword="tagFilterSearchKeyword || ''"
                        :session-batch-mode="sessionBatchMode || false"
                        :selected-session-keys="selectedSessionKeys || new Set()"
                        :is-all-sessions-selected="isAllSessionsSelected"
                        @session-select="handleSessionSelect"
                        @session-delete="handleSessionDelete"
                        @session-create="handleSessionCreate"
                        @session-favorite="handleSessionFavorite"
                        @session-edit="handleSessionEdit"
                        @session-tag="handleSessionTag"
                        @session-duplicate="handleSessionDuplicate"
                        @session-context="handleSessionContext"
                        @session-open-url="handleSessionOpenUrl"
                        @session-batch-select="handleSessionBatchSelect"
                        @session-batch-select-all="handleToggleSelectAllSessions"
                        @session-batch-delete="handleBatchDeleteSessions"
                        @session-batch-cancel="toggleSessionBatchMode"
                        @toggle-batch-mode="toggleSessionBatchMode"
                        @session-import-file="handleSessionImportFile"
                        @session-export="handleSessionExport"
                        @tag-select="handleTagSelect"
                        @tag-clear="handleTagClear"
                        @search-change="handleSessionSearchChange"
                        @tag-filter-reverse="handleTagFilterReverse"
                        @tag-filter-no-tags="handleTagFilterNoTags"
                        @tag-filter-expand="handleTagFilterExpand"
                        @tag-filter-search="handleTagFilterSearch"
                        @toggle-collapse="handleSessionViewBack"
                    ></session-list>
                </div>
            </aside>
            
            
            <section class="aicr-code" :class="{ 'with-sidebar-collapsed': sidebarCollapsed, 'with-comments-collapsed': commentsCollapsed }" aria-label="‰ª£Á†ÅÂå∫">
                <code-view 
                    v-if="viewMode === 'tree'"
                    :file="currentFile" 
                    :loading="loading" 
                    :error="errorMessage"
                    :comments="currentComments"
                    @comment-delete="handleCommentDelete"
                    @comment-resolve="handleCommentResolve"
                    @comment-reopen="handleCommentReopen"
                    @reload-comments="handleReloadComments"
                ></code-view>

                <div v-if="viewMode === 'tags'" class="pet-chat-right-panel" aria-label="‰ºöËØùËÅäÂ§©Èù¢Êùø">
                    <div class="pet-chat-messages" id="pet-chat-messages" role="log" aria-live="polite">
                        <div v-if="activeSessionLoading" class="pet-chat-loading" role="status" aria-live="polite">
                            <div class="loading-spinner" aria-hidden="true"></div>
                            <div class="loading-text">Ê≠£Âú®Âä†ËΩΩ‰ºöËØù...</div>
                        </div>
                        <div v-else-if="activeSessionError" class="pet-chat-error" role="alert" aria-live="polite">
                            <div class="error-text">{{ activeSessionError }}</div>
                        </div>
                        <div v-else-if="!activeSession" class="pet-chat-empty">
                            <div class="sr-only" role="status" aria-live="polite">Êú™ÈÄâÊã©‰ºöËØùÔºå‰ªéÂ∑¶‰æß‰ºöËØùÂàóË°®ÈÄâÊã©‰∏Ä‰∏™‰ºöËØùÂºÄÂßãËÅäÂ§©</div>
                            <div class="pet-chat-empty-card">
                                <div class="pet-chat-empty-icon" aria-hidden="true">
                                    <i class="fas fa-comments"></i>
                                </div>
                                <div class="pet-chat-empty-title">Êú™ÈÄâÊã©‰ºöËØù</div>
                                <div class="pet-chat-empty-subtitle">‰ªéÂ∑¶‰æß‰ºöËØùÂàóË°®ÈÄâÊã©‰∏Ä‰∏™‰ºöËØùÂºÄÂßãËÅäÂ§©</div>
                                <div class="pet-chat-empty-hint">‰πüÂèØ‰ª•Âú®Â∑¶‰æßÊêúÁ¥¢Ê°ÜËæìÂÖ•ÂÖ≥ÈîÆËØçÂø´ÈÄüÂÆö‰Ωç</div>
                            </div>
                        </div>
                        <div v-else>
                            <div 
                                v-for="(m, idx) in sessionChatMessages(activeSession)" 
                                :key="`${m.timestamp || 0}_${idx}`"
                                class="pet-chat-message"
                                :class="{
                                    'is-pet': m.type === 'pet',
                                    'is-user': m.type !== 'pet',
                                    'is-error': !!m.error,
                                    'is-aborted': !!m.aborted,
                                    'is-streaming': isSessionChatStreamingMessage(m, idx)
                                }"
                                :data-chat-idx="idx"
                                :data-chat-timestamp="m.timestamp || 0"
                                :data-chat-type="m.type === 'pet' ? 'pet' : 'user'"
                            >
                                <div class="pet-chat-bubble">
                                    <div v-if="Array.isArray(m.imageDataUrls) && m.imageDataUrls.length > 0" class="pet-chat-images">
                                        <img v-for="(src, imgIdx) in m.imageDataUrls" :key="`${m.timestamp || 0}_${imgIdx}`" class="pet-chat-image" :src="src" alt="ÂõæÁâáÊ∂àÊÅØ" />
                                    </div>
                                    <img v-else-if="m.imageDataUrl" class="pet-chat-image" :src="m.imageDataUrl" alt="ÂõæÁâáÊ∂àÊÅØ" />
                                    <div v-if="m.type === 'pet' && (!(m.message || m.content) || !String(m.message || m.content).trim()) && sessionChatSending && idx === (sessionChatMessages(activeSession).length - 1)" class="pet-chat-typing" aria-label="ÁîüÊàê‰∏≠">...</div>
                                    <div v-else-if="(m.message || m.content) && String(m.message || m.content).trim() && isSessionChatStreamingMessage(m, idx)" class="pet-chat-content md-preview-body pet-chat-content-streaming" v-html="renderSessionChatStreamingHtml(m.message || m.content)"></div>
                                    <div v-else-if="(m.message || m.content) && String(m.message || m.content).trim()" class="pet-chat-content md-preview-body" v-html="renderSessionChatMarkdown(m.message || m.content)"></div>
                                        <div class="pet-chat-meta">
                                            <div class="pet-chat-meta-actions">
                                                <button
                                                    v-if="(m.message || m.content) && String(m.message || m.content).trim()"
                                                    type="button"
                                                    class="pet-chat-meta-btn"
                                                    @click="copySessionChatMessage(m.message || m.content, m, idx)"
                                                    aria-label="Â§çÂà∂Ê∂àÊÅØ"
                                                    title="Â§çÂà∂"
                                                >{{ sessionChatCopyButtonLabel(m, idx) }}</button>
                                                <template v-if="Array.isArray(weChatRobots) && weChatRobots.length > 0 && m.type === 'pet' && (m.message || m.content) && String(m.message || m.content).trim()">
                                                    <button
                                                        v-for="(bot, bi) in weChatRobots"
                                                        :key="bot.id || ('wrb_' + bi)"
                                                        type="button"
                                                        class="pet-chat-meta-btn"
                                                        :title="'ÂèëÈÄÅÂà∞Ôºö' + (bot.name || 'Êú∫Âô®‰∫∫')"
                                                        :aria-label="'ÂèëÈÄÅÂà∞Êú∫Âô®‰∫∫Ôºö' + (bot.name || 'Êú∫Âô®‰∫∫')"
                                                        @click="sendSessionChatMessageToRobot(bot, m, idx)"
                                                    >{{ bot.name || 'Êú∫Âô®‰∫∫' }}</button>
                                                </template>
                                                <button
                                                    v-if="m.type !== 'pet'"
                                                    type="button"
                                                    class="pet-chat-meta-btn"
                                                    :disabled="sessionChatSending"
                                                    @click="editSessionChatMessageAt(idx)"
                                                    aria-label="ÁºñËæëÊ∂àÊÅØ"
                                                    title="ÁºñËæë"
                                                >‚úèÔ∏è</button>
                                            <button
                                                v-if="m.type !== 'pet'"
                                                type="button"
                                                class="pet-chat-meta-btn"
                                                :disabled="sessionChatSending"
                                                @click="resendSessionChatMessageAt(idx)"
                                                aria-label="ÈáçÊñ∞ÂèëÈÄÅ"
                                                title="ÈáçÊñ∞ÂèëÈÄÅ"
                                            >üì®</button>
                                            <button
                                                type="button"
                                                class="pet-chat-meta-btn"
                                                @click="moveSessionChatMessageUp(idx)"
                                                aria-label="‰∏äÁßªÊ∂àÊÅØ"
                                                title="‰∏äÁßª"
                                            >‚¨ÜÔ∏è</button>
                                            <button
                                                type="button"
                                                class="pet-chat-meta-btn"
                                                @click="moveSessionChatMessageDown(idx)"
                                                aria-label="‰∏ãÁßªÊ∂àÊÅØ"
                                                title="‰∏ãÁßª"
                                            >‚¨áÔ∏è</button>
                                            <button
                                                v-if="m.type === 'pet' && canRegenerateSessionChatMessage(activeSession, idx)"
                                                type="button"
                                                class="pet-chat-meta-btn"
                                                :disabled="sessionChatSending || isSessionChatRegenerating(m, idx)"
                                                @click="regenerateSessionChatMessageAt(idx)"
                                                aria-label="ÈáçÊñ∞ÁîüÊàêÂõûÂ§ç"
                                                title="ÈáçÊñ∞ÁîüÊàê"
                                            >{{ sessionChatRegenerateButtonLabel(m, idx) }}</button>
                                            <button
                                                type="button"
                                                class="pet-chat-meta-btn"
                                                :disabled="sessionChatSending"
                                                @click="deleteSessionChatMessageAt(idx)"
                                                aria-label="Âà†Èô§Ê∂àÊÅØ"
                                                title="Âà†Èô§"
                                            >üóëÔ∏è</button>
                                        </div>
                                        <time class="pet-chat-time" :datetime="m.timestamp">{{ formatTime(m.timestamp) }}</time>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="pet-chat-input-container chat-input-container">
                        <div class="pet-chat-toolbar chat-input-toolbar">
                            <div class="pet-chat-toolbar-left chat-input-btn-group">
                                <button type="button" class="pet-chat-btn chat-input-btn chat-input-text-btn" @click="openSessionContextEditor" title="È°µÈù¢‰∏ä‰∏ãÊñá" aria-label="È°µÈù¢‰∏ä‰∏ãÊñá">üìù È°µÈù¢‰∏ä‰∏ãÊñá</button>
                                <button type="button" class="pet-chat-btn chat-input-btn chat-input-text-btn" @click="openSessionFaq" title="Â∏∏ËßÅÈóÆÈ¢ò" aria-label="Â∏∏ËßÅÈóÆÈ¢ò">üí° Â∏∏ËßÅÈóÆÈ¢ò</button>
                                <button type="button" class="pet-chat-btn chat-input-btn chat-input-text-btn" @click="openWeChatSettings" title="ÂæÆ‰ø°Êú∫Âô®‰∫∫ËÆæÁΩÆ" aria-label="ÂæÆ‰ø°Êú∫Âô®‰∫∫ËÆæÁΩÆ">ü§ñ ÂæÆ‰ø°Êú∫Âô®‰∫∫</button>
                                <button type="button" class="pet-chat-btn chat-input-btn chat-input-text-btn" @click="openSessionChatImagePicker" title="‰∏ä‰º†ÂõæÁâá" aria-label="‰∏ä‰º†ÂõæÁâá">üñºÔ∏è ÂõæÁâá</button>
                                <input id="pet-chat-image-input" type="file" accept="image/*" multiple style="display:none" @change="onSessionChatImageInputChange" />
                            </div>
                            <div class="pet-chat-toolbar-right chat-input-btn-group">
                                <div class="context-switch-container" :class="{ active: sessionContextEnabled }" title="ÂºÄÂêØ/ÂÖ≥Èó≠È°µÈù¢‰∏ä‰∏ãÊñá">
                                    <span class="context-switch-label">È°µÈù¢‰∏ä‰∏ãÊñá</span>
                                    <label class="context-switch-wrapper" for="context-switch">
                                        <div class="context-switch-thumb"></div>
                                    </label>
                                    <input
                                        id="context-switch"
                                        class="context-switch-input"
                                        type="checkbox"
                                        :checked="sessionContextEnabled"
                                        @change="setSessionContextEnabled($event.target.checked)"
                                        aria-label="È°µÈù¢‰∏ä‰∏ãÊñáÂºÄÂÖ≥"
                                    />
                                </div>
                                <button
                                    type="button"
                                    class="chat-input-status-btn"
                                    :class="{ active: sessionChatSending }"
                                    :disabled="!sessionChatSending"
                                    @click="abortSessionChatRequest"
                                    :title="sessionChatSending ? 'ËØ∑Ê±ÇÁä∂ÊÄÅÔºöÁîüÊàê‰∏≠ÔºàÁÇπÂáªÂÅúÊ≠¢Ôºâ' : 'ËØ∑Ê±ÇÁä∂ÊÄÅÔºöÁ©∫Èó≤'"
                                    aria-label="ËØ∑Ê±ÇÁä∂ÊÄÅ"
                                >{{ sessionChatSending ? '‚è∏Ô∏è' : '‚èπÔ∏è' }}</button>
                            </div>
                        </div>

                        <div class="chat-input-wrapper">
                            <div v-if="Array.isArray(sessionChatDraftImages) && sessionChatDraftImages.length > 0" class="pet-chat-draft-images" aria-label="ÂæÖÂèëÈÄÅÂõæÁâá">
                                <div v-for="(src, imgIdx) in sessionChatDraftImages" :key="`draft_${imgIdx}`" class="pet-chat-draft-image">
                                    <img class="pet-chat-draft-image-preview" :src="src" alt="ÂæÖÂèëÈÄÅÂõæÁâá" />
                                    <button type="button" class="pet-chat-draft-image-remove" @click="removeSessionChatDraftImage(imgIdx)" aria-label="ÁßªÈô§ÂõæÁâá" title="ÁßªÈô§">‚úï</button>
                                </div>
                                <button type="button" class="pet-chat-draft-images-clear" @click="clearSessionChatDraftImages" aria-label="Ê∏ÖÁ©∫ÂõæÁâá" title="Ê∏ÖÁ©∫ÂõæÁâá">Ê∏ÖÁ©∫ÂõæÁâá</button>
                            </div>

                            <div class="pet-chat-input-row">
                                <textarea
                                    id="pet-chat-input"
                                    class="pet-chat-textarea chat-message-input"
                                    :value="sessionChatInput"
                                    @input="onSessionChatInput"
                                    @keydown="onSessionChatKeydown"
                                    @compositionstart="onSessionChatCompositionStart"
                                    @compositionupdate="onSessionChatCompositionUpdate"
                                    @compositionend="onSessionChatCompositionEnd"
                                    @paste="onSessionChatPaste"
                                    placeholder="ËæìÂÖ•Ê∂àÊÅØ... (Enter ÂèëÈÄÅ, Shift+Enter Êç¢Ë°å)"
                                    rows="2"
                                    aria-label="‰ºöËØùËæìÂÖ•Ê°Ü"
                                ></textarea>
                            </div>
                        </div>
                    </div>

                    <div v-if="sessionContextEditorVisible" class="aicr-session-context-modal" role="dialog" aria-modal="true" aria-label="È°µÈù¢‰∏ä‰∏ãÊñáÁºñËæëÂô®">
                        <div class="aicr-session-context-modal-mask" @click="closeSessionContextEditor"></div>
                        <div class="aicr-session-context-modal-body">
                            <div class="aicr-session-context-modal-header">
                                <div class="aicr-session-context-modal-title">
                                    È°µÈù¢‰∏ä‰∏ãÊñá
                                    <span class="aicr-session-context-modal-subtitle">ÔºàMarkdownÔºâ</span>
                                </div>
                                <div class="aicr-session-context-modal-header-right">
                                <div class="aicr-session-context-mode-group" role="tablist" aria-label="‰∏ä‰∏ãÊñáËßÜÂõæÂàáÊç¢">
                                    <button
                                        type="button"
                                        class="aicr-session-context-mode-btn"
                                        :class="{ active: sessionContextMode === 'split' }"
                                        @click="setSessionContextMode('split')"
                                        role="tab"
                                        :aria-selected="sessionContextMode === 'split'"
                                        aria-label="Âπ∂Êéí"
                                    >Âπ∂Êéí</button>
                                    <button
                                        type="button"
                                        class="aicr-session-context-mode-btn"
                                        :class="{ active: sessionContextMode === 'edit' }"
                                        @click="setSessionContextMode('edit')"
                                        role="tab"
                                        :aria-selected="sessionContextMode === 'edit'"
                                        aria-label="‰ªÖÁºñËæë"
                                    >‰ªÖÁºñËæë</button>
                                    <button
                                        type="button"
                                        class="aicr-session-context-mode-btn"
                                        :class="{ active: sessionContextMode === 'preview' }"
                                        @click="setSessionContextMode('preview')"
                                        role="tab"
                                        :aria-selected="sessionContextMode === 'preview'"
                                        aria-label="‰ªÖÈ¢ÑËßà"
                                    >‰ªÖÈ¢ÑËßà</button>
                                </div>
                                <button type="button" class="aicr-session-context-toolbar-btn" @click="copySessionContextDraft" title="Â§çÂà∂ÂÜÖÂÆπ" aria-label="Â§çÂà∂ÂÜÖÂÆπ">Â§çÂà∂</button>
                                <button type="button" class="aicr-session-context-toolbar-btn" @click="optimizeSessionContextDraft" title="Êô∫ËÉΩ‰ºòÂåñ‰∏ä‰∏ãÊñáÂÜÖÂÆπ" aria-label="Êô∫ËÉΩ‰ºòÂåñ">‚ú® Êô∫ËÉΩ‰ºòÂåñ</button>
                                <button v-show="sessionContextUndoVisible" type="button" class="aicr-session-context-toolbar-btn" @click="undoOptimizeSessionContextDraft" title="Êí§ÈîÄ‰ºòÂåñ" aria-label="Êí§ÈîÄ‰ºòÂåñ">‚Ü∂ Êí§ÈîÄ</button>
                                <button type="button" class="aicr-session-context-toolbar-btn primary" @click="saveSessionContext" title="‰øùÂ≠ò‰øÆÊîπ" aria-label="‰øùÂ≠ò‰øÆÊîπ">‰øùÂ≠ò</button>
                                <button type="button" class="aicr-session-context-modal-close" @click="closeSessionContextEditor" aria-label="ÂÖ≥Èó≠">‚úï</button>
                                </div>
                            </div>
                            <div class="aicr-session-context-modal-content">
                                <div class="aicr-session-context-editor-body" :data-mode="sessionContextMode">
                                    <div v-if="sessionContextMode === 'split'" class="aicr-session-context-split">
                                        <textarea
                                            class="aicr-session-context-textarea"
                                            :value="sessionContextDraft"
                                            @input="setSessionContextDraft($event.target.value)"
                                            aria-label="È°µÈù¢‰∏ä‰∏ãÊñáÂÜÖÂÆπ"
                                        ></textarea>
                                        <div
                                            class="aicr-session-context-preview md-preview-body"
                                            v-html="renderSessionChatMarkdown(sessionContextDraft)"
                                            aria-label="È°µÈù¢‰∏ä‰∏ãÊñáÈ¢ÑËßà"
                                        ></div>
                                    </div>
                                    <textarea
                                        v-else-if="sessionContextMode === 'edit'"
                                        class="aicr-session-context-textarea"
                                        :value="sessionContextDraft"
                                        @input="setSessionContextDraft($event.target.value)"
                                        aria-label="È°µÈù¢‰∏ä‰∏ãÊñáÂÜÖÂÆπ"
                                    ></textarea>
                                    <div
                                        v-else
                                        class="aicr-session-context-preview md-preview-body"
                                        v-html="renderSessionChatMarkdown(sessionContextDraft)"
                                        aria-label="È°µÈù¢‰∏ä‰∏ãÊñáÈ¢ÑËßà"
                                    ></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="sessionFaqVisible" class="aicr-session-context-modal" role="dialog" aria-modal="true" aria-label="Â∏∏ËßÅÈóÆÈ¢ò">
                        <div class="aicr-session-context-modal-mask" @click="closeSessionFaq"></div>
                        <div class="aicr-session-context-modal-body aicr-session-faq-modal-body" tabindex="0" @keydown.esc="closeSessionFaq">
                            <div class="aicr-session-context-modal-header">
                                <div class="aicr-session-context-modal-title">
                                    üí° Â∏∏ËßÅÈóÆÈ¢ò
                                    <span class="aicr-session-context-modal-subtitle">Ôºà‰∏ÄÈîÆÊèíÂÖ•/ÂèëÈÄÅÔºâ</span>
                                </div>
                                <div class="aicr-session-context-modal-header-right">
                                    <button type="button" class="aicr-session-context-modal-close" @click="closeSessionFaq" aria-label="ÂÖ≥Èó≠">‚úï</button>
                                </div>
                            </div>
                            <div class="aicr-session-context-modal-content aicr-session-faq-modal-content">
                                <div class="aicr-session-faq-layout">
                                    <div class="aicr-session-faq-sidebar" aria-label="Á≠õÈÄâ‰∏éÊ†áÁ≠æ">
                                        <div class="aicr-session-faq-search-row">
                                            <input
                                                type="text"
                                                class="aicr-session-faq-search-input"
                                                :value="sessionFaqSearchKeyword"
                                                @input="sessionFaqSearchKeyword = $event.target.value"
                                                placeholder="ÊêúÁ¥¢Â∏∏ËßÅÈóÆÈ¢ò..."
                                                aria-label="ÊêúÁ¥¢Â∏∏ËßÅÈóÆÈ¢ò"
                                            />
                                            <button
                                                type="button"
                                                class="aicr-session-faq-search-clear"
                                                :disabled="!String(sessionFaqSearchKeyword || '').trim()"
                                                @click="clearSessionFaqSearch"
                                                aria-label="Ê∏ÖÈô§ÊêúÁ¥¢"
                                                title="Ê∏ÖÈô§ÊêúÁ¥¢"
                                            >Ê∏ÖÈô§</button>
                                        </div>

                                        <div class="aicr-session-faq-filter-row" aria-label="Â∏∏ËßÅÈóÆÈ¢òÊ†áÁ≠æÁ≠õÈÄâ">
                                            <div class="aicr-session-faq-filter-actions">
                                                <button
                                                    type="button"
                                                    class="aicr-session-faq-filter-btn"
                                                    :class="{ active: !!sessionFaqTagFilterReverse }"
                                                    @click="toggleSessionFaqTagReverse"
                                                    aria-label="ÂèçÈÄâ"
                                                    title="‰∏çÂåÖÂê´ÈÄâ‰∏≠Ê†áÁ≠æ"
                                                >ÂèçÈÄâ</button>
                                                <button
                                                    type="button"
                                                    class="aicr-session-faq-filter-btn"
                                                    :class="{ active: !!sessionFaqTagFilterNoTags }"
                                                    @click="toggleSessionFaqNoTags"
                                                    aria-label="Êó†Ê†áÁ≠æ"
                                                    title="Âè™ÊòæÁ§∫Êó†Ê†áÁ≠æÈóÆÈ¢ò"
                                                >Êó†Ê†áÁ≠æ</button>
                                                <button
                                                    type="button"
                                                    class="aicr-session-faq-filter-btn"
                                                    :disabled="(sessionFaqSelectedTags || []).length === 0 && !sessionFaqTagFilterReverse && !sessionFaqTagFilterNoTags"
                                                    @click="clearSessionFaqTagFilters"
                                                    aria-label="Ê∏ÖÈô§Ê†áÁ≠æÁ≠õÈÄâ"
                                                    title="Ê∏ÖÈô§Ê†áÁ≠æÁ≠õÈÄâ"
                                                >Ê∏ÖÈô§Ê†áÁ≠æ</button>
                                                <button
                                                    type="button"
                                                    class="aicr-session-faq-filter-btn"
                                                    :class="{ active: !!sessionFaqTagManagerVisible }"
                                                    @click="toggleSessionFaqTagManager"
                                                    aria-label="Ê†áÁ≠æÁÆ°ÁêÜ"
                                                    title="Ê†áÁ≠æÁÆ°ÁêÜ"
                                                >Ê†áÁ≠æÁÆ°ÁêÜ</button>
                                                <button
                                                    type="button"
                                                    class="aicr-session-faq-filter-btn"
                                                    :disabled="!!sessionFaqLoading"
                                                    @click="refreshSessionFaqs"
                                                    aria-label="Âà∑Êñ∞"
                                                    title="‰ªéÊé•Âè£Âà∑Êñ∞"
                                                >Âà∑Êñ∞</button>
                                            </div>

                                            <div class="aicr-session-faq-tag-search">
                                                <input
                                                    type="text"
                                                    class="aicr-session-faq-tag-search-input"
                                                    :value="sessionFaqTagFilterSearchKeyword"
                                                    @input="sessionFaqTagFilterSearchKeyword = $event.target.value"
                                                    placeholder="ÊêúÁ¥¢Ê†áÁ≠æ..."
                                                    aria-label="ÊêúÁ¥¢Ê†áÁ≠æ"
                                                />
                                                <button
                                                    type="button"
                                                    class="aicr-session-faq-filter-btn"
                                                    :disabled="!String(sessionFaqTagFilterSearchKeyword || '').trim()"
                                                    @click="clearSessionFaqTagSearch"
                                                    aria-label="Ê∏ÖÈô§Ê†áÁ≠æÊêúÁ¥¢"
                                                    title="Ê∏ÖÈô§Ê†áÁ≠æÊêúÁ¥¢"
                                                >Ê∏ÖÈô§</button>
                                            </div>

                                            <div class="aicr-session-faq-tag-list" role="list" aria-label="Ê†áÁ≠æÂàóË°®">
                                                <button
                                                    v-for="tag in (sessionFaqVisibleTags || [])"
                                                    :key="tag"
                                                    type="button"
                                                    class="aicr-session-faq-tag"
                                                    :class="{ active: (sessionFaqSelectedTags || []).includes(tag) }"
                                                    @click="toggleSessionFaqTag(tag)"
                                                    role="listitem"
                                                    :aria-label="`Á≠õÈÄâÊ†áÁ≠æÔºö${tag}`"
                                                >{{ tag }}</button>
                                                <button
                                                    v-if="(sessionFaqAllTags || []).length > (sessionFaqVisibleTags || []).length"
                                                    type="button"
                                                    class="aicr-session-faq-tag more"
                                                    @click="toggleSessionFaqTagExpanded"
                                                    role="listitem"
                                                    aria-label="Â±ïÂºÄÊàñÊî∂Ëµ∑Ê†áÁ≠æ"
                                                >{{ sessionFaqTagFilterExpanded ? 'Êî∂Ëµ∑' : 'Êõ¥Â§ö' }}</button>
                                            </div>

                                            <div v-if="sessionFaqTagManagerVisible" class="aicr-session-faq-tag-manager" aria-label="Ê†áÁ≠æÁÆ°ÁêÜÈù¢Êùø">
                                                <div class="aicr-session-faq-tag-manager-header">
                                                    <div class="aicr-session-faq-tag-manager-title">Ê†áÁ≠æÁÆ°ÁêÜ</div>
                                                    <button type="button" class="aicr-session-faq-filter-btn" @click="toggleSessionFaqTagManager" aria-label="ÂÖ≥Èó≠Ê†áÁ≠æÁÆ°ÁêÜ">ÂÖ≥Èó≠</button>
                                                </div>
                                                <div class="aicr-session-faq-tag-manager-list" role="list" aria-label="ÂèØÁÆ°ÁêÜÊ†áÁ≠æÂàóË°®">
                                                    <div v-for="tag in (sessionFaqAllTags || [])" :key="`mgr_${tag}`" class="aicr-session-faq-tag-manager-item" role="listitem">
                                                        <div class="aicr-session-faq-tag-manager-name">{{ tag }}</div>
                                                        <div class="aicr-session-faq-tag-manager-actions">
                                                            <button type="button" class="aicr-session-faq-filter-btn" :disabled="!!sessionFaqLoading" @click="renameSessionFaqTag(tag)" aria-label="ÈáçÂëΩÂêçÊ†áÁ≠æ">ÈáçÂëΩÂêç</button>
                                                            <button type="button" class="aicr-session-faq-filter-btn danger" :disabled="!!sessionFaqLoading" @click="deleteSessionFaqTag(tag)" aria-label="Âà†Èô§Ê†áÁ≠æ">Âà†Èô§</button>
                                                        </div>
                                                    </div>
                                                    <div v-if="(sessionFaqAllTags || []).length === 0" class="aicr-session-faq-tag-manager-empty">ÊöÇÊó†Ê†áÁ≠æ</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="aicr-session-faq-main" aria-label="Â∏∏ËßÅÈóÆÈ¢òÂàóË°®">
                                        <div class="aicr-session-faq-summary" role="status" aria-label="Á≠õÈÄâÁªìÊûú">
                                            ÂÖ± {{ (sessionFaqItems || []).length }} Êù°ÔºåÂåπÈÖç {{ (filteredSessionFaqItems || []).length }} Êù°
                                        </div>

                                            <div class="aicr-session-faq-input-row" aria-label="Ê∑ªÂä†Â∏∏ËßÅÈóÆÈ¢ò">
                                                <textarea
                                                    class="aicr-session-faq-input"
                                                    placeholder="ËæìÂÖ•ÈóÆÈ¢òÂÜÖÂÆπÔºåÊåâ Ctrl+Enter Êàñ Shift+Enter Ê∑ªÂä†"
                                                    @keydown.ctrl.enter.prevent="addSessionFaqFromInput"
                                                    @keydown.meta.enter.prevent="addSessionFaqFromInput"
                                                    @keydown.shift.enter.prevent="addSessionFaqFromInput"
                                                    aria-label="Êñ∞Â¢ûÂ∏∏ËßÅÈóÆÈ¢ò"
                                                ></textarea>
                                                <div class="aicr-session-faq-input-hint">ÊîØÊåÅÂ§öË°åÂÜÖÂÆπÔºåÈ¶ñË°å‰Ωú‰∏∫Ê†áÈ¢òÔºå‰Ωô‰∏ã‰Ωú‰∏∫Ê≠£Êñá„ÄÇ</div>
                                            </div>

                                        <div v-if="sessionFaqLoading" class="aicr-session-faq-status" role="status">Ê≠£Âú®Âä†ËΩΩÂ∏∏ËßÅÈóÆÈ¢ò...</div>
                                        <div v-else-if="sessionFaqError" class="aicr-session-faq-error" role="status">{{ sessionFaqError }}</div>

                                        <div class="aicr-session-faq-list" role="list" aria-label="Â∏∏ËßÅÈóÆÈ¢òÂàóË°®">
                                            <div
                                                v-for="item in (filteredSessionFaqItems || [])"
                                                :key="item.key"
                                                class="aicr-session-faq-item"
                                                role="listitem"
                                                tabindex="0"
                                                @click="applySessionFaqItem(item, 'insert'); closeSessionFaq()"
                                                @keydown.enter.prevent="applySessionFaqItem(item, 'insert'); closeSessionFaq()"
                                                @keydown.ctrl.enter.prevent="applySessionFaqItem(item, 'send'); closeSessionFaq()"
                                                @keydown.meta.enter.prevent="applySessionFaqItem(item, 'send'); closeSessionFaq()"
                                            >
                                                <div class="aicr-session-faq-item-header">
                                                    <div class="aicr-session-faq-item-title">{{ item.title }}</div>
                                                    <div class="aicr-session-faq-item-actions">
                                                        <button type="button" class="aicr-session-faq-item-btn" @click.stop="editSessionFaqTags(item)" aria-label="Ê†áÁ≠æ">Ê†áÁ≠æ</button>
                                                        <button type="button" class="aicr-session-faq-item-btn" @click.stop="applySessionFaqItem(item, 'insert'); closeSessionFaq()" aria-label="ÊèíÂÖ•">ÊèíÂÖ•</button>
                                                        <button type="button" class="aicr-session-faq-item-btn primary" @click.stop="applySessionFaqItem(item, 'send'); closeSessionFaq()" aria-label="ÂèëÈÄÅ">ÂèëÈÄÅ</button>
                                                        <button type="button" class="aicr-session-faq-item-btn danger" @click.stop="deleteSessionFaqItem(item)" aria-label="Âà†Èô§">Âà†Èô§</button>
                                                    </div>
                                                </div>
                                                <div v-if="Array.isArray(item.tags) && item.tags.length > 0" class="aicr-session-faq-item-tags" aria-label="ÈóÆÈ¢òÊ†áÁ≠æ">
                                                    <button
                                                        v-for="tag in item.tags"
                                                        :key="`${item.key}_${tag}`"
                                                        type="button"
                                                        class="aicr-session-faq-item-tag"
                                                        @click.stop="toggleSessionFaqTag(tag)"
                                                        :aria-label="`Á≠õÈÄâÊ†áÁ≠æÔºö${tag}`"
                                                    >{{ tag }}</button>
                                                </div>
                                                <div class="aicr-session-faq-item-prompt">{{ item.prompt }}</div>
                                            </div>

                                            <div
                                                v-if="!sessionFaqLoading && (filteredSessionFaqItems || []).length === 0"
                                                class="aicr-session-faq-empty"
                                                role="listitem"
                                            >
                                                Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÂ∏∏ËßÅÈóÆÈ¢ò
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="sessionSettingsVisible" class="aicr-session-context-modal" role="dialog" aria-modal="true" aria-label="AI ËÆæÁΩÆ">
                        <div class="aicr-session-context-modal-mask" @click="closeSessionSettings"></div>
                        <div class="aicr-session-context-modal-body aicr-session-settings-modal-body" tabindex="0" @keydown.esc="closeSessionSettings">
                            <div class="aicr-session-context-modal-header">
                                <div class="aicr-session-context-modal-title">
                                    ‚öôÔ∏è AI ËÆæÁΩÆ
                                    <span class="aicr-session-context-modal-subtitle">ÔºàÂΩìÂâçÊµèËßàÂô®Êú¨Âú∞Ôºâ</span>
                                </div>
                                <div class="aicr-session-context-modal-header-right">
                                    <button type="button" class="aicr-session-context-toolbar-btn" @click="restoreSessionSettingsDefaults" aria-label="ÊÅ¢Â§çÈªòËÆ§" title="ÊÅ¢Â§çÈªòËÆ§">ÊÅ¢Â§çÈªòËÆ§</button>
                                    <button type="button" class="aicr-session-context-toolbar-btn primary" @click="saveSessionSettings" aria-label="‰øùÂ≠ò" title="‰øùÂ≠ò">‰øùÂ≠ò</button>
                                    <button type="button" class="aicr-session-context-modal-close" @click="closeSessionSettings" aria-label="ÂÖ≥Èó≠">‚úï</button>
                                </div>
                            </div>
                            <div class="aicr-session-context-modal-content aicr-session-settings-modal-content">
                                <div class="aicr-session-settings-field">
                                    <label class="aicr-session-settings-label" for="aicr-session-bot-model">Ê®°ÂûãÔºàÂèØÈÄâÔºâ</label>
                                    <input
                                        id="aicr-session-bot-model"
                                        type="text"
                                        class="aicr-session-settings-input"
                                        :value="sessionBotModelDraft"
                                        @input="sessionBotModelDraft = $event.target.value"
                                        placeholder="‰æãÂ¶ÇÔºögpt-4o-mini"
                                        autocomplete="off"
                                        spellcheck="false"
                                        aria-label="Ê®°Âûã"
                                    />
                                    <div class="aicr-session-settings-hint">ÁïôÁ©∫Ë°®Á§∫‰ΩøÁî®ÊúçÂä°Á´ØÈªòËÆ§Ê®°Âûã„ÄÇ</div>
                                </div>

                                <div class="aicr-session-settings-field">
                                    <label class="aicr-session-settings-label" for="aicr-session-system-prompt">Á≥ªÁªüÊèêÁ§∫ËØç</label>
                                    <textarea
                                        id="aicr-session-system-prompt"
                                        class="aicr-session-settings-textarea"
                                        :value="sessionBotSystemPromptDraft"
                                        @input="sessionBotSystemPromptDraft = $event.target.value"
                                        rows="10"
                                        aria-label="Á≥ªÁªüÊèêÁ§∫ËØç"
                                    ></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="weChatSettingsVisible" class="aicr-session-context-modal" role="dialog" aria-modal="true" aria-label="ÂæÆ‰ø°Êú∫Âô®‰∫∫ËÆæÁΩÆ">
                        <div class="aicr-session-context-modal-mask" @click="closeWeChatSettings"></div>
                        <div class="aicr-session-context-modal-body aicr-session-settings-modal-body" tabindex="0" @keydown.esc="closeWeChatSettings">
                            <div class="aicr-session-context-modal-header">
                                <div class="aicr-session-context-modal-title">
                                    ü§ñ ÂæÆ‰ø°Êú∫Âô®‰∫∫
                                    <span class="aicr-session-context-modal-subtitle">ÔºàÂΩìÂâçÊµèËßàÂô®Êú¨Âú∞Ôºâ</span>
                                </div>
                                <div class="aicr-session-context-modal-header-right">
                                    <button type="button" class="aicr-session-context-toolbar-btn" @click="restoreWeChatSettingsDefaults" aria-label="ÊÅ¢Â§çÈªòËÆ§" title="ÊÅ¢Â§çÈªòËÆ§">ÊÅ¢Â§çÈªòËÆ§</button>
                                    <button type="button" class="aicr-session-context-toolbar-btn primary" @click="saveWeChatSettings" aria-label="‰øùÂ≠ò" title="‰øùÂ≠ò">‰øùÂ≠ò</button>
                                    <button type="button" class="aicr-session-context-modal-close" @click="closeWeChatSettings" aria-label="ÂÖ≥Èó≠">‚úï</button>
                                </div>
                            </div>
                            <div class="aicr-session-context-modal-content aicr-session-settings-modal-content">
                                <div class="aicr-session-settings-field">
                                    <button type="button" class="aicr-session-context-toolbar-btn" @click="addWeChatRobotDraft" aria-label="Êñ∞Â¢ûÊú∫Âô®‰∫∫" title="Êñ∞Â¢ûÊú∫Âô®‰∫∫">Êñ∞Â¢ûÊú∫Âô®‰∫∫</button>
                                </div>
                                <div class="aicr-session-settings-field">
                                    <div v-for="(bot, ri) in (weChatRobotsDraft || [])" :key="bot.id || ('wr_' + ri)">
                                        <div class="aicr-session-settings-field">
                                            <label class="aicr-session-settings-label">ÂêçÁß∞</label>
                                            <input
                                                type="text"
                                                class="aicr-session-settings-input"
                                                :value="bot.name"
                                                @input="weChatRobotsDraft[ri].name = $event.target.value"
                                                placeholder="Êú∫Âô®‰∫∫ÂêçÁß∞"
                                                autocomplete="off"
                                                spellcheck="false"
                                                aria-label="Êú∫Âô®‰∫∫ÂêçÁß∞"
                                            />
                                        </div>
                                        <div class="aicr-session-settings-field">
                                            <label class="aicr-session-settings-label">Webhook URL</label>
                                            <input
                                                type="text"
                                                class="aicr-session-settings-input"
                                                :value="bot.webhook"
                                                @input="weChatRobotsDraft[ri].webhook = $event.target.value"
                                                placeholder="‰ºÅ‰∏öÂæÆ‰ø°Êú∫Âô®‰∫∫Webhook"
                                                autocomplete="off"
                                                spellcheck="false"
                                                aria-label="Webhook"
                                            />
                                        </div>
                                        <div class="aicr-session-settings-field">
                                            <label class="aicr-session-settings-label">ÂêØÁî®</label>
                                            <input
                                                type="checkbox"
                                                :checked="!!bot.enabled"
                                                @change="weChatRobotsDraft[ri].enabled = $event.target.checked"
                                                aria-label="ÂêØÁî®Êú∫Âô®‰∫∫"
                                            />
                                        </div>
                                        <div class="aicr-session-settings-field">
                                            <label class="aicr-session-settings-label">Ëá™Âä®ËΩ¨ÂèëÂä©ÊâãÂõûÂ§ç</label>
                                            <input
                                                type="checkbox"
                                                :checked="!!bot.autoForward"
                                                @change="weChatRobotsDraft[ri].autoForward = $event.target.checked"
                                                aria-label="Ëá™Âä®ËΩ¨ÂèëÂä©ÊâãÂõûÂ§ç"
                                            />
                                        </div>
                                        <div class="aicr-session-settings-field">
                                            <button type="button" class="aicr-session-context-toolbar-btn" @click="removeWeChatRobotDraft(ri)" aria-label="Âà†Èô§Êú∫Âô®‰∫∫" title="Âà†Èô§Êú∫Âô®‰∫∫">Âà†Èô§</button>
                                        </div>
                                        <hr />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- ËØÑËÆ∫Èù¢ÊùøÔºöÂú®Ê†ëÂΩ¢ËßÜÂõæÂíå‰ºöËØùËßÜÂõæ‰∏ãÈÉΩÊòæÁ§∫ÔºåÊîØÊåÅ‰ºöËØùËÅäÂ§©ÂäüËÉΩ -->
            <aside class="aicr-comments" aria-label="ËØÑËÆ∫Âå∫" v-show="!commentsCollapsed" :style="{ width: commentsWidth + 'px' }">
                <div class="sidebar-scroll-container">
                    <comment-panel 
                        :comments="currentComments" 
                        :file="viewMode === 'tree' ? currentFile : (activeSession ? { sessionKey: activeSession.id || activeSession.key, fileKey: activeSession.id || activeSession.key } : null)"
                        :active-session="viewMode === 'tags' ? activeSession : null"
                        :view-mode="viewMode"
                        :new-comment="newComment" 
                        :loading="loading" 
                        :error="errorMessage" 
                        :collapsed="commentsCollapsed"
                        @comment-submit="handleCommentSubmit" 
                        @comment-input="handleCommentInput"
                        @comment-delete="handleCommentDelete"
                        @comment-resolve="handleCommentResolve"
                        @comment-reopen="handleCommentReopen"
                        @toggle-collapse="toggleComments"
                    ></comment-panel>
                </div>
            </aside>

            <!-- ËØÑËÆ∫Âå∫Êî∂Ëµ∑ÊåâÈíÆ (Â±ïÂºÄÊó∂ÊòæÁ§∫ÔºåË∑üÈöèËØÑËÆ∫Âå∫ÂÆΩÂ∫¶) -->
            <div 
                class="comments-toggle" 
                v-show="!commentsCollapsed"
                @click="toggleComments"
                title="Êî∂Ëµ∑ËØÑËÆ∫Âå∫"
                :style="{ right: (commentsWidth - 14) + 'px', left: 'auto' }">
                <i class="fas fa-chevron-right"></i>
            </div>

            <!-- ËØÑËÆ∫Âå∫Êî∂Ëµ∑ÂêéÁöÑÂ±ïÂºÄÊääÊâã -->
            <button 
                type="button"
                class="comments-expand-handle" 
                v-show="commentsCollapsed"
                @click="toggleComments"
                aria-label="Â±ïÂºÄËØÑËÆ∫Âå∫"
                title="Â±ïÂºÄËØÑËÆ∫Âå∫">
                <i class="fas fa-chevron-left" aria-hidden="true"></i>
            </button>
            
        </main>
    </div>

    <!-- ÂÖ®Â±ÄÂä†ËΩΩÊåáÁ§∫Âô® -->
    <section id="global-loading-indicator" class="loading-indicator" aria-hidden="true" aria-label="ÂÖ®Â±ÄÂä†ËΩΩ‰∏≠">
      <div class="loading-content">
          <div class="loading-spinner" role="status" aria-live="polite" aria-label="Ê≠£Âú®Âä†ËΩΩ"></div>
          <p class="loading-text" id="loading-text">Ê≠£Âú®Âä†ËΩΩ...</p>
      </div>
    </section>

    
    
    <!-- ËÑöÊú¨Ê†áÁ≠æÁßªÂà∞VueÂ∫îÁî®ÂÆπÂô®Â§ñÈÉ® -->
    <!-- Âü∫Á°ÄÈÖçÁΩÆÂíåÂ∑•ÂÖ∑ -->
    <script type="module" src="../../config.js"></script>
    <script type="module" src="../../utils/chartViewer.js"></script>
    
    <!-- Mermaid Áõ∏ÂÖ≥ËÑöÊú¨ÔºàÊåâ‰æùËµñÈ°∫Â∫èÂä†ËΩΩÔºâ -->
    <script type="module" src="../../utils/mermaid.js"></script>
    <script type="module" src="../../utils/mermaidDebug.js"></script>
    <script type="module" src="../../utils/mermaidRenderer.js"></script>
    
    <!-- Êèí‰ª∂ÁªÑ‰ª∂ -->
    <script type="module" src="../../views/aicr/components/fileTree/index.js"></script>
    <script type="module" src="../../views/aicr/components/codeView/index.js"></script>
    <script type="module" src="../../views/aicr/components/commentPanel/index.js"></script>
    <script type="module" src="../../views/aicr/components/sessionList/index.js"></script>
    
    <!-- ‰∏ªÂ∫îÁî®ÂÖ•Âè£ -->
    <script type="module" src="../../views/aicr/index.js"></script>
    
    <!-- ÊÄßËÉΩÁõëÊéßÔºàÊúÄÂêéÂä†ËΩΩÔºâ -->
    <script type="module" src="../../utils/performance.js"></script>
</body>
</html>
