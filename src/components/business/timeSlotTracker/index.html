<!-- æ—¶é—´æ®µè¿½è¸ªç³»ç»Ÿæ¨¡æ¿ -->
<div id="time-slot-tracker" class="time-slot-tracker" v-if="showTimeSlotTracker">
    <!-- æ—¶é—´æ®µå¤´éƒ¨ -->
    <div class="time-slot-header">
        <div class="time-slot-title">
            <span class="time-slot-icon">{{ currentTimeSlot?.config?.icon || 'â°' }}</span>
            <span>{{ currentTimeSlot?.config?.name || 'æ—¶é—´æ®µè¿½è¸ª' }}</span>
        </div>
        <div class="time-slot-status">
            <div class="status-indicator" :class="{ tracking: isTracking }" aria-hidden="true"></div>
            <span>{{ isTracking ? 'è¿½è¸ªä¸­' : 'å¾…å¼€å§‹' }}</span>
        </div>
    </div>

    <!-- æ—¶é—´æ®µæè¿° -->
    <div class="time-slot-description" v-if="currentTimeSlot?.config?.description">
        <p class="time-slot-description-text">
            {{ currentTimeSlot.config.description }}
        </p>
    </div>

    <!-- ä»»åŠ¡æ¸…å• -->
    <div class="time-slot-tasks" v-if="currentTimeSlot?.config?.tasks">
        <h4>ğŸ“‹ ä»»åŠ¡æ¸…å•</h4>
        <div class="task-checklist">
            <button
                type="button"
                v-for="(task, index) in currentTimeSlot.config.tasks" 
                :key="index"
                class="task-item"
                @click="toggleTask(index)"
                :aria-pressed="completedTasks.has(index)"
                :aria-label="`åˆ‡æ¢ä»»åŠ¡ï¼š${task}`"
            >
                <span class="task-checkbox" :class="{ checked: completedTasks.has(index) }" aria-hidden="true"></span>
                <span>{{ task }}</span>
            </button>
        </div>
    </div>

    <!-- æ•°æ®è¿½è¸ªæŒ‡æ ‡ -->
    <div class="time-slot-metrics" v-if="currentTimeSlot?.config?.trackingMetrics">
        <h4 class="metrics-title">ğŸ“Š æ•°æ®è¿½è¸ª</h4>
        <div class="metrics-grid">
            <div 
                v-for="(metric, key) in currentTimeSlot.config.trackingMetrics" 
                :key="key"
                class="metric-item"
            >
                <label class="metric-label" :for="`metric-${key}`">{{ metric.label }}</label>
                <div v-if="metric.type === 'rating'" class="rating-input">
                    <button
                        type="button"
                        v-for="i in metric.max" 
                        :key="i"
                        class="rating-star"
                        :class="{ active: trackingMetrics[key] >= i }"
                        @click="updateRating(key, i)"
                        :aria-label="`${metric.label} è¯„åˆ† ${i}/${metric.max}`"
                        :aria-pressed="trackingMetrics[key] >= i"
                    >
                        {{ metric.unit }}
                    </button>
                </div>
                <input 
                    v-else
                    :id="`metric-${key}`"
                    v-model="trackingMetrics[key]"
                    :type="metric.type === 'number' ? 'number' : 'text'"
                    :placeholder="`è¯·è¾“å…¥${metric.label}`"
                    :title="metric.label"
                    :aria-label="metric.label"
                    class="metric-input"
                    @input="updateMetric(key, $event.target.value)"
                />
            </div>
        </div>
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="time-slot-actions">
        <button 
            type="button"
            v-if="!isTracking" 
            @click="startTracking" 
            class="action-btn start-btn"
        >
            â–¶ï¸ å¼€å§‹è¿½è¸ª
        </button>
        <button 
            type="button"
            v-if="isTracking" 
            @click="stopTracking" 
            class="action-btn stop-btn"
        >
            â¹ï¸ åœæ­¢è¿½è¸ª
        </button>
        <button 
            type="button"
            @click="saveTrackingData" 
            class="action-btn save-btn"
        >
            ğŸ’¾ ä¿å­˜æ•°æ®
        </button>
    </div>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="time-slot-stats" v-if="timeSlotStats">
        <h4 class="stats-title">ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯</h4>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value">{{ timeSlotStats.totalDays }}</div>
                <div class="stat-label">è¿½è¸ªå¤©æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ timeSlotStats.averageDuration.toFixed(1) }}</div>
                <div class="stat-label">å¹³å‡æ—¶é•¿(h)</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ (timeSlotStats.completionRate * 100).toFixed(0) }}%</div>
                <div class="stat-label">å®Œæˆç‡</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ timeSlotStats.totalDuration.toFixed(1) }}</div>
                <div class="stat-label">æ€»æ—¶é•¿(h)</div>
            </div>
        </div>
    </div>

    <!-- å†å²è®°å½• -->
    <div class="time-slot-history" v-if="trackingHistory.length > 0">
        <h4 class="history-title">ğŸ“… å†å²è®°å½•</h4>
        <div class="history-list">
            <div 
                v-for="(record, index) in trackingHistory" 
                :key="index"
                class="history-item"
            >
                <span class="history-date">{{ formatDate(record.date) }}</span>
                <span class="history-duration">{{ record.duration.toFixed(1) }}h</span>
            </div>
        </div>
    </div>
</div>

<!-- æ—¶é—´æ®µé€‰æ‹©å™¨ -->
<div id="time-slot-selector" class="time-slot-selector" v-if="showTimeSlotSelector">
    <h3>é€‰æ‹©è¦è¿½è¸ªçš„æ—¶é—´æ®µ</h3>
    <div class="time-slot-options">
        <button
            type="button"
            v-for="(config, timeRange) in allTimeSlotConfigs" 
            :key="timeRange"
            class="time-slot-option"
            @click="selectTimeSlot(timeRange)"
            :aria-label="`é€‰æ‹©æ—¶é—´æ®µï¼š${config.name}ï¼ˆ${timeRange}ï¼‰`"
        >
            <div class="option-icon">{{ config.icon }}</div>
            <div class="option-content">
                <div class="option-title">{{ config.name }}</div>
                <div class="option-time">{{ timeRange }}</div>
                <div class="option-description">{{ config.description }}</div>
            </div>
        </button>
    </div>
</div>
