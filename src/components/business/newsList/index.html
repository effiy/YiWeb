<!-- 新闻列表组件模板 -->
<section class="news-section" aria-label="新闻内容">
    <!-- 加载状态 -->
    <yi-loading
        v-if="loading"
        text="正在加载新闻数据..."
        :subtext="'正在获取 ' + currentDateDisplay + ' 的新闻资讯'"
    ></yi-loading>

    <!-- 错误状态 -->
    <yi-error-state
        v-else-if="error"
        :message="error"
        icon-class="fas fa-exclamation-triangle"
        :show-retry="true"
        retry-text="重新加载"
        @retry="$emit('load-news-data')"
    >
        <div class="error-submessage">网络连接可能存在问题，请检查后重试</div>
        <template #retryIcon>
            <i class="fas fa-redo" aria-hidden="true"></i>
        </template>
    </yi-error-state>

    <!-- 搜索结果显示 -->
    <div v-else-if="searchQuery && searchResults.length > 0" class="search-results">
        <!-- 导出按钮 -->
        <div class="export-section">
            <button @click="exportData" class="export-btn" type="button" title="导出搜索结果">
                <i class="fas fa-download" aria-hidden="true"></i>
                <span>导出搜索结果</span>
            </button>
        </div>
        
        <header class="search-results-header">
            <span class="search-results-count">找到 {{ searchResults.length }} 条相关新闻</span>
            <span class="search-query">"{{ searchQuery }}"</span>
        </header>
        <div class="news-stats" v-if="getNewsStats().hasData">
            <div class="stats-item stats-item-total" title="总新闻数">
                <span class="stats-number">{{ getNewsStats().total }}</span>
                <span class="stats-label">新闻</span>
            </div>
            <div class="stats-item stats-item-resolved" title="已读数">
                <span class="stats-number">{{ getNewsStats().read }}</span>
                <span class="stats-label">已读</span>
            </div>
            <div class="stats-item stats-item-pending" title="收藏数">
                <span class="stats-number">{{ getNewsStats().fav }}</span>
                <span class="stats-label">收藏</span>
            </div>
        </div>
        
        <div class="news-grid" role="list">
            <article 
                v-for="item in searchResults" 
                :key="item.link || item.title"
                @click="handleNewsClick(item)"
                :class="['news-item', { 
                    highlighted: isHighlighted(item),
                    clicked: clickedItems.has(item.link || item.title),
                    read: isRead(item),
                    favorited: isFavorited(item)
                }]"
                :title="item.title"
                role="listitem"
            >
                <header class="news-header">
                    <h3 class="news-title">
                        {{ item.title }}
                    </h3>
                </header>
                <div class="news-meta">
                    <div class="news-category-tags">
                        <span 
                            v-if="getDomainCategory(item)" 
                            class="news-domain-tag"
                            :style="{ backgroundColor: getDomainCategory(item).color }"
                            :title="getDomainDisplayName(item)"
                        >
                            <i :class="getDomainCategory(item).icon" aria-hidden="true"></i>
                            {{ getDomainDisplayName(item) }}
                        </span>
                    </div>
                    <time class="news-time" :datetime="item.isoDate">
                        <i class="fas fa-clock" aria-hidden="true"></i>
                        <span>{{ getTimeAgo(item.isoDate) }}</span>
                    </time>
                </div>
                
                <markdown-view class="news-content md-preview-body" :content="item.content || item.contentSnippet || item.excerpt"></markdown-view>
                
                <footer class="news-footer">
                    <div class="news-source">
                        <i class="fas fa-newspaper" aria-hidden="true"></i>
                        <span>{{ item.creator || '未知来源' }}</span>
                    </div>
                    <button type="button" class="favorite-btn" :class="{ active: isFavorited(item) }" @click.stop="$emit('toggle-favorite', item)" :aria-pressed="isFavorited(item)" aria-label="收藏该新闻">
                        <i :class="[isFavorited(item) ? 'fa-solid fa-star' : 'fa-regular fa-star']" aria-hidden="true"></i>
                        <span class="favorite-text">{{ isFavorited(item) ? '已收藏' : '收藏' }}</span>
                    </button>
                    <div v-if="item.link" class="news-link">
                        <span>阅读原文</span>
                        <i class="fas fa-external-link-alt" aria-hidden="true"></i>
                    </div>
                </footer>
            </article>
        </div>
    </div>

    <!-- 空搜索结果 -->
    <yi-empty-state
        v-else-if="searchQuery && searchResults.length === 0"
        wrapper-class="empty-state"
        :cardless="true"
        title="未找到相关新闻"
        subtitle="尝试使用其他关键词搜索"
        title-class="empty-title"
        subtitle-class="empty-subtitle"
    >
        <template #icon>
            <div class="empty-icon" aria-hidden="true">
                <i class="fas fa-search" aria-hidden="true"></i>
            </div>
        </template>
    </yi-empty-state>

    <!-- 分类新闻显示 -->
    <div v-else-if="hasNewsData">
        <section 
            v-for="(category, categoryKey) in displayCategories" 
            :key="categoryKey"
            v-show="shouldShowCategory(categoryKey) && category.news.length > 0"
            class="news-category"
            :aria-label="`${category.title || categoryKey}分类新闻`"
        >
            <div class="news-stats" v-if="getNewsStats().hasData">
                <div class="stats-item stats-item-total" title="总新闻数">
                    <span class="stats-number">{{ getNewsStats().total }}</span>
                    <span class="stats-label">新闻</span>
                </div>
                <div class="stats-item stats-item-resolved" title="已读数">
                    <span class="stats-number">{{ getNewsStats().read }}</span>
                    <span class="stats-label">已读</span>
                </div>
                <div class="stats-item stats-item-pending" title="收藏数">
                    <span class="stats-number">{{ getNewsStats().fav }}</span>
                    <span class="stats-label">收藏</span>
                </div>
            </div>
            <div class="news-grid" role="list">
                <article 
                    v-for="item in category.news" 
                    :key="item.link || item.title"
                    @click="handleNewsClick(item)"
                    :class="['news-item', { 
                        highlighted: isHighlighted(item),
                        clicked: clickedItems.has(item.link || item.title),
                        read: isRead(item),
                        favorited: isFavorited(item)
                    }]"
                    :title="item.title"
                    role="listitem"
                >
                    <header class="news-header">
                        <h3 class="news-title">
                            {{ item.title }}
                        </h3>
                    </header>
                    
                    <div class="news-meta">
                        <div class="news-category-tags">
                            <span 
                                v-if="getDomainCategory(item)" 
                                class="news-domain-tag"
                                :style="{ backgroundColor: getDomainCategory(item).color }"
                                :title="getDomainDisplayName(item)"
                            >
                                <i :class="getDomainCategory(item).icon" aria-hidden="true"></i>
                                {{ getDomainDisplayName(item) }}
                            </span>
                        </div>
                        <time class="news-time" :datetime="item.isoDate">
                            <i class="fas fa-clock" aria-hidden="true"></i>
                            <span>{{ getTimeAgo(item.isoDate) }}</span>
                        </time>
                    </div>
                    
                    <markdown-view class="news-content md-preview-body" :content="item.content || item.contentSnippet || item.excerpt"></markdown-view>
                    
                    <footer class="news-footer">
                        <div class="news-source">
                        <i class="fas fa-newspaper" aria-hidden="true"></i>
                        <span>{{ item.creator || '未知来源' }}</span>
                    </div>
                    <button type="button" class="favorite-btn" :class="{ active: isFavorited(item) }" @click.stop="$emit('toggle-favorite', item)" :aria-pressed="isFavorited(item)" aria-label="收藏该新闻">
                        <i :class="[isFavorited(item) ? 'fa-solid fa-star' : 'fa-regular fa-star']" aria-hidden="true"></i>
                        <span class="favorite-text">{{ isFavorited(item) ? '已收藏' : '收藏' }}</span>
                    </button>
                        <div v-if="item.link" class="news-link">
                            <span>阅读原文</span>
                            <i class="fas fa-external-link-alt" aria-hidden="true"></i>
                        </div>
                    </footer>
                </article>
            </div>
        </section>
    </div>

    <!-- 空状态 -->
    <yi-empty-state
        v-else
        wrapper-class="empty-state"
        :cardless="true"
        title="暂无新闻数据"
        subtitle="请稍后重试或联系管理员"
        title-class="empty-title"
        subtitle-class="empty-subtitle"
    >
        <template #icon>
            <div class="empty-icon" aria-hidden="true">
                <i class="fas fa-newspaper" aria-hidden="true"></i>
            </div>
        </template>
    </yi-empty-state>
</section>
