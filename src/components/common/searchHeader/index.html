<header class="header-row" role="banner">
    <!-- 第一行：搜索框和筛选 -->
    <section class="search-row">
        <form class="search-box" role="search" @submit.prevent>
            <button type="button" class="search-logo" @click="goHome()" :aria-label="homeAriaLabel">
                <i :class="homeIconClass" aria-hidden="true"></i>
            </button>
            <div class="search-input-wrapper">
                <textarea 
                    id="messageInput"
                    :value="searchQuery"
                    @input="handleSearchInput"
                    @keydown="handleKeydown"
                    @compositionstart="handleCompositionStart"
                    @compositionend="handleCompositionEnd"
                    @focus="handleSearchFocus"
                    @blur="handleSearchBlur"
                    :placeholder="placeholder" 
                    rows="1" 
                    maxlength="2000"
                    aria-label="消息输入框"
                    autocomplete="off"
                    spellcheck="false"
                    :aria-expanded="showSuggestions"
                    :aria-controls="showSuggestions ? 'search-suggestions' : null"
                ></textarea>
                
                <!-- 搜索建议下拉框 -->
                <div 
                    v-if="showSuggestions && hasSuggestions"
                    id="search-suggestions"
                    class="search-suggestions"
                    role="listbox"
                    aria-label="搜索建议"
                >
                    <div 
                        v-for="(suggestion, index) in computedSearchSuggestions"
                        :key="`suggestion-${index}-${suggestion}`"
                        @click="handleSuggestionClick(suggestion)"
                        @mouseenter="selectedSuggestionIndex = index"
                        :class="['suggestion-item', { 'selected': selectedSuggestionIndex === index }]"
                        role="option"
                        :aria-selected="selectedSuggestionIndex === index"
                        tabindex="0"
                        @keydown.enter="handleSuggestionClick(suggestion)"
                        @keydown.space="handleSuggestionClick(suggestion)"
                    >
                        <i class="fas fa-search" aria-hidden="true"></i>
                        <span class="suggestion-text">{{ suggestion }}</span>
                    </div>
                </div>
                
                <!-- 清除搜索按钮 -->
                <div class="suggestion-clear" v-if="searchQuery && showSuggestions">
                    <button 
                        type="button"
                        @click="handleClearSearch"
                        class="clear-search-btn"
                        title="清除搜索"
                        aria-label="清除搜索内容"
                    >
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                </div>
                
                <!-- 实时过滤指示器 -->
                <div v-if="isFiltering" class="filter-indicator" role="status" aria-live="polite" aria-label="正在过滤">
                    <i class="fas fa-spinner fa-spin" aria-hidden="true"></i>
                </div>
            </div>
        </form>
        
        <!-- 右侧控制按钮区域 -->
        <div class="header-controls">
            <button
                type="button"
                v-if="showAicrButton"
                @click="openLink(aicrHref)"
                class="header-icon-btn"
                :title="aicrButtonTitle"
                :aria-label="aicrButtonTitle"
            >
                <i class="fas fa-code" aria-hidden="true"></i>
            </button>
            <button
                type="button"
                v-if="showNewsButton"
                @click="openLink(newsHref)"
                class="header-icon-btn"
                :title="newsButtonTitle"
                :aria-label="newsButtonTitle"
            >
                <i class="fas fa-newspaper" aria-hidden="true"></i>
            </button>
            <button
                type="button"
                v-if="showRssManagerButton"
                @click="$emit('open-rss-manager')"
                class="header-icon-btn"
                title="RSS 管理"
                aria-label="RSS 管理"
            >
                <i class="fas fa-rss" aria-hidden="true"></i>
            </button>
            <button
                type="button"
                v-if="showAuthButton"
                @click="openAuth($event)"
                class="header-icon-btn"
                title="API 鉴权"
                aria-label="API 鉴权"
            >
                <i class="fas fa-key" aria-hidden="true"></i>
            </button>
            <!-- 折叠按钮 -->
            <button 
                type="button"
                v-if="sidebarToggleEnabled"
                @click="handleToggleSidebar"
                class="sidebar-toggle-btn"
                title="切换侧边栏"
                :aria-label="sidebarCollapsed ? '展开侧边栏' : '收起侧边栏'"
                :aria-expanded="!sidebarCollapsed"
            >
                <i :class="sidebarCollapsed ? 'fas fa-chevron-right' : 'fas fa-chevron-left'" aria-hidden="true"></i>
            </button>
            
        </div>
    </section>
</header> 
