<!-- 项目文件列表组件 -->
<section class="news-section" aria-label="项目文件内容">
    <!-- 加载状态 -->
    <div v-if="loading" class="loading-container" role="status" aria-live="polite">
        <div class="loading-spinner" aria-hidden="true"></div>
        <div class="loading-text">正在加载项目文件数据...</div>
        <div class="loading-subtext">正在获取 {{ currentDateDisplay }} 的项目文件</div>
    </div>

    <!-- 错误状态 -->
    <div v-else-if="error" class="error-container" role="alert">
        <div class="error-icon" aria-hidden="true">
            <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
        </div>
        <div class="error-message">{{ error }}</div>
        <div class="error-submessage">网络连接可能存在问题，请检查后重试</div>
        <button type="button" @click="$emit('load-project-files-data')" class="retry-button">
            <i class="fas fa-redo" aria-hidden="true"></i>
            重新加载
        </button>
    </div>

    <!-- 搜索结果显示 -->
    <div v-else-if="searchQuery && filteredProjectFiles.length > 0" class="search-results">
        <header class="search-results-header">
            <span class="search-results-count">找到 {{ filteredProjectFiles.length }} 个相关文件</span>
            <span class="search-query">"{{ searchQuery }}"</span>
        </header>
        <!-- 文件统计条 -->
        <div class="news-stats" v-if="getFileStats().hasData">
            <div class="stats-item stats-item-total" title="总文件数">
                <span class="stats-number">{{ getFileStats().total }}</span>
                <span class="stats-label">文件</span>
            </div>
            <div class="stats-item stats-item-resolved" title="已读数">
                <span class="stats-number">{{ getFileStats().read }}</span>
                <span class="stats-label">已读</span>
            </div>
            <div class="stats-item stats-item-pending" title="收藏数">
                <span class="stats-number">{{ getFileStats().fav }}</span>
                <span class="stats-label">收藏</span>
            </div>
        </div>
        
        <div class="news-grid" role="list">
            <article 
                v-for="file in filteredProjectFiles" 
                :key="file.id || file.filePath || file.fileName"
                @click="openProjectFile(file)"
                tabindex="0"
                @keydown.enter.prevent="openProjectFile(file)"
                @keydown.space.prevent="openProjectFile(file)"
                :class="['news-item', { 
                    highlighted: isHighlighted(file),
                    clicked: clickedItems.has(file.filePath || file.fileName),
                    read: isRead(file),
                    favorited: isFavorited(file)
                }]"
                :title="file.title || file.fileName"
                role="listitem"
            >
                <header class="news-header">
                    <h3 class="news-title">
                        {{ file.title || file.fileName || '未命名文件' }}
                    </h3>
                </header>
                
                <div class="news-meta">
                    <div class="news-category-tags">
                        <span 
                            class="news-domain-tag"
                            :style="getFileTypeStyle(file)"
                            :title="getFileTypeLabel(getFileTypeFromFile(file))"
                        >
                            <i :class="getFileTypeIcon(file)" aria-hidden="true"></i>
                            {{ getFileTypeLabel(getFileTypeFromFile(file)) }}
                        </span>
                    </div>
                    <time class="news-time" :datetime="file.updatedTime">
                        <i class="fas fa-clock" aria-hidden="true"></i>
                        <span>{{ formatTime(file.updatedTime) }}</span>
                    </time>
                </div>
                
                <div class="news-excerpt">{{ extractFileExcerpt(file) }}</div>
                
                <footer class="news-footer">
                    <div class="news-source">
                        <i class="fas fa-file-code" aria-hidden="true"></i>
                        <span>{{ file.filePath || '未知路径' }}</span>
                    </div>
                    <button type="button" class="favorite-btn" :class="{ active: isFavorited(file) }" @click.stop="$emit('toggle-favorite', file)" :aria-pressed="isFavorited(file)" aria-label="收藏该文件">
                        <i :class="[isFavorited(file) ? 'fa-solid fa-star' : 'fa-regular fa-star']" aria-hidden="true"></i>
                        <span class="favorite-text">{{ isFavorited(file) ? '已收藏' : '收藏' }}</span>
                    </button>
                    <div v-if="file.filePath" class="news-link">
                        <span>打开文件</span>
                        <i class="fas fa-external-link-alt" aria-hidden="true"></i>
                    </div>
                </footer>
            </article>
        </div>
    </div>

    <!-- 空搜索结果 -->
    <div v-else-if="searchQuery && filteredProjectFiles.length === 0" class="empty-state" role="status">
        <div class="empty-icon" aria-hidden="true">
            <i class="fas fa-search" aria-hidden="true"></i>
        </div>
        <div class="empty-title">未找到相关文件</div>
        <div class="empty-subtitle">尝试使用其他关键词搜索</div>
    </div>

    <!-- 项目文件显示 -->
    <div v-else-if="hasProjectFilesData">
        <!-- 导出按钮 -->
        <div class="export-section">
            <button @click="exportData" class="export-btn" type="button" title="导出项目文件数据">
                <i class="fas fa-download" aria-hidden="true"></i>
                <span>导出项目文件</span>
            </button>
        </div>
        
        <!-- 文件统计条 -->
        <div class="news-stats" v-if="getFileStats().hasData">
            <div class="stats-item stats-item-total" title="总文件数">
                <span class="stats-number">{{ getFileStats().total }}</span>
                <span class="stats-label">文件</span>
            </div>
            <div class="stats-item stats-item-resolved" title="已读数">
                <span class="stats-number">{{ getFileStats().read }}</span>
                <span class="stats-label">已读</span>
            </div>
            <div class="stats-item stats-item-pending" title="收藏数">
                <span class="stats-number">{{ getFileStats().fav }}</span>
                <span class="stats-label">收藏</span>
            </div>
        </div>
        
        <div class="news-grid" role="list">
            <article 
                v-for="file in projectFiles" 
                :key="file.fileId"
                @click="openProjectFile(file)"
                tabindex="0"
                @keydown.enter.prevent="openProjectFile(file)"
                @keydown.space.prevent="openProjectFile(file)"
                :class="['news-item', { 
                    highlighted: isHighlighted(file),
                    clicked: clickedItems.has(file.fileId),
                    read: isRead(file),
                    favorited: isFavorited(file)
                }]"
                :title="file.fileId || '未命名文件'"
                role="listitem"
            >
                <header class="news-header">
                    <h3 class="news-title">
                        {{ file.fileId || '未命名文件' }}
                    </h3>
                </header>
                
                <div class="news-meta">
                    <div class="news-category-tags">
                        <span 
                            class="news-domain-tag"
                            :style="getFileTypeStyle(file)"
                            :title="getFileTypeLabel(getFileTypeFromFile(file))"
                        >
                            <i :class="getFileTypeIcon(file)" aria-hidden="true"></i>
                            {{ getFileTypeLabel(getFileTypeFromFile(file)) }}
                        </span>
                    </div>
                    <time class="news-time" :datetime="file.updatedTime">
                        <i class="fas fa-clock" aria-hidden="true"></i>
                        <span>{{ formatTime(file.updatedTime) }}</span>
                    </time>
                </div>
                
                <div class="news-excerpt">{{ extractFileExcerpt(file) }}</div>
                
                <footer class="news-footer">
                    <div class="news-source">
                        <i class="fas fa-file-code" aria-hidden="true"></i>
                        <span>
                            {{ (file.projectId && file.versionId) 
                                ? (file.projectId + ' · ' + file.versionId)
                                : '未知项目 · 版本' 
                            }}
                        </span>
                    </div>
                    <button type="button" class="favorite-btn" :class="{ active: isFavorited(file) }" @click.stop="$emit('toggle-favorite', file)" :aria-pressed="isFavorited(file)" aria-label="收藏该文件">
                        <i :class="[isFavorited(file) ? 'fa-solid fa-star' : 'fa-regular fa-star']" aria-hidden="true"></i>
                        <span class="favorite-text">{{ isFavorited(file) ? '已收藏' : '收藏' }}</span>
                    </button>
                    <div v-if="file.filePath" class="news-link">
                        <span>打开文件</span>
                        <i class="fas fa-external-link-alt" aria-hidden="true"></i>
                    </div>
                </footer>
            </article>
        </div>
    </div>

    <!-- 空状态 -->
    <div v-else class="empty-state" role="status">
        <div class="empty-icon" aria-hidden="true">
            <i class="fas fa-file-code" aria-hidden="true"></i>
        </div>
        <div class="empty-title">暂无项目文件</div>
        <div class="empty-subtitle">请稍后重试或联系管理员</div>
    </div>
</section>
