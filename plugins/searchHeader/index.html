<header class="header-row" role="banner">
    <!-- 第一行：搜索框和筛选 -->
    <div class="search-row">
        <div class="search-box" role="search">
            <div class="search-logo" aria-hidden="true" @click="goHome()">
                <i class="fas fa-brain" aria-label="AI大脑图标"></i>
            </div>
            <div class="search-input-wrapper">
                <textarea 
                    id="messageInput"
                    :value="searchQuery"
                    @input="handleSearchInput"
                    @keydown="handleKeydown"
                    @focus="handleSearchFocus"
                    @blur="handleSearchBlur"
                    placeholder="搜索任务内容，支持标题、描述、输入输出、步骤等..." 
                    rows="1" 
                    maxlength="2000"
                    aria-label="消息输入框"
                    autocomplete="off"
                    spellcheck="false"
                    :aria-expanded="showSuggestions"
                    :aria-controls="showSuggestions ? 'search-suggestions' : null"
                ></textarea>
                
                <!-- 搜索建议下拉框 -->
                <div 
                    v-if="showSuggestions && hasSuggestions"
                    id="search-suggestions"
                    class="search-suggestions"
                    role="listbox"
                    aria-label="搜索建议"
                >
                    <div 
                        v-for="(suggestion, index) in computedSearchSuggestions"
                        :key="`suggestion-${index}-${suggestion}`"
                        @click="handleSuggestionClick(suggestion)"
                        @mouseenter="selectedSuggestionIndex = index"
                        :class="['suggestion-item', { 'selected': selectedSuggestionIndex === index }]"
                        role="option"
                        :aria-selected="selectedSuggestionIndex === index"
                        tabindex="0"
                        @keydown.enter="handleSuggestionClick(suggestion)"
                        @keydown.space="handleSuggestionClick(suggestion)"
                    >
                        <i class="fas fa-search" aria-hidden="true"></i>
                        <span class="suggestion-text">{{ suggestion }}</span>
                    </div>
                </div>
                
                <!-- 清除搜索按钮 -->
                <div class="suggestion-clear" v-if="searchQuery && showSuggestions">
                    <button 
                        @click="handleClearSearch"
                        class="clear-search-btn"
                        title="清除搜索"
                        aria-label="清除搜索内容"
                    >
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                </div>
                
                <!-- 实时过滤指示器 -->
                <div v-if="isFiltering" class="filter-indicator" aria-hidden="true">
                    <i class="fas fa-spinner fa-spin" aria-label="正在过滤"></i>
                </div>
            </div>
        </div>
        <div class="category-filters">
            <div class="filter-buttons">
                <button 
                    v-for="category in categories" 
                    :key="category.key"
                    @click="$emit('toggle-category', category.key)"
                    :class="['filter-btn', { active: selectedCategories.has(category.key) }]"
                    :data-category="category.key"
                    :title="category.title"
                >
                    <i :class="category.icon"></i>
                    {{ category.title }}
                </button>
            </div>
            <!-- 收缩按钮 -->
            <button 
                @click="$emit('toggle-sidebar')"
                class="sidebar-toggle-btn"
                :title="sidebarCollapsed ? '展开侧边栏' : '收缩侧边栏'"
                :aria-label="sidebarCollapsed ? '展开侧边栏' : '收缩侧边栏'"
                :aria-expanded="!sidebarCollapsed"
            >
                <i :class="sidebarCollapsed ? 'fas fa-chevron-right' : 'fas fa-chevron-left'" aria-hidden="true"></i>
                <span class="sr-only">{{ sidebarCollapsed ? '展开侧边栏' : '收缩侧边栏' }}</span>
            </button>
        </div>
    </div>
</header> 
