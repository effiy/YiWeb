<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YiWeb - 代码审查</title>
    <link rel="stylesheet" href="/views/aicr/index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app">
      <!-- 顶部搜索与分类区域 -->
      <header class="header-row" role="banner" style="padding: 0;">
        <section class="search-row">
            <form class="search-box" role="search" aria-label="代码审查搜索">
                <span class="search-logo" aria-hidden="true" @click="openLink('/index.html')">
                    <i class="fas fa-globe" aria-label="代码审查图标"></i>
                </span>
                <div class="search-input-wrapper">
                    <label for="messageInput" class="visually-hidden">搜索输入框</label>
                    <textarea 
                        id="messageInput" 
                        placeholder="搜索网站、标签或描述..." 
                        rows="1" 
                        maxlength="2000"
                        aria-label="搜索输入框"
                        aria-describedby="category-filters"
                        autocomplete="off"
                        spellcheck="false"
                        @keydown="handleMessageInput"
                        @compositionstart="handleCompositionStart"
                        @compositionend="handleCompositionEnd"
                        @input="handleSearchInput"></textarea>
                    
                    <!-- 清除搜索按钮 -->
                    <div class="search-clear" v-if="searchQueryValue">
                        <button 
                            @click="clearSearch"
                            class="clear-search-btn"
                            title="清除搜索"
                            aria-label="清除搜索内容"
                        >
                            <i class="fas fa-times" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
            </form>
            
            <!-- 项目/版本选择器 -->
            <div class="project-selector-inline">
                <div class="selector-group">
                    <label for="projectSelect" class="selector-label">项目：</label>
                    <select 
                        id="projectSelect" 
                        v-model="selectedProject" 
                        @change="handleProjectChange"
                        class="selector-dropdown"
                        aria-label="选择项目">
                        <option value="" disabled>请选择项目</option>
                        <option 
                            v-for="project in projects" 
                            :key="project.id" 
                            :value="project.id">
                            {{ project.name }}
                        </option>
                    </select>
                </div>
                
                <div class="selector-group">
                    <label for="versionSelect" class="selector-label">版本：</label>
                    <select 
                        id="versionSelect" 
                        v-model="selectedVersion" 
                        @change="handleVersionChange"
                        class="selector-dropdown"
                        :disabled="!selectedProject"
                        aria-label="选择版本">
                        <option value="" disabled>请选择版本</option>
                        <option 
                            v-for="version in availableVersions" 
                            :key="version.id" 
                            :value="version.id">
                            {{ version.name }}
                        </option>
                    </select>
                </div>
                
                <button 
                    type="button" 
                    @click="refreshData"
                    :disabled="loading"
                    class="refresh-btn"
                    aria-label="刷新数据">
                    <i class="fas fa-sync-alt" :class="{ 'fa-spin': loading }"></i>
                    刷新
                </button>
            </div>
            
            <div class="collapse-btns">
              <button type="button" @click="toggleSidebar">{{ sidebarCollapsed ? '展开文件目录树' : '收起文件目录树' }}</button>
              <button type="button" @click="toggleComments">{{ commentsCollapsed ? '展开评论区' : '收起评论区' }}</button>
            </div>
        </section>
        </header>
        <main class="aicr-main">
            <aside class="aicr-sidebar" aria-label="文件目录树" v-show="!sidebarCollapsed">
                <file-tree 
                    :tree="fileTree" 
                    :selected-file-id="selectedFileId" 
                    :expanded-folders="expandedFolders" 
                    :loading="loading" 
                    :error="errorMessage" 
                    :comments="comments"
                    @file-select="handleFileSelect" 
                    @folder-toggle="handleFolderToggle"
                ></file-tree>
            </aside>
            <section class="aicr-code" aria-label="代码区">
                <code-view :file="currentFile" :loading="loading" :error="errorMessage"></code-view>
            </section>
            <aside class="aicr-comments" aria-label="评论区" v-show="!commentsCollapsed">
                <comment-panel 
                    :comments="currentComments" 
                    :file="currentFile"
                    :new-comment="newComment" 
                    :loading="loading" 
                    :error="errorMessage" 
                    @comment-submit="handleCommentSubmit" 
                    @comment-input="handleCommentInput"
                    @commenter-select="handleCommenterSelect"
                    @comment-delete="handleCommentDelete"
                    @comment-resolve="handleCommentResolve"
                    @comment-reopen="handleCommentReopen"
                ></comment-panel>
            </aside>
        </main>
    </div>

    <!-- 全局加载指示器 -->
    <section id="global-loading-indicator" class="loading-indicator" aria-hidden="true" aria-label="全局加载中">
      <div class="loading-content">
          <div class="loading-spinner" role="status" aria-live="polite" aria-label="正在加载"></div>
          <p class="loading-text" id="loading-text">正在加载...</p>
      </div>
    </section>

    <!-- 加载指示器 -->
    <section id="loading-indicator" class="loading-indicator" aria-hidden="true" aria-label="加载中">
        <div class="loading-content">
            <div class="loading-spinner" role="status" aria-live="polite" aria-label="正在加载"></div>
            <p class="loading-text" id="loading-text">正在加载...</p>
        </div>
    </section>
    
    <!-- 脚本标签移到Vue应用容器外部 -->
    <script type="module" src="/config.js"></script>
    <script type="module" src="/views/aicr/plugins/fileTree/index.js"></script>
    <script type="module" src="/views/aicr/plugins/codeView/index.js"></script>
    <script type="module" src="/views/aicr/plugins/commentPanel/index.js"></script>
    <script type="module" src="/views/aicr/index.js"></script>
    <script type="module" src="/utils/performance.js"></script>
</body>
</html> 









