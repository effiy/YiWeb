<!-- æ–‡ä»¶æ ‘ç»„ä»¶æ¨¡æ¿ -->
<aside class="file-tree-container" role="navigation" aria-label="æ–‡ä»¶ç›®å½•æ ‘">
    <!-- åŠ è½½çŠ¶æ€ -->
    <div v-if="loading" class="loading-container" role="status" aria-live="polite">
        <div class="loading-spinner" aria-hidden="true"></div>
        <div class="loading-text">æ­£åœ¨åŠ è½½æ–‡ä»¶æ ‘...</div>
    </div>

    <!-- é”™è¯¯çŠ¶æ€ -->
    <div v-else-if="error" class="error-container" role="alert">
        <div class="error-icon" aria-hidden="true">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="error-message">{{ error }}</div>
        <button @click="$emit('reload')" class="retry-button">
            <i class="fas fa-redo"></i>
            é‡æ–°åŠ è½½
        </button>
    </div>

    <!-- æ–‡ä»¶æ ‘å†…å®¹ -->
    <div v-else-if="tree.length > 0" class="file-tree-content">
        <ul class="file-tree" role="tree">
            <template v-for="item in tree" :key="item.id">
                <!-- é€’å½’ç»„ä»¶ï¼šæ–‡ä»¶æ ‘èŠ‚ç‚¹ -->
                <file-tree-node 
                    :item="item" 
                    :selected-file-id="selectedFileId"
                    :expanded-folders="expandedFolders"
                    :comments="comments"
                    @file-select="$emit('file-select', $event)"
                    @folder-toggle="$emit('folder-toggle', $event)"
                ></file-tree-node>
            </template>
        </ul>
    </div>

    <!-- ç©ºçŠ¶æ€ -->
    <div v-else class="empty-state" role="status">
        <div class="empty-icon" aria-hidden="true">
            <i class="fas fa-folder-open"></i>
        </div>
        <div class="empty-title">æš‚æ— æ–‡ä»¶</div>
        <div class="empty-subtitle">è¯·æ£€æŸ¥æ–‡ä»¶ç›®å½•æˆ–è”ç³»ç®¡ç†å‘˜</div>
    </div>
</aside>

<!-- é€’å½’ç»„ä»¶ï¼šæ–‡ä»¶æ ‘èŠ‚ç‚¹ -->
<script type="text/x-template" id="file-tree-node-template">
    <li 
        class="file-tree-node"
        role="treeitem"
        :aria-expanded="item.type === 'folder' ? isFolderExpanded(item.id) : undefined"
    >
        <!-- æ–‡ä»¶å¤¹ -->
        <div 
            v-if="item.type === 'folder'"
            :class="['file-tree-item', 'folder-item', { 
                expanded: isFolderExpanded(item.id)
            }]"
            @click="toggleFolder(item.id)"
            :title="`æ–‡ä»¶å¤¹: ${item.name}`"
            tabindex="0"
            @keydown.enter="toggleFolder(item.id)"
            @keydown.space="toggleFolder(item.id)"
        >
            <span class="folder-toggle" aria-hidden="true">
                <i :class="['fas', isFolderExpanded(item.id) ? 'fa-chevron-down' : 'fa-chevron-right']"></i>
            </span>
            <span class="file-icon" aria-hidden="true">{{ getFileIcon(item) }}</span>
            <span class="file-name">{{ item.name }}</span>
            <span v-if="item.children" class="folder-count">({{ item.children.length }})</span>
        </div>
        
        <!-- æ–‡ä»¶ -->
        <div 
            v-else
            :class="['file-tree-item', 'file-item', { 
                selected: isFileSelected(item.id)
            }]"
            @click="selectFile(item.id)"
            :title="`æ–‡ä»¶: ${item.name}`"
            tabindex="0"
            @keydown.enter="selectFile(item.id)"
            @keydown.space="selectFile(item.id)"
        >
            <span class="folder-toggle file-toggle-placeholder" aria-hidden="true"></span>
            <span class="file-icon" aria-hidden="true">{{ getFileIcon(item) }}</span>
            <span class="file-name">{{ item.name }}</span>
            <span v-if="getFileSizeDisplay(item)" class="file-size">{{ getFileSizeDisplay(item) }}</span>
            <span v-if="getCommentCount(item.id) > 0" class="comment-count" :title="`${getCommentCount(item.id)} æ¡è¯„è®º`">
                ğŸ’¬ {{ getCommentCount(item.id) }}
            </span>
        </div>
        
        <!-- é€’å½’æ¸²æŸ“å­èŠ‚ç‚¹ -->
        <ul 
            v-if="item.type === 'folder' && item.children && isFolderExpanded(item.id)"
            class="file-tree-children"
            role="group"
        >
            <template v-for="child in item.children" :key="child.id">
                <file-tree-node 
                    :item="child"
                    :selected-file-id="selectedFileId"
                    :expanded-folders="expandedFolders"
                    :comments="comments"
                    @file-select="$emit('file-select', $event)"
                    @folder-toggle="$emit('folder-toggle', $event)"
                ></file-tree-node>
            </template>
        </ul>
    </li>
</script>



