<!-- 文件树组件模板 -->
<aside class="file-tree-container" role="navigation" aria-label="文件目录树">
    <!-- 加载状态 -->
    <div v-if="loading" class="loading-container" role="status" aria-live="polite">
        <div class="loading-spinner" aria-hidden="true"></div>
        <div class="loading-text">正在加载文件树...</div>
    </div>

    <!-- 错误状态 -->
    <div v-else-if="error" class="error-container" role="alert">
        <div class="error-icon" aria-hidden="true">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="error-message">{{ error }}</div>
        <button @click="$emit('reload')" class="retry-button">
            <i class="fas fa-redo"></i>
            重新加载
        </button>
    </div>

    <!-- 文件树内容 -->
    <div v-else-if="tree.length > 0" class="file-tree-content">
        <ul class="file-tree" role="tree">
            <template v-for="item in tree" :key="item.id">
                <!-- 递归组件：文件树节点 -->
                <file-tree-node 
                    :item="item" 
                    :selected-file-id="selectedFileId"
                    :expanded-folders="expandedFolders"
                    :comments="comments"
                    @file-select="$emit('file-select', $event)"
                    @folder-toggle="$emit('folder-toggle', $event)"
                ></file-tree-node>
            </template>
        </ul>
    </div>

    <!-- 空状态 -->
    <div v-else class="empty-state" role="status">
        <div class="empty-icon" aria-hidden="true">
            <i class="fas fa-folder-open"></i>
        </div>
        <div class="empty-title">暂无文件</div>
        <div class="empty-subtitle">请检查文件目录或联系管理员</div>
    </div>
</aside>

<!-- 递归组件：文件树节点 -->
<script type="text/x-template" id="file-tree-node-template">
    <li 
        class="file-tree-node"
        role="treeitem"
        :aria-expanded="item.type === 'folder' ? isFolderExpanded(item.id) : undefined"
    >
        <!-- 文件夹 -->
        <div 
            v-if="item.type === 'folder'"
            :class="['file-tree-item', 'folder-item', { 
                expanded: isFolderExpanded(item.id)
            }]"
            @click="toggleFolder(item.id)"
            :title="`文件夹: ${item.name}`"
            tabindex="0"
            @keydown.enter="toggleFolder(item.id)"
            @keydown.space="toggleFolder(item.id)"
        >
            <span class="folder-toggle" aria-hidden="true">
                <i :class="['fas', isFolderExpanded(item.id) ? 'fa-chevron-down' : 'fa-chevron-right']"></i>
            </span>
            <span class="file-icon" aria-hidden="true">{{ getFileIcon(item) }}</span>
            <span class="file-name">{{ item.name }}</span>
            <span v-if="item.children" class="folder-count">({{ item.children.length }})</span>
        </div>
        
        <!-- 文件 -->
        <div 
            v-else
            :class="['file-tree-item', 'file-item', { 
                selected: isFileSelected(item.id)
            }]"
            @click="selectFile(item.id)"
            :title="`文件: ${item.name}`"
            tabindex="0"
            @keydown.enter="selectFile(item.id)"
            @keydown.space="selectFile(item.id)"
        >
            <span class="folder-toggle file-toggle-placeholder" aria-hidden="true"></span>
            <span class="file-icon" aria-hidden="true">{{ getFileIcon(item) }}</span>
            <span class="file-name">{{ item.name }}</span>
            <span v-if="getFileSizeDisplay(item)" class="file-size">{{ getFileSizeDisplay(item) }}</span>
            <span v-if="getCommentCount(item.id) > 0" class="comment-count" :title="`${getCommentCount(item.id)} 条评论`">
                💬 {{ getCommentCount(item.id) }}
            </span>
        </div>
        
        <!-- 递归渲染子节点 -->
        <ul 
            v-if="item.type === 'folder' && item.children && isFolderExpanded(item.id)"
            class="file-tree-children"
            role="group"
        >
            <template v-for="child in item.children" :key="child.id">
                <file-tree-node 
                    :item="child"
                    :selected-file-id="selectedFileId"
                    :expanded-folders="expandedFolders"
                    :comments="comments"
                    @file-select="$emit('file-select', $event)"
                    @folder-toggle="$emit('folder-toggle', $event)"
                ></file-tree-node>
            </template>
        </ul>
    </li>
</script>



