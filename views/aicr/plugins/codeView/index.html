<section class="code-view-container" role="main" aria-label="‰ª£Á†ÅÊü•ÁúãÂô®">
    <div v-if="loading" class="loading-container" role="status" aria-live="polite">
        <div class="loading-spinner" aria-hidden="true"></div>
        <div class="loading-text">Ê≠£Âú®Âä†ËΩΩ‰ª£Á†Å...</div>
    </div>
    <div v-else-if="error" class="error-container" role="alert">
        <div class="error-icon" aria-hidden="true">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="error-message">{{ error }}</div>
    </div>
    <div v-else-if="file" class="code-content" :class="{ editing: isEditingFile }">
        <div class="code-header">
            <div class="file-name" :title="file.path || file.name">
                <i class="fas fa-file-code"></i>
                {{ file.path || file.name }}
            </div>
            <div class="code-actions">
                <!-- MarkdownÈ¢ÑËßàÂàáÊç¢ÊåâÈíÆ -->
                <button v-if="!isEditingFile && languageType === 'markdown'" class="action-button preview-toggle-button" @click="toggleMarkdownPreview" :disabled="!file">
                    <i class="fas" :class="isMarkdownPreviewMode ? 'fa-code' : 'fa-eye'"></i>
                    <span>{{ isMarkdownPreviewMode ? 'Ê∫êÁ†Å' : 'È¢ÑËßà' }}</span>
                </button>
                <button v-if="!isEditingFile" class="action-button" @click="copyEntireFile" :disabled="!file">
                    <i class="fas fa-copy"></i><span>Â§çÂà∂</span>
                </button>
                <button v-if="!isEditingFile" class="action-button edit-button" @click="startEditFile" :disabled="!file">
                    <i class="fas fa-pen"></i><span>ÁºñËæë</span>
                </button>
                <template v-else>
                    <button class="action-button save-button" :disabled="editSaving" @click="saveEditedFile">
                        <i class="fas" :class="editSaving ? 'fa-spinner fa-spin' : 'fa-save'"></i><span>{{ editSaving ? '‰øùÂ≠ò‰∏≠' : '‰øùÂ≠ò' }}</span>
                    </button>
                    <button class="action-button cancel-button" :disabled="editSaving" @click="cancelEditFile">
                        <i class="fas fa-times"></i><span>ÂèñÊ∂à</span>
                    </button>
                </template>
            </div>
        </div>
        <div v-if="isEditingFile" class="edit-container">
            <textarea 
                class="edit-textarea" 
                v-model="editingFileContent" 
                @keydown="onEditKeydown" 
                spellcheck="false"
                placeholder="ÁºñËæëÊñá‰ª∂ÂÜÖÂÆπ..."
                aria-label="ÁºñËæëÊñá‰ª∂ÂÜÖÂÆπ"
            ></textarea>
            <div class="save-error" v-if="saveError">
                <i class="fas fa-exclamation-circle"></i> {{ saveError }}
            </div>
        </div>
        <!-- MarkdownÈ¢ÑËßàÊ®°Âºè -->
        <div v-else-if="shouldShowMarkdownPreview" class="markdown-preview-container">
            <div class="markdown-preview-wrapper">
                <div class="markdown-preview-content md-preview-body">
                    <!-- MDÈ¢ÑËßàÂÜÖÂÆπÔºåÊØèË°åÈÉΩÂåÖÂê´ËØÑËÆ∫Ê†áËÆ∞ -->
                    <div 
                        v-for="(line, index) in markdownPreviewLines" 
                        :key="'md-content-line-' + (index + 1)"
                        class="markdown-preview-line"
                        :data-line="index + 1"
                    >
                        <div class="markdown-line-content" v-html="renderMarkdownLine(line.content)"></div>
                        
                        <!-- ËØÑËÆ∫Ê†áËÆ∞ - ‰∏é‰ª£Á†ÅÊ®°Âºè‰øùÊåÅ‰∏ÄËá¥ -->
                        <div v-if="lineCommentMarkers[index + 1]" class="comment-markers">
                            <div 
                                class="comment-marker"
                                :class="[
                                    getCommentStatusClass(lineCommentMarkers[index + 1].status), 
                                    { 
                                        'has-multiple': lineCommentMarkers[index + 1].hasMultiple,
                                        'multi-line': lineCommentMarkers[index + 1].isMultiLine,
                                        'start-line': lineCommentMarkers[index + 1].markerType === 'start',
                                        'middle-line': lineCommentMarkers[index + 1].markerType === 'middle',
                                        'end-line': lineCommentMarkers[index + 1].markerType === 'end'
                                    }
                                ]"
                                :data-comment-key="lineCommentMarkers[index + 1].key"
                                @click="handleCommentMarkerClick(lineCommentMarkers[index + 1], $event)"
                                @mouseenter="handleCommentMarkerMouseEvents(lineCommentMarkers[index + 1], $event)"
                                @mouseleave="handleCommentMarkerMouseEvents(lineCommentMarkers[index + 1], $event)"
                                :title="getCommentMarkerTitle(lineCommentMarkers[index + 1])"
                                role="button"
                                tabindex="0"
                            >
                                <i :class="getCommentMarkerIcon(lineCommentMarkers[index + 1])"></i>
                                <span class="comment-count" v-if="lineCommentMarkers[index + 1].count > 1 && lineCommentMarkers[index + 1].markerType !== 'middle'">
                                    {{ lineCommentMarkers[index + 1].count }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ‰ª£Á†ÅÊòæÁ§∫Ê®°Âºè -->
        <pre v-else class="code-block" :class="'language-' + languageType">
            <code 
                v-for="(line, index) in codeLines" 
                :key="index + 1"
                :class="['code-line', highlightedLines.includes(index + 1) ? 'highlight' : '']"
                :data-line="index + 1"
            >
                <span class="line-number">{{ index + 1 }}</span>
                <span class="line-content" v-html="escapeHtml(line)"></span>
                
                <!-- ËØÑËÆ∫Ê†áËÆ∞ -->
                <div v-if="lineCommentMarkers[index + 1]" class="comment-markers">
                    <div 
                        class="comment-marker"
                        :class="[
                            getCommentStatusClass(lineCommentMarkers[index + 1].status), 
                            { 
                                'has-multiple': lineCommentMarkers[index + 1].hasMultiple,
                                'multi-line': lineCommentMarkers[index + 1].isMultiLine,
                                'start-line': lineCommentMarkers[index + 1].markerType === 'start',
                                'middle-line': lineCommentMarkers[index + 1].markerType === 'middle',
                                'end-line': lineCommentMarkers[index + 1].markerType === 'end'
                            }
                        ]"
                        :data-comment-key="lineCommentMarkers[index + 1].key"
                        @click="handleCommentMarkerClick(lineCommentMarkers[index + 1], $event)"
                        @mouseenter="handleCommentMarkerMouseEvents(lineCommentMarkers[index + 1], $event)"
                        @mouseleave="handleCommentMarkerMouseEvents(lineCommentMarkers[index + 1], $event)"
                        :title="getCommentMarkerTitle(lineCommentMarkers[index + 1])"
                        role="button"
                        tabindex="0"
                    >
                        <i :class="getCommentMarkerIcon(lineCommentMarkers[index + 1])"></i>
                        <span class="comment-count" v-if="lineCommentMarkers[index + 1].count > 1 && lineCommentMarkers[index + 1].markerType !== 'middle'">
                            {{ lineCommentMarkers[index + 1].count }}
                        </span>
                    </div>
                </div>
            </code>
        </pre>
        <!-- ÂàíËØçËØÑËÆ∫ÊåâÈíÆÂÆπÂô®ÔºàÂÖ®Â±ÄÂîØ‰∏ÄÔºåÈÄöËøáËÑöÊú¨ÂÆö‰ΩçÔºâ -->
        <div id="comment-action-container"></div>


        <!-- Êú™ÈÄâËØÑËÆ∫ËÄÖÊó∂ÁöÑÊâãÂä®ËØÑËÆ∫ÂºπÊ°Ü -->
        <div 
            v-if="showManualImprovementModal" 
            class="manual-improvement-modal" 
            role="dialog" 
            aria-label="ÊâãÂä®Â°´ÂÜôËØÑËÆ∫ÂÜÖÂÆπ"
        >
            <div class="manual-improvement-content">
                <div class="manual-improvement-header">
                    <h3 class="manual-improvement-title">Â°´ÂÜôËØÑËÆ∫ÂÜÖÂÆπ</h3>
                    <button class="close-btn" @click="closeManualImprovementModal" title="ÂÖ≥Èó≠" aria-label="ÂÖ≥Èó≠">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="manual-improvement-body">
                    <div class="md-input-preview" :class="{ 'preview-collapsed': manualPreviewCollapsed }">
                        <div class="md-input">
                            <div class="md-toolbar" role="toolbar" aria-label="MarkdownÂ∑•ÂÖ∑Ê†è">
                                <button class="md-btn" title="Á≤ó‰Ωì" @click="insertMarkdown('bold')"><i class="fas fa-bold"></i></button>
                                <button class="md-btn" title="Êñú‰Ωì" @click="insertMarkdown('italic')"><i class="fas fa-italic"></i></button>
                                <button class="md-btn" title="Ë°åÂÜÖ‰ª£Á†Å" @click="insertMarkdown('code')"><i class="fas fa-code"></i></button>
                                <button class="md-btn" title="‰ª£Á†ÅÂùó" @click="insertMarkdown('codeblock')"><i class="fas fa-file-code"></i></button>
                                <button class="md-btn" title="Êó†Â∫èÂàóË°®" @click="insertMarkdown('ul')"><i class="fas fa-list-ul"></i></button>
                                <button class="md-btn" title="ÊúâÂ∫èÂàóË°®" @click="insertMarkdown('ol')"><i class="fas fa-list-ol"></i></button>
                                <button class="md-btn" title="ÈìæÊé•" @click="insertMarkdown('link')"><i class="fas fa-link"></i></button>
                                <button class="md-btn" :title="manualPreviewCollapsed ? 'Â±ïÂºÄÈ¢ÑËßà' : 'ÊäòÂè†È¢ÑËßà'" @click="toggleManualPreviewCollapse" aria-label="ÂàáÊç¢È¢ÑËßàÊòæÁ§∫"><i class="fas" :class="manualPreviewCollapsed ? 'fa-eye' : 'fa-eye-slash'"></i></button>
                                <span class="md-toolbar-spacer"></span>
                                <span class="md-counter" :title="'ÊúÄÂ§ö ' + manualMaxLength + ' Â≠ó'">{{ (manualCommentText || '').length }} / {{ manualMaxLength }}</span>
                            </div>
                            <textarea 
                                class="manual-improvement-input"
                                v-model="manualCommentText" 
                                placeholder="ËØ∑ËæìÂÖ•Ë¶ÅÂèëÂ∏ÉÁöÑËØÑËÆ∫ÂÜÖÂÆπÔºåÊîØÊåÅMarkdownËØ≠Ê≥ï"
                                rows="10"
                                @keydown="handleManualKeydown"
                            ></textarea>
                            <div v-if="manualCommentError" class="manual-improvement-error">
                                <i class="fas fa-exclamation-circle"></i> {{ manualCommentError }}
                            </div>
                        </div>
                        <div class="md-preview" v-show="!manualPreviewCollapsed">
                            <div class="preview-header-row">
                                <span class="preview-title"><i class="fas fa-eye"></i> È¢ÑËßà</span>
                            </div>
                            <div class="md-preview-body" v-html="manualCommentPreviewHtml"></div>
                        </div>
                    </div>
                </div>
                <div class="manual-improvement-actions">
                    <button class="action-button cancel" @click="closeManualImprovementModal">
                        <i class="fas fa-times"></i> ÂèñÊ∂à
                    </button>
                    <button class="action-button confirm" :disabled="!canSubmitManualComment" @click="submitManualImprovement">
                        <i class="fas fa-paper-plane"></i> Êèê‰∫§
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ËØÑËÆ∫ËØ¶ÊÉÖÈÅÆÁΩ© -->
        <div 
            v-if="showCommentDetailPopup"
            class="comment-detail-overlay"
            role="presentation"
            aria-hidden="true"
            @click="hideCommentDetail"
        ></div>

        <!-- ËØÑËÆ∫ËØ¶ÊÉÖÂºπÁ™ó -->
        <div 
            v-if="showCommentDetailPopup && currentCommentDetail" 
            class="comment-detail-popup modern-dialog"
            role="dialog"
            aria-label="ËØÑËÆ∫ËØ¶ÊÉÖ"
        >
            <!-- ‰ºòÂåñÁöÑÂ§¥ÈÉ®Âå∫Âüü -->
            <div class="comment-detail-header modern-header">
                <div class="header-main">
                    <div class="comment-author-info enhanced">
                        <div class="comment-author-avatar premium">
                            <i class="fas fa-user-tie"></i>
                            <div class="avatar-ring"></div>
                        </div>
                        <div class="comment-author-details enhanced">
                            <div class="author-name-row">
                                <span class="comment-author premium">{{ currentCommentDetail.author }}</span>
                                <!-- ËØÑËÆ∫Á±ªÂûãÂõæÊ†á -->
                                <div v-if="currentCommentDetail.type" class="comment-type-icon" :title="getCommentTypeLabel(currentCommentDetail.type)">
                                    <i class="fas" :class="getCommentTypeIcon(currentCommentDetail.type)"></i>
                                </div>
                            </div>
                            <div class="meta-info-row">
                                <time class="comment-time enhanced" :datetime="currentCommentDetail.timestamp">
                                    <i class="fas fa-clock"></i>
                                    {{ formatTime(currentCommentDetail.timestamp) }}
                                </time>
                                <!-- ‰ª£Á†Å‰ΩçÁΩÆ‰ø°ÊÅØ -->
                                <div v-if="currentCommentDetail.rangeInfo" class="location-info compact">
                                    <i class="fas fa-code"></i>
                                    Á¨¨ {{ currentCommentDetail.rangeInfo.startLine }}{{ currentCommentDetail.rangeInfo.endLine !== currentCommentDetail.rangeInfo.startLine ? "-" + currentCommentDetail.rangeInfo.endLine : "" }} Ë°å
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ÂÖ≥Èó≠ÊåâÈíÆ -->
                <button 
                    @click="hideCommentDetail"
                    class="close-button modern"
                    title="ÂÖ≥Èó≠ÂºπÁ™ó"
                    aria-label="ÂÖ≥Èó≠ËØÑËÆ∫ËØ¶ÊÉÖ"
                >
                    <i class="fas fa-times"></i>
                    <div class="close-button-bg"></div>
                </button>
            </div>
            
            <div class="comment-detail-body">
                <!-- ÁºñËæëÊ®°Âºè -->
                <div v-if="isEditingCommentDetail" class="comment-edit-form">
                    <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫ -->
                    <div class="edit-form-main">
                        <div class="form-group priority-field">
                            <label class="form-label primary">
                                <i class="fas fa-comment-dots"></i>
                                ËØÑËÆ∫ÂÜÖÂÆπ
                            </label>
                            <textarea 
                                v-model="editingCommentContent"
                                class="form-textarea comment-content-textarea primary-textarea"
                                placeholder="ÁºñËæëËØÑËÆ∫ÂÜÖÂÆπÔºàÊîØÊåÅMarkdownÊ†ºÂºèÔºâ"
                                rows="12"
                                @keydown="onCommentDetailEditKeydown"
                            ></textarea>
                            <div class="textarea-hint">
                                <i class="fas fa-info-circle"></i>
                                ÊîØÊåÅMarkdownÊ†ºÂºèÔºåCtrl/Cmd + Enter ‰øùÂ≠òÔºåEsc ÂèñÊ∂à
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-code"></i>
                                ÂºïÁî®‰ª£Á†Å
                            </label>
                            <textarea 
                                v-model="editingCommentText"
                                class="form-textarea quoted-code-textarea"
                                placeholder="ËæìÂÖ•ÂºïÁî®ÁöÑ‰ª£Á†ÅÔºàÂèØÈÄâÔºâ"
                                rows="12"
                                wrap="off"
                                spellcheck="false"
                                @keydown="handleQuotedCodeKeydown"
                            ></textarea>
                        </div>

                        <div class="form-group" v-if="editingImprovementText || showAdvancedOptions">
                            <label class="form-label">
                                <i class="fas fa-magic"></i>
                                ÊîπËøõÂª∫ËÆÆ
                            </label>
                            <textarea 
                                v-model="editingImprovementText"
                                class="form-textarea improvement-textarea"
                                placeholder="ËæìÂÖ•ÊîπËøõÂêéÁöÑ‰ª£Á†ÅÔºàÂèØÈÄâÔºâ"
                                rows="12"
                            ></textarea>
                        </div>
                    </div>

                    <!-- ÂÖÉ‰ø°ÊÅØÂå∫ -->
                    <div class="edit-form-meta">
                        <div class="form-section">
                            <div class="section-title">
                                <i class="fas fa-tags"></i>
                                ËØÑËÆ∫ÂàÜÁ±ª
                            </div>
                            <div class="form-row">
                                <div class="form-group half-width">
                                    <label class="form-label compact">Á±ªÂûã</label>
                                    <select v-model="editingCommentType" class="form-select" title="ÈÄâÊã©ËØÑËÆ∫Á±ªÂûã">
                                        <option value="">Êó†Á±ªÂûã</option>
                                        <option value="suggestion">üí° Âª∫ËÆÆ</option>
                                        <option value="question">‚ùì ÈóÆÈ¢ò</option>
                                        <option value="bug">üêõ ÈîôËØØ</option>
                                        <option value="discussion">üí¨ ËÆ®ËÆ∫</option>
                                        <option value="praise">üëç Ë°®Êâ¨</option>
                                        <option value="nitpick">üîç ÁªÜËäÇ</option>
                                    </select>
                                </div>
                                <div class="form-group half-width">
                                    <label class="form-label compact">Áä∂ÊÄÅ</label>
                                    <select v-model="editingCommentStatus" class="form-select" title="ÈÄâÊã©Áä∂ÊÄÅ">
                                        <option value="pending">‚è≥ ÂæÖÂ§ÑÁêÜ</option>
                                        <option value="resolved">‚úÖ Â∑≤Ëß£ÂÜ≥</option>
                                        <option value="closed">üîí Â∑≤ÂÖ≥Èó≠</option>
                                        <option value="wontfix">‚ùå ‰∏ç‰øÆÂ§ç</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="section-title">
                                <i class="fas fa-info-circle"></i>
                                ËØ¶ÁªÜ‰ø°ÊÅØ
                            </div>
                            <div class="form-row">
                                <div class="form-group half-width">
                                    <label class="form-label compact">ËØÑËÆ∫ËÄÖ</label>
                                    <input 
                                        v-model="editingCommentAuthor"
                                        type="text" 
                                        class="form-input"
                                        placeholder="ËæìÂÖ•ËØÑËÆ∫ËÄÖÂßìÂêç"
                                    />
                                </div>
                                <div class="form-group half-width">
                                    <label class="form-label compact">Êó∂Èó¥</label>
                                    <input 
                                        v-model="editingCommentTimestamp"
                                        type="datetime-local" 
                                        class="form-input"
                                        title="ÁºñËæëÊó∂Èó¥"
                                    />
                                </div>
                            </div>

                            <div v-if="currentCommentDetail && currentCommentDetail.rangeInfo" class="form-row">
                                <div class="form-group half-width">
                                    <label class="form-label compact">ÂºÄÂßãË°å</label>
                                    <input 
                                        v-model.number="editingRangeInfo.startLine"
                                        type="number" 
                                        min="1"
                                        class="form-input"
                                        placeholder="ÂºÄÂßãË°åÂè∑"
                                    />
                                </div>
                                <div class="form-group half-width">
                                    <label class="form-label compact">ÁªìÊùüË°å</label>
                                    <input 
                                        v-model.number="editingRangeInfo.endLine"
                                        type="number" 
                                        min="1"
                                        class="form-input"
                                        placeholder="ÁªìÊùüË°åÂè∑"
                                    />
                                </div>
                            </div>
                        </div>

                        <!-- È´òÁ∫ßÈÄâÈ°πÂàáÊç¢ -->
                        <div class="form-section" v-if="!showAdvancedOptions && !editingImprovementText">
                            <button 
                                type="button"
                                @click="showAdvancedOptions = true"
                                class="toggle-advanced-btn"
                            >
                                <i class="fas fa-chevron-down"></i>
                                ÊòæÁ§∫È´òÁ∫ßÈÄâÈ°π
                            </button>
                        </div>
                    </div>

                    <!-- Êìç‰ΩúÊåâÈíÆÂå∫ -->
                    <div class="comment-detail-actions enhanced edit-mode">
                        <!-- ‰∏ªË¶ÅÊìç‰ΩúÁªÑ -->
                        <div class="action-group primary">
                            <button 
                                @click="saveEditedCommentDetail"
                                class="action-button save-button success large"
                                :disabled="editingSaving"
                                title="‰øùÂ≠òÊâÄÊúâ‰øÆÊîπ (‚åò/Ctrl+Enter)"
                            >
                                <i class="fas" :class="editingSaving ? 'fa-spinner fa-spin' : 'fa-save'"></i>
                                <span>{{ editingSaving ? '‰øùÂ≠ò‰∏≠...' : '‰øùÂ≠ò‰øÆÊîπ' }}</span>
                            </button>
                        </div>
                        
                        <!-- Ê¨°Ë¶ÅÊìç‰ΩúÁªÑ -->
                        <div class="action-group secondary">
                            <button 
                                @click="cancelEditCommentDetail" 
                                class="action-button cancel-button neutral" 
                                :disabled="editingSaving" 
                                title="ÊîæÂºÉ‰øÆÊîπÂπ∂ËøîÂõû (Esc)"
                            >
                                <i class="fas fa-arrow-left"></i>
                                <span>ÊîæÂºÉ‰øÆÊîπ</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Êü•ÁúãÊ®°Âºè -->
                <div v-else class="comment-view-content modern-content">
                    <!-- ‰∏ªË¶ÅËØÑËÆ∫ÂÜÖÂÆπ -->
                    <div class="primary-content">
                        <div class="comment-content enhanced-content md-preview-body" v-html="currentCommentDetailHtml"></div>
                    </div>
                    
                    <!-- ‰ª£Á†ÅÁõ∏ÂÖ≥ÂÜÖÂÆπ -->
                    <div v-if="currentCommentDetail.text || currentCommentDetail.improvementText" class="code-content-section">
                        <!-- ÂºïÁî®ÁöÑ‰ª£Á†Å -->
                        <div v-if="currentCommentDetail.text" class="comment-quote modern-quote">
                            <div class="quote-header modern">
                                <div class="header-icon">
                                    <i class="fas fa-quote-left"></i>
                                </div>
                                <span class="header-text">ÂºïÁî®‰ª£Á†Å</span>
                                <button class="highlight-code-btn" @click="highlightCode(currentCommentDetail)" title="Âú®‰ª£Á†Å‰∏≠È´ò‰∫ÆÊòæÁ§∫">
                                    <i class="fas fa-external-link-alt"></i>
                                </button>
                            </div>
                            <div class="quote-code-container">
                                <pre class="quote-code modern" @click="highlightCode(currentCommentDetail)">
                                    <code>{{ currentCommentDetailTextDisplay }}</code>
                                </pre>
                                <div class="code-overlay">
                                    <span class="click-hint">ÁÇπÂáªÊü•Áúã‰ª£Á†Å‰ΩçÁΩÆ</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ÊîπËøõ‰ª£Á†Å -->
                        <div v-if="currentCommentDetail.improvementText" class="comment-improvement modern-improvement">
                            <div class="improvement-header modern">
                                <div class="header-icon">
                                    <i class="fas fa-magic"></i>
                                </div>
                                <span class="header-text">ÊîπËøõÂª∫ËÆÆ</span>
                                <div class="improvement-badge">
                                    <i class="fas fa-star"></i>
                                    ‰ºòÂåñ
                                </div>
                            </div>
                            <div class="improvement-code-container">
                                <pre class="improvement-code modern">
                                    <code>{{ currentCommentDetail.improvementText }}</code>
                                </pre>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ËØÑËÆ∫Êìç‰ΩúÊåâÈíÆ -->
                    <div class="comment-detail-actions enhanced view-mode">
                        <!-- Áä∂ÊÄÅÊåáÁ§∫Âô® -->
                        <div class="comment-status-indicator">
                            <span class="status-badge" :class="'status-' + currentCommentDetail.status">
                                <i class="fas" :class="{
                                    'fa-clock': currentCommentDetail.status === 'pending',
                                    'fa-check-circle': currentCommentDetail.status === 'resolved',
                                    'fa-lock': currentCommentDetail.status === 'closed',
                                    'fa-times-circle': currentCommentDetail.status === 'wontfix'
                                }"></i>
                                {{ {
                                    'pending': 'ÂæÖÂ§ÑÁêÜ',
                                    'resolved': 'Â∑≤Ëß£ÂÜ≥',
                                    'closed': 'Â∑≤ÂÖ≥Èó≠',
                                    'wontfix': '‰∏ç‰øÆÂ§ç'
                                }[currentCommentDetail.status] || 'Êú™Áü•Áä∂ÊÄÅ' }}
                            </span>
                        </div>
                        
                        <!-- ‰∏ªË¶ÅÊìç‰ΩúÁªÑ -->
                        <div class="action-group primary">
                            <button 
                                v-if="currentCommentDetail.status === 'pending'"
                                @click="resolveCommentDetail(currentCommentDetail.key)"
                                class="action-button resolve-button success"
                                title="Ê†áËÆ∞‰∏∫Â∑≤Ëß£ÂÜ≥"
                            >
                                <i class="fas fa-check-circle"></i>
                                <span>Ê†áËÆ∞Ëß£ÂÜ≥</span>
                            </button>

                            <button 
                                @click="startEditCommentDetail(currentCommentDetail)"
                                class="action-button edit-button primary"
                                title="ÁºñËæëËØÑËÆ∫ÂÜÖÂÆπ"
                            >
                                <i class="fas fa-edit"></i>
                                <span>ÁºñËæëËØÑËÆ∫</span>
                            </button>
                            
                            <button 
                                v-if="currentCommentDetail.status === 'resolved'"
                                @click="reopenCommentDetail(currentCommentDetail.key)"
                                class="action-button reopen-button warning"
                                title="ÈáçÊñ∞ÊâìÂºÄËØÑËÆ∫"
                            >
                                <i class="fas fa-redo"></i>
                                <span>ÈáçÊñ∞ÊâìÂºÄ</span>
                            </button>
                        </div>
                        
                        <!-- Ê¨°Ë¶ÅÊìç‰ΩúÁªÑ -->
                        <div class="action-group secondary">
                            <button 
                                @click="deleteCommentDetail(currentCommentDetail.key)"
                                class="action-button delete-button danger"
                                title="Ê∞∏‰πÖÂà†Èô§Ê≠§ËØÑËÆ∫"
                            >
                                <i class="fas fa-trash-alt"></i>
                                <span>Âà†Èô§</span>
                            </button>
                            
                            <button 
                                @click="hideCommentDetail"
                                class="action-button close-button neutral"
                                title="ÂÖ≥Èó≠ÂºπÁ™ó"
                            >
                                <i class="fas fa-times"></i>
                                <span>ÂÖ≥Èó≠</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ËØÑËÆ∫È¢ÑËßàÂºπÁ™óÔºàÊÇ¨ÂÅúÊòæÁ§∫Ôºâ -->
        <div 
            v-if="showCommentPreviewPopup && currentCommentPreview" 
            class="comment-preview-popup"
            :style="{
                left: commentPreviewPosition.x + 'px',
                top: commentPreviewPosition.y + 'px'
            }"
            role="tooltip"
            aria-label="ËØÑËÆ∫È¢ÑËßà"
        >
            <div class="preview-header">
                <div class="preview-author-info">
                    <div class="preview-author-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="preview-author-details">
                        <div class="preview-author-name-row">
                            <span class="preview-author">{{ currentCommentPreview.author }}</span>
                            <!-- ËØÑËÆ∫Áä∂ÊÄÅ - ÁßªÂà∞‰ΩúËÄÖÂêçÊóÅËæπ -->
                            <span v-if="currentCommentPreview.status" class="preview-status-badge-inline" :class="getCommentStatusClass(currentCommentPreview.status)">
                                {{ getCommentStatusLabel(currentCommentPreview.status) }}
                            </span>
                        </div>
                        <time class="preview-time" :datetime="currentCommentPreview.timestamp">
                            {{ formatTime(currentCommentPreview.timestamp) }}
                        </time>
                    </div>
                </div>
            </div>
            
            <div class="preview-body">
                <!-- ËØÑËÆ∫ÂÜÖÂÆπÈ¢ÑËßàÔºàMarkdownÊ∏≤ÊüìÔºåÂê´ÂõæÁâáÔºâ -->
                <div class="preview-content md-preview-body" v-html="currentCommentPreviewHtml"></div>
                
                <!-- ÊîπËøõ‰ª£Á†ÅÈ¢ÑËßàÔºàÂ¶ÇÊûúÊúâÔºâ -->
                <div v-if="currentCommentPreview.improvementText" class="preview-improvement">
                    <div class="preview-improvement-header">
                        <i class="fas fa-magic"></i>
                        <span>ÊîπËøõÂª∫ËÆÆ</span>
                    </div>
                    <pre class="preview-improvement-code">
                        <code>{{ currentCommentPreview.improvementText }}</code>
                    </pre>
                </div>
            </div>
            
            <!-- ÁÇπÂáªÊü•ÁúãËØ¶ÊÉÖÊèêÁ§∫ -->
            <div class="preview-footer">
                <span class="preview-hint">ÁÇπÂáªÊü•ÁúãÂÆåÊï¥ËØ¶ÊÉÖ</span>
            </div>
        </div>
    </div>
    <div v-else class="empty-state" role="status">
        <div class="empty-icon" aria-hidden="true">
            <i class="fas fa-file-code"></i>
        </div>
        <div class="empty-title">ËØ∑ÈÄâÊã©Êñá‰ª∂</div>
        <div class="empty-subtitle">‰ªéÂ∑¶‰æßÊñá‰ª∂Ê†ë‰∏≠ÈÄâÊã©Ë¶ÅÊü•ÁúãÁöÑÊñá‰ª∂</div>
    </div>
</section>


