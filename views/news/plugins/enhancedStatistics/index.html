<div v-if="visible" class="enhanced-statistics-overlay" @click.self="closeStatistics">
    <div class="enhanced-statistics-panel">
        <div class="statistics-header">
            <h3>新闻数据分析</h3>
            <div class="header-actions">
                <button @click="exportStats" class="export-btn" title="导出数据">
                    <i class="fas fa-download"></i>
                </button>
                <button @click="closeStatistics" class="close-btn" title="关闭">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <div class="statistics-content">
            <!-- 概览统计 -->
            <div class="stats-section">
                <h4>概览统计</h4>
                <div class="overview-grid">
                    <div class="stat-card">
                        <div class="stat-value">{{ formatNumber(comprehensiveStats.overview.totalNews) }}</div>
                        <div class="stat-label">总新闻数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ comprehensiveStats.overview.totalCategories }}</div>
                        <div class="stat-label">分类数量</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ (comprehensiveStats.overview.averageConfidence * 100).toFixed(1) }}%</div>
                        <div class="stat-label">平均置信度</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ comprehensiveStats.overview.contentQuality }}%</div>
                        <div class="stat-label">内容质量</div>
                    </div>
                </div>
            </div>

            <!-- 分类分布 -->
            <div class="stats-section">
                <h4>分类分布</h4>
                <div class="category-list">
                    <div v-for="category in categoryDistribution.slice(0, 10)" :key="category.key" class="category-item">
                        <div class="category-info">
                            <i :class="category.icon" :style="{ color: category.color }"></i>
                            <span class="category-title">{{ category.title }}</span>
                        </div>
                        <div class="category-stats">
                            <span class="category-count">{{ category.count }}</span>
                            <span class="category-percentage">{{ category.percentage }}%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 质量分析 -->
            <div class="stats-section">
                <h4>分类质量分析</h4>
                <div class="quality-breakdown">
                    <div class="quality-item">
                        <div class="quality-label">高质量</div>
                        <div class="quality-bar">
                            <div class="quality-fill" :style="{ 
                                width: formatPercentage(comprehensiveStats.qualityBreakdown.high, Object.keys(categoryQuality).length),
                                backgroundColor: '#4caf50'
                            }"></div>
                        </div>
                        <div class="quality-count">{{ comprehensiveStats.qualityBreakdown.high }}</div>
                    </div>
                    <div class="quality-item">
                        <div class="quality-label">中等质量</div>
                        <div class="quality-bar">
                            <div class="quality-fill" :style="{ 
                                width: formatPercentage(comprehensiveStats.qualityBreakdown.medium, Object.keys(categoryQuality).length),
                                backgroundColor: '#ff9800'
                            }"></div>
                        </div>
                        <div class="quality-count">{{ comprehensiveStats.qualityBreakdown.medium }}</div>
                    </div>
                    <div class="quality-item">
                        <div class="quality-label">低质量</div>
                        <div class="quality-bar">
                            <div class="quality-fill" :style="{ 
                                width: formatPercentage(comprehensiveStats.qualityBreakdown.low, Object.keys(categoryQuality).length),
                                backgroundColor: '#f44336'
                            }"></div>
                        </div>
                        <div class="quality-count">{{ comprehensiveStats.qualityBreakdown.low }}</div>
                    </div>
                </div>
            </div>

            <!-- 时间分析 -->
            <div class="stats-section">
                <h4>时间分布分析</h4>
                <div class="time-insights">
                    <div class="time-group">
                        <h5>高峰时段</h5>
                        <div class="peak-hours">
                            <div v-for="peak in comprehensiveStats.timeInsights.peakHours" :key="peak.hour" class="peak-item">
                                <span class="peak-time">{{ peak.hour }}:00</span>
                                <span class="peak-count">{{ peak.count }}条</span>
                            </div>
                        </div>
                    </div>
                    <div class="time-group">
                        <h5>活跃日期</h5>
                        <div class="peak-days">
                            <div v-for="peak in comprehensiveStats.timeInsights.peakDays" :key="peak.day" class="peak-item">
                                <span class="peak-day">{{ peak.day }}</span>
                                <span class="peak-count">{{ peak.count }}条</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 内容质量 -->
            <div class="stats-section">
                <h4>内容质量分析</h4>
                <div class="content-insights">
                    <div class="content-item">
                        <i class="fas fa-file-text"></i>
                        <span class="content-label">有内容</span>
                        <span class="content-value">{{ contentQuality.withContent }}条</span>
                    </div>
                    <div class="content-item">
                        <i class="fas fa-quote-left"></i>
                        <span class="content-label">有摘要</span>
                        <span class="content-value">{{ contentQuality.withExcerpt }}条</span>
                    </div>
                    <div class="content-item">
                        <i class="fas fa-image"></i>
                        <span class="content-label">有图片</span>
                        <span class="content-value">{{ contentQuality.withImages }}条</span>
                    </div>
                    <div class="content-item">
                        <i class="fas fa-link"></i>
                        <span class="content-label">有链接</span>
                        <span class="content-value">{{ contentQuality.withLinks }}条</span>
                    </div>
                    <div class="content-item">
                        <i class="fas fa-ruler"></i>
                        <span class="content-label">平均长度</span>
                        <span class="content-value">{{ contentQuality.averageLength }}字符</span>
                    </div>
                </div>
            </div>

            <!-- 分类详情 -->
            <div class="stats-section">
                <h4>分类详情</h4>
                <div class="category-details">
                    <div v-for="(quality, key) in categoryQuality" :key="key" class="category-detail-item">
                        <div class="detail-header">
                            <div class="detail-title">
                                <i class="fas fa-tag"></i>
                                <span>{{ quality.title }}</span>
                            </div>
                            <div class="detail-stats">
                                <span class="detail-count">{{ quality.count }}条</span>
                                <span class="detail-confidence" :style="{ color: getConfidenceColor(quality.confidence) }">
                                    {{ (quality.confidence * 100).toFixed(1) }}%
                                </span>
                            </div>
                        </div>
                        <div class="detail-methods">
                            <span v-for="method in quality.methods" :key="method" class="method-tag">
                                <i :class="getMethodIcon(method)"></i>
                                {{ method }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
