<div class="task-list-container" v-show="hasTasksData" role="region" aria-label="任务列表">
    <div class="task-list-content">
        <!-- 加载状态 -->
        <div v-if="loading" class="task-loading-state" role="status" aria-live="polite">
            <i class="fas fa-spinner" aria-hidden="true"></i>
            <span>正在加载任务数据...</span>
        </div>
        
        <!-- 错误状态 -->
        <div v-else-if="error" class="task-error-state" role="alert" aria-live="assertive">
            <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
            <span>加载失败</span>
            <p>{{ error }}</p>
            <button @click="handleLoadTasksData" class="task-retry-btn" aria-label="重新加载任务数据">
                <i class="fas fa-refresh" aria-hidden="true"></i>
                重新加载
            </button>
        </div>
        
        <!-- 空状态 -->
        <div v-else-if="searchResults.length === 0" class="task-empty-state" role="status" aria-live="polite">
            <i class="fas fa-tasks" aria-hidden="true"></i>
            <span v-if="searchQuery">未找到匹配 "{{ searchQuery }}" 的任务</span>
            <span v-else>暂无任务数据</span>
        </div>
        
        <!-- 任务列表 -->
        <div v-else class="task-grid" role="list" aria-label="任务列表">
            <article 
                v-for="(task, index) in searchResults" 
                :key="task.key || `task-${index}-${task.title}-${task.featureName || ''}-${task.cardTitle || ''}`"
                @touchstart="startInteraction(task, $event)"
                @touchend="endInteraction"
                @touchcancel="endInteraction"
                @mousedown="startInteraction(task, $event)"
                @mouseup="endInteraction"
                @mouseleave="endInteraction"
                @click="handleTaskClick(task, $event)"
                :class="['task-item', { 
                    active: clickedItems.has(task.title),
                    clicked: clickedItems.has(task.title),
                    'selected': isTaskSelected(task)
                }]"
                :title="getTaskTitle(task)"
                role="listitem"
                tabindex="0"
                @keydown.enter="handleTaskClick(task, $event)"
                @keydown.space="handleTaskClick(task, $event)"
                :aria-label="`任务 ${index + 1}: ${task.title}`"
                :aria-describedby="`task-${index}-description`"
            >
                <header class="task-header">
                    <div class="task-header-content">
                        <h3 class="task-title" :id="`task-${index}-title`">{{ task.title }}</h3>
                        <!-- 标签区域 -->
                        <div class="task-tags" v-if="task.featureName || task.cardTitle">
                            <span class="task-tag feature-tag" v-if="task.featureName">
                                <i class="fas fa-tag" aria-hidden="true"></i>
                                {{ task.featureName }}
                            </span>
                            <span class="task-tag card-tag" v-if="task.cardTitle">
                                <i class="fas fa-layer-group" aria-hidden="true"></i>
                                {{ task.cardTitle }}
                            </span>
                        </div>
                    </div>
                </header>
                
                <div class="task-description" :id="`task-${index}-description`">
                  <div 
                        v-if="task.description && task.description.length > 100"
                        @click="toggleDescriptionExpanded(task.title)"
                        class="description-toggle-btn"
                        :class="{ 'expanded': isDescriptionExpanded(task.title) }"
                        :title="isDescriptionExpanded(task.title) ? '收起描述' : '展开描述'"
                        aria-label="切换描述显示"
                    >
                        <i class="fas fa-chevron-down" v-if="!isDescriptionExpanded(task.title)"></i>
                        <i class="fas fa-chevron-up" v-else></i>
                        <span>{{ isDescriptionExpanded(task.title) ? '收起' : '展开' }}</span>
                  </div>
                  <div class="description-content" :class="{ 'expanded': isDescriptionExpanded(task.title) }">  
                      {{ task.description }}
                  </div>
                </div>
                
                <div class="task-input-output" aria-label="任务输入输出信息">
                    <div class="task-input">
                        <p><i class="fas fa-arrow-down" aria-hidden="true"></i> 输入：{{ task.input }}</p>
                    </div>
                    <div class="task-output">
                        <p><i class="fas fa-arrow-up" aria-hidden="true"></i> 输出：{{ task.output }}</p>
                    </div>
                </div>

              
              <!-- 步骤进度详情 -->
              <div class="task-steps-preview" v-if="getTaskSteps(task).total > 0">
                  <div class="steps-preview-header" :class="{ 'expanded': isStepsExpanded(task.title) }">
                      <i class="fas fa-list-ol" aria-hidden="true"></i>
                      <span class="steps-preview-title">执行步骤</span>
                      <span class="steps-preview-count">{{ getTaskSteps(task).completed }}/{{ getTaskSteps(task).total }}</span>
                      <button 
                          v-if="getTaskSteps(task).total > 3"
                          @click="toggleStepsExpanded(task.title)"
                          class="steps-toggle-btn"
                          :class="{ 'expanded': isStepsExpanded(task.title) }"
                          :title="isStepsExpanded(task.title) ? '收起步骤' : '展开全部步骤'"
                          aria-label="切换步骤显示"
                      >
                          <i class="fas fa-chevron-down" v-if="!isStepsExpanded(task.title)"></i>
                          <i class="fas fa-chevron-up" v-else></i>
                      </button>
                  </div>
                  <div class="steps-preview-list">
                      <div 
                          v-for="step in getVisibleSteps(task)" 
                          :key="`${task.key || 'task'}-step-${step.number}`"
                          class="step-preview-item"
                          :class="{ 'completed': step.completed }"
                          :title="step.text"
                      >
                          <div 
                              class="step-preview-checkbox"
                              @click="toggleStepComplete(task.title, step.number, step.completed)"
                              :title="step.completed ? '取消完成' : '标记完成'"
                              role="button"
                              tabindex="0"
                              :aria-label="`步骤 ${step.number}: ${step.completed ? '取消完成' : '标记完成'}`"
                              @keydown.enter="toggleStepComplete(task.title, step.number, step.completed)"
                              @keydown.space="toggleStepComplete(task.title, step.number, step.completed)"
                          >
                              <i class="fas fa-check" v-if="step.completed"></i>
                              <i class="fas fa-circle" v-else></i>
                          </div>
                          <span class="step-preview-number">{{ step.number }}</span>
                          <span class="step-preview-text">{{ step.text }}</span>
                      </div>
                      <div v-if="!isStepsExpanded(task.title) && getTaskSteps(task).total > 3" class="step-preview-more">
                          <i class="fas fa-ellipsis-h"></i>
                          <span>还有 {{ getTaskSteps(task).total - 3 }} 个步骤</span>
                          <button 
                              @click="toggleStepsExpanded(task.title)"
                              class="expand-steps-btn"
                              title="点击展开全部步骤"
                          >
                              展开全部
                          </button>
                      </div>
                  </div>
              </div>
            </article>
        </div>
    </div>
</div> 


