<!-- 日报视图组件模板 -->
<div class="daily-report-container" v-if="showDailyReport">
    <!-- 日报头部 -->
    <div class="daily-header">
        <div class="daily-header-left">
            <h3>
                <i class="fas fa-calendar-day"></i>
                日报视图
            </h3>
            <div class="date-selector">
                <button @click="previousDay" class="date-nav-btn" title="前一天">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="current-date-info">
                    <label class="sr-only" for="date-picker">选择日期</label>
                    <input 
                        id="date-picker"
                        type="date" 
                        v-model="currentDateStr" 
                        @change="onDateChange"
                        class="date-picker"
                        title="选择要查看的日期"
                    >
                    <span class="date-display">{{ formatCurrentDate() }}</span>
                </div>
                <button @click="nextDay" class="date-nav-btn" title="后一天">
                    <i class="fas fa-chevron-right"></i>
                </button>
                <button @click="goToToday" class="date-nav-btn today-btn" title="回到今天">
                    <i class="fas fa-calendar-day"></i>
                    今天
                </button>
            </div>
        </div>
        <div class="daily-header-right">
            <div class="daily-actions">
                <button @click="addQuickTask" class="action-btn primary" title="快速添加任务">
                    <i class="fas fa-plus"></i>
                    添加任务
                </button>
                <button @click="startTimeTracker" class="action-btn" title="开始计时">
                    <i class="fas fa-play"></i>
                    开始计时
                </button>
                <button @click="exportDailyReport" class="action-btn" title="导出日报">
                    <i class="fas fa-download"></i>
                    导出
                </button>
                <button @click="refreshDailyData" class="action-btn" title="刷新数据">
                    <i class="fas fa-sync-alt"></i>
                    刷新
                </button>
            </div>
        </div>
    </div>

    <!-- 日报概览 -->
    <div class="daily-overview">
        <div class="overview-card time-summary">
            <div class="card-header">
                <h4><i class="fas fa-clock"></i> 时间概览</h4>
            </div>
            <div class="card-content">
                <div class="time-stats">
                    <div class="time-stat">
                        <span class="time-value">{{ dailyStats.plannedHours }}h</span>
                        <span class="time-label">计划工时</span>
                    </div>
                    <div class="time-stat">
                        <span class="time-value">{{ dailyStats.actualHours }}h</span>
                        <span class="time-label">实际工时</span>
                    </div>
                    <div class="time-stat">
                        <span class="time-value">{{ dailyStats.remainingHours }}h</span>
                        <span class="time-label">剩余工时</span>
                    </div>
                </div>
                <div class="time-progress">
                    <div class="progress-track">
                        <div 
                            class="progress-fill" 
                            :style="{ width: getTimeProgress() + '%' }"
                        ></div>
                    </div>
                    <span class="progress-text">{{ getTimeProgress() }}% 完成</span>
                </div>
            </div>
        </div>

        <div class="overview-card task-summary">
            <div class="card-header">
                <h4><i class="fas fa-tasks"></i> 任务概览</h4>
            </div>
            <div class="card-content">
                <div class="task-stats">
                    <div class="task-stat completed">
                        <span class="stat-number">{{ dailyStats.completedTasks }}</span>
                        <span class="stat-label">已完成</span>
                    </div>
                    <div class="task-stat in-progress">
                        <span class="stat-number">{{ dailyStats.inProgressTasks }}</span>
                        <span class="stat-label">进行中</span>
                    </div>
                    <div class="task-stat pending">
                        <span class="stat-number">{{ dailyStats.pendingTasks }}</span>
                        <span class="stat-label">待开始</span>
                    </div>
                    <div class="task-stat total">
                        <span class="stat-number">{{ dailyStats.totalTasks }}</span>
                        <span class="stat-label">总计</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="overview-card focus-time">
            <div class="card-header">
                <h4><i class="fas fa-bullseye"></i> 专注时间</h4>
            </div>
            <div class="card-content">
                <div class="focus-stats">
                    <div class="focus-item">
                        <div class="focus-timer">
                            <span class="timer-display">{{ formatTime(currentFocusTime) }}</span>
                            <button 
                                @click="toggleFocusTimer" 
                                :class="['timer-btn', { active: isTimerRunning }]"
                                :title="isTimerRunning ? '停止专注计时' : '开始专注计时'"
                                :aria-label="isTimerRunning ? '停止专注计时' : '开始专注计时'"
                            >
                                <span class="sr-only">{{ isTimerRunning ? '停止专注计时' : '开始专注计时' }}</span>
                                <i :class="isTimerRunning ? 'fas fa-pause' : 'fas fa-play'"></i>
                            </button>
                        </div>
                        <div class="focus-target">
                            目标: {{ focusTarget }}分钟
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 时间轴视图 -->
    <div class="timeline-section">
        <div class="section-header">
            <h4><i class="fas fa-clock"></i> 今日时间轴</h4>
            <div class="timeline-controls">
                <div class="view-mode-toggle">
                    <button 
                        :class="['mode-btn', { active: timelineMode === 'hourly' }]"
                        @click="setTimelineMode('hourly')"
                    >
                        <i class="fas fa-clock"></i>
                        按小时
                    </button>
                    <button 
                        :class="['mode-btn', { active: timelineMode === 'task' }]"
                        @click="setTimelineMode('task')"
                    >
                        <i class="fas fa-list"></i>
                        按任务
                    </button>
                </div>
            </div>
        </div>

        <div class="timeline-content" ref="timelineContent">
            <!-- 按小时视图 -->
            <div v-if="timelineMode === 'hourly'" class="hourly-timeline">
                <div class="timeline-hours">
                    <div 
                        v-for="hour in timelineHours" 
                        :key="hour.value"
                        :class="['hour-slot', { 
                            'current-hour': hour.isCurrent,
                            'has-tasks': hour.tasks.length > 0
                        }]"
                    >
                        <div class="hour-header">
                            <span class="hour-time">{{ hour.label }}</span>
                            <span class="hour-tasks-count">{{ hour.tasks.length }}个任务</span>
                        </div>
                        <div class="hour-tasks">
                            <div 
                                v-for="task in hour.tasks" 
                                :key="task.key"
                                :class="['timeline-task', getTaskStatusClass(task)]"
                                @click="selectTask(task)"
                            >
                                <div class="task-time">
                                    {{ getTaskTimeRange(task) }}
                                </div>
                                <div class="task-info">
                                    <span class="task-title">{{ task.title }}</span>
                                    <span class="task-duration">{{ getTaskDuration(task) }}分钟</span>
                                </div>
                                <div class="task-actions">
                                    <button 
                                        @click.stop="toggleTaskTimer(task)"
                                        :class="['timer-action', { running: isTaskTimerRunning(task) }]"
                                        :title="isTaskTimerRunning(task) ? '停止计时' : '开始计时'"
                                        :aria-label="isTaskTimerRunning(task) ? '停止计时' : '开始计时'"
                                    >
                                        <span class="sr-only">{{ isTaskTimerRunning(task) ? '停止计时' : '开始计时' }}</span>
                                        <i :class="isTaskTimerRunning(task) ? 'fas fa-pause' : 'fas fa-play'"></i>
                                    </button>
                                    <button 
                                        @click.stop="markTaskComplete(task)"
                                        class="complete-action"
                                        title="标记完成"
                                        :aria-label="`标记任务 ${task.title} 为完成`"
                                    >
                                        <i class="fas fa-check"></i>
                                    </button>
                                </div>
                            </div>
                            <div v-if="hour.tasks.length === 0" class="empty-hour">
                                <span>空闲时间</span>
                                <button @click="addTaskToHour(hour)" class="add-task-btn" title="为此时段添加任务">
                                    <i class="fas fa-plus"></i>
                                    添加任务
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 按任务视图 -->
            <div v-else class="task-timeline">
                <div class="timeline-tasks">
                    <div 
                        v-for="task in todayTasks" 
                        :key="task.key"
                        :class="['task-timeline-item', getTaskStatusClass(task)]"
                    >
                        <div class="task-timeline-header">
                            <div class="task-priority" :class="getTaskPriority(task)">
                                <i class="fas fa-circle"></i>
                            </div>
                            <div class="task-info">
                                <h5 class="task-title">{{ task.title }}</h5>
                                <div class="task-meta">
                                    <span class="task-category">{{ getTaskCategory(task) }}</span>
                                    <span class="task-time">{{ getTaskTimeRange(task) }}</span>
                                    <span class="task-duration">{{ getTaskDuration(task) }}分钟</span>
                                </div>
                            </div>
                            <div class="task-controls">
                                <button 
                                    @click="toggleTaskTimer(task)"
                                    :class="['control-btn timer-btn', { active: isTaskTimerRunning(task) }]"
                                    :title="isTaskTimerRunning(task) ? '停止计时' : '开始计时'"
                                    :aria-label="isTaskTimerRunning(task) ? '停止计时' : '开始计时'"
                                >
                                    <span class="sr-only">{{ isTaskTimerRunning(task) ? '停止计时' : '开始计时' }}</span>
                                    <i :class="isTaskTimerRunning(task) ? 'fas fa-pause' : 'fas fa-play'"></i>
                                </button>
                                <button 
                                    @click="editTask(task)"
                                    class="control-btn edit-btn"
                                    title="编辑任务"
                                >
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button 
                                    @click="markTaskComplete(task)"
                                    class="control-btn complete-btn"
                                    title="标记完成"
                                    :aria-label="`标记任务 ${task.title} 为完成`"
                                >
                                    <i class="fas fa-check"></i>
                                </button>
                            </div>
                        </div>
                        <div class="task-timeline-content">
                            <div class="task-description" v-if="task.description">
                                {{ task.description }}
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 今日总结 -->
    <div class="daily-summary">
        <div class="summary-header">
            <h4><i class="fas fa-clipboard-check"></i> 今日总结</h4>
        </div>
        <div class="summary-content">
            <div class="summary-item">
                <label>今日成就:</label>
                <textarea 
                    v-model="dailySummary.achievements"
                    placeholder="记录今天完成的重要工作..."
                    class="summary-textarea"
                    rows="3"
                ></textarea>
            </div>
            <div class="summary-item">
                <label>遇到的问题:</label>
                <textarea 
                    v-model="dailySummary.issues"
                    placeholder="记录今天遇到的问题和挑战..."
                    class="summary-textarea"
                    rows="3"
                ></textarea>
            </div>
            <div class="summary-item">
                <label>明日计划:</label>
                <textarea 
                    v-model="dailySummary.tomorrowPlan"
                    placeholder="制定明天的工作计划..."
                    class="summary-textarea"
                    rows="3"
                ></textarea>
            </div>
            <div class="summary-actions">
                <button @click="saveDailySummary" class="save-btn">
                    <i class="fas fa-save"></i>
                    保存总结
                </button>
                <button @click="clearSummary" class="clear-btn">
                    <i class="fas fa-trash"></i>
                    清空
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 空状态 -->
<div v-else class="daily-empty-state">
    <div class="empty-state-content">
        <i class="fas fa-calendar-day empty-icon"></i>
        <h3>暂无今日数据</h3>
        <p>今天还没有安排任务，开始制定你的日程吧！</p>
        <button @click="addQuickTask" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            添加第一个任务
        </button>
    </div>
</div>

<!-- 快速添加任务弹窗 -->
<div v-if="showQuickTaskModal" class="modal-overlay" @click="closeQuickTaskModal">
    <div class="quick-task-modal" @click.stop>
        <div class="modal-header">
            <h4>快速添加任务</h4>
            <button @click="closeQuickTaskModal" class="close-btn" title="关闭弹窗" aria-label="关闭快速添加任务弹窗">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-content">
            <div class="form-group">
                <label>任务标题</label>
                <input 
                    type="text" 
                    v-model="quickTask.title"
                    placeholder="输入任务标题..."
                    class="form-input"
                    ref="quickTaskTitle"
                >
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="task-start-time">开始时间</label>
                    <input 
                        id="task-start-time"
                        type="time" 
                        v-model="quickTask.startTime"
                        class="form-input"
                        title="设置任务开始时间"
                    >
                </div>
                <div class="form-group">
                    <label for="task-duration">预计用时</label>
                    <select id="task-duration" v-model="quickTask.duration" class="form-select" title="选择任务预计用时">
                        <option value="15">15分钟</option>
                        <option value="30">30分钟</option>
                        <option value="60">1小时</option>
                        <option value="120">2小时</option>
                        <option value="240">4小时</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="task-priority">优先级</label>
                    <select id="task-priority" v-model="quickTask.priority" class="form-select" title="选择任务优先级">
                        <option value="low">低</option>
                        <option value="medium">中</option>
                        <option value="high">高</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>任务描述</label>
                <textarea 
                    v-model="quickTask.description"
                    placeholder="简要描述任务内容..."
                    class="form-textarea"
                    rows="3"
                ></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button @click="closeQuickTaskModal" class="btn btn-secondary">
                取消
            </button>
            <button @click="createQuickTask" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                添加任务
            </button>
        </div>
    </div>
</div>

