<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YiTasks</title>
    
    <!-- å¼•å…¥CSSæ–‡ä»¶ -->
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/views/tasks/index.css">
    <link rel="stylesheet" href="/plugins/searchHeader/index.css">

    <link rel="stylesheet" href="/views/tasks/plugins/calendarView/index.css">

    <link rel="stylesheet" href="/views/tasks/plugins/enhancedTaskList/index.css">
    <link rel="stylesheet" href="/views/tasks/plugins/enhancedTaskList/list-view-bem.css">
    <link rel="stylesheet" href="/views/tasks/plugins/timeSlotTracker/index.css">

    <!-- å¼•å…¥å­—ä½“å›¾æ ‡ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- å…ƒä¿¡æ¯ -->
    <meta name="description" content="ä¸–ç•Œçº§ä¸“ä¸šä»»åŠ¡ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒæ•æ·å¼€å‘ã€é¡¹ç›®ç®¡ç†ã€å›¢é˜Ÿåä½œ">
    <meta name="keywords" content="ä»»åŠ¡ç®¡ç†,é¡¹ç›®ç®¡ç†,æ•æ·å¼€å‘,å›¢é˜Ÿåä½œ,ç”˜ç‰¹å›¾,ä¸“ä¸šç‰ˆ">
    <meta name="author" content="TaskPro Enterprise Team">
    

</head>
<body>
    

    <div id="app">
        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="main-layout">
            <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content" role="main">
                <!-- é«˜çº§å·¥å…·æ  - é‡æ„ä¸ºä¸é¦–é¡µheader-rowä¸€è‡´çš„å¸ƒå±€ -->
                <div class="advanced-toolbar">
                    <div class="toolbar-row">
                        <div class="toolbar-left">
                            <!-- å¿«é€Ÿæœç´¢ -->
                            <div class="search-box" role="search" aria-label="ä»»åŠ¡æœç´¢">
                                <span class="search-logo" aria-hidden="true" @click="goToHome">
                                    <i class="fas fa-brain" aria-label="AIå¤§è„‘å›¾æ ‡"></i>
                                </span>
                                <div class="search-input-wrapper">
                                    <label for="taskSearchInput" class="visually-hidden">ä»»åŠ¡æœç´¢è¾“å…¥æ¡†</label>
                                    <textarea 
                                        id="taskSearchInput" 
                                        v-model="searchQuery"
                                        @input="handleQuickSearch"
                                        placeholder="æœç´¢ä»»åŠ¡å†…å®¹ï¼Œæ”¯æŒæ ‡é¢˜ã€æè¿°ã€è¾“å…¥è¾“å‡ºã€æ­¥éª¤ç­‰..." 
                                        rows="1" 
                                        maxlength="2000"
                                        aria-label="ä»»åŠ¡æœç´¢è¾“å…¥æ¡†"
                                        autocomplete="off"
                                        spellcheck="false"
                                        class="search-input"></textarea>
                                    
                                    <!-- æ¸…é™¤æœç´¢æŒ‰é’® -->
                                    <div class="search-clear" v-if="searchQuery">
                                        <button 
                                            @click="clearSearch"
                                            class="clear-search-btn"
                                            type="button"
                                            title="æ¸…é™¤æœç´¢"
                                            aria-label="æ¸…é™¤æœç´¢å†…å®¹"
                                        >
                                            <i class="fas fa-times" aria-hidden="true"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="toolbar-right">
                            <!-- è§†å›¾åˆ‡æ¢ - é‡æ„ä¸ºä¸é¦–é¡µcascaderä¸€è‡´çš„äº¤äº’ -->
                            <div class="view-switcher">
                                <div class="view-cascader">
                                    <button v-for="view in availableViews" :key="view.key"
                                            @click="setCurrentView(view.key)"
                                            :class="['view-btn', { active: currentView === view.key }]"
                                            :title="view.description"
                                            :aria-label="`åˆ‡æ¢åˆ°${view.name}è§†å›¾`">
                                        <i :class="view.icon" aria-hidden="true"></i>
                                        <span>{{ view.name }}</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- å¯¼å‡ºæŒ‰é’® -->
                            <div class="export-item">
                                <button 
                                    @click="handleExportAllTasks"
                                    class="export-btn"
                                    type="button"
                                    title="å¯¼å‡ºæ‰€æœ‰ä»»åŠ¡æ•°æ®"
                                    aria-label="å¯¼å‡ºæ‰€æœ‰ä»»åŠ¡æ•°æ®">
                                    <i class="fas fa-download" aria-hidden="true"></i>
                                    <span>å¯¼å‡º</span>
                                </button>
                            </div>

                            <!-- æ—¶é—´æ®µè¿½è¸ªæŒ‰é’® -->
                            <div class="time-slot-tracker-item">
                                <button 
                                    @click="showTimeSlotSelector"
                                    class="time-slot-tracker-btn"
                                    type="button"
                                    title="æ—¶é—´æ®µè¿½è¸ª"
                                    aria-label="æ—¶é—´æ®µè¿½è¸ª">
                                    <i class="fas fa-clock" aria-hidden="true"></i>
                                    <span>æ—¶é—´æ®µè¿½è¸ª</span>
                                </button>
                            </div>

                            <!-- åˆ›å»ºä»»åŠ¡æŒ‰é’® - ä¸é¦–é¡µä¿æŒä¸€è‡´ -->
                            <div class="create-card-item">
                                <button 
                                    @click="createTask"
                                    class="create-card-btn"
                                    type="button"
                                    title="åˆ›å»ºæ–°ä»»åŠ¡"
                                    aria-label="åˆ›å»ºæ–°ä»»åŠ¡">
                                    <i class="fas fa-plus" aria-hidden="true"></i>
                                    <span>åˆ›å»ºä»»åŠ¡</span>
                                </button>
                            </div>



                        </div>
                    </div>
                </div>
                
                <!-- ä»»åŠ¡è§†å›¾å†…å®¹åŒº -->
                <div class="content-area">
                    <!-- ä»»åŠ¡åˆ—è¡¨è§†å›¾ -->
                    <enhanced-task-list
                        v-if="currentView === 'card' || currentView === 'list'"
                        :tasks="filteredTasks"
                        :loading="loading"
                        :error="error"
                        :view-mode="currentView"
                        @task-click="handleTaskClick"
                        @task-update="handleTaskUpdate"
                        @task-delete="handleTaskDelete"
                        @task-edit="handleTaskEdit"
                        @task-create-session="handleTaskCreateSession"
                        @create-task="createTask"
                        @retry="loadTasksData"
                    ></enhanced-task-list>
                </div>
                
                <!-- ä»»åŠ¡ç¼–è¾‘å™¨ -->
                <task-editor
                    v-if="showTaskEditor"
                    :visible="showTaskEditor"
                    :task="editingTask"
                    @close="closeTaskEditor"
                    @save="handleTaskSave"
                    @refresh-data="loadTasksData"
                ></task-editor>

                <!-- æ—¶é—´æ®µè¿½è¸ªå™¨ -->
                <div id="time-slot-tracker" class="time-slot-tracker" v-if="showTimeSlotTracker">
                    <!-- æ—¶é—´æ®µå¤´éƒ¨ -->
                    <div class="time-slot-header">
                        <div class="time-slot-title">
                            <span class="time-slot-icon">{{ currentTimeSlot?.config?.icon || 'â°' }}</span>
                            <span>{{ currentTimeSlot?.config?.name || 'æ—¶é—´æ®µè¿½è¸ª' }}</span>
                        </div>
                        <div class="time-slot-status">
                            <div class="status-indicator" :class="{ tracking: isTracking }"></div>
                            <span>{{ isTracking ? 'è¿½è¸ªä¸­' : 'å¾…å¼€å§‹' }}</span>
                        </div>
                    </div>

                    <!-- æ—¶é—´æ®µæè¿° -->
                    <div class="time-slot-description" v-if="currentTimeSlot?.config?.description">
                        <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: 15px;">
                            {{ currentTimeSlot.config.description }}
                        </p>
                    </div>

                    <!-- ä»»åŠ¡æ¸…å• -->
                    <div class="time-slot-tasks" v-if="currentTimeSlot?.config?.tasks">
                        <h4>ğŸ“‹ ä»»åŠ¡æ¸…å•</h4>
                        <div class="task-checklist">
                            <div 
                                v-for="(task, index) in currentTimeSlot.config.tasks" 
                                :key="index"
                                class="task-item"
                                @click="toggleTask(index)"
                            >
                                <div class="task-checkbox" :class="{ checked: completedTasks.has(index) }"></div>
                                <span>{{ task }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- æ•°æ®è¿½è¸ªæŒ‡æ ‡ -->
                    <div class="time-slot-metrics" v-if="currentTimeSlot?.config?.trackingMetrics">
                        <h4 class="metrics-title">ğŸ“Š æ•°æ®è¿½è¸ª</h4>
                        <div class="metrics-grid">
                            <div 
                                v-for="(metric, key) in currentTimeSlot.config.trackingMetrics" 
                                :key="key"
                                class="metric-item"
                            >
                                <label class="metric-label">{{ metric.label }}</label>
                                <div v-if="metric.type === 'rating'" class="rating-input">
                                    <span 
                                        v-for="i in metric.max" 
                                        :key="i"
                                        class="rating-star"
                                        :class="{ active: trackingMetrics[key] >= i }"
                                        @click="updateRating(key, i)"
                                    >
                                        {{ metric.unit }}
                                    </span>
                                </div>
                                <input 
                                    v-else
                                    v-model="trackingMetrics[key]"
                                    :type="metric.type === 'number' ? 'number' : 'text'"
                                    :placeholder="`è¯·è¾“å…¥${metric.label}`"
                                    class="metric-input"
                                    @input="updateMetric(key, $event.target.value)"
                                />
                            </div>
                        </div>
                    </div>

                    <!-- æ“ä½œæŒ‰é’® -->
                    <div class="time-slot-actions">
                        <button 
                            v-if="!isTracking" 
                            @click="startTracking" 
                            class="action-btn start-btn"
                        >
                            â–¶ï¸ å¼€å§‹è¿½è¸ª
                        </button>
                        <button 
                            v-if="isTracking" 
                            @click="stopTracking" 
                            class="action-btn stop-btn"
                        >
                            â¹ï¸ åœæ­¢è¿½è¸ª
                        </button>
                        <button 
                            @click="saveTrackingData" 
                            class="action-btn save-btn"
                        >
                            ğŸ’¾ ä¿å­˜æ•°æ®
                        </button>
                        <button 
                            @click="hideTimeSlotTracker" 
                            class="action-btn"
                            style="background: #6c757d; color: white;"
                        >
                            âŒ å…³é—­
                        </button>
                    </div>

                    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                    <div class="time-slot-stats" v-if="timeSlotStats">
                        <h4 class="stats-title">ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯</h4>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value">{{ timeSlotStats.totalDays }}</div>
                                <div class="stat-label">è¿½è¸ªå¤©æ•°</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ timeSlotStats.averageDuration.toFixed(1) }}</div>
                                <div class="stat-label">å¹³å‡æ—¶é•¿(h)</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ (timeSlotStats.completionRate * 100).toFixed(0) }}%</div>
                                <div class="stat-label">å®Œæˆç‡</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ timeSlotStats.totalDuration.toFixed(1) }}</div>
                                <div class="stat-label">æ€»æ—¶é•¿(h)</div>
                            </div>
                        </div>
                    </div>

                    <!-- å†å²è®°å½• -->
                    <div class="time-slot-history" v-if="trackingHistory.length > 0">
                        <h4 class="history-title">ğŸ“… å†å²è®°å½•</h4>
                        <div class="history-list">
                            <div 
                                v-for="(record, index) in trackingHistory" 
                                :key="index"
                                class="history-item"
                            >
                                <span class="history-date">{{ formatDate(record.date) }}</span>
                                <span class="history-duration">{{ record.duration.toFixed(1) }}h</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ—¶é—´æ®µé€‰æ‹©å™¨ -->
                <div id="time-slot-selector" class="time-slot-selector" v-if="showTimeSlotSelector">
                    <div class="selector-header">
                        <h3>é€‰æ‹©è¦è¿½è¸ªçš„æ—¶é—´æ®µ</h3>
                        <button @click="hideTimeSlotSelector" class="close-btn">Ã—</button>
                    </div>
                    <div class="time-slot-options">
                        <div 
                            v-for="(config, timeRange) in getAllTimeSlotConfigs()" 
                            :key="timeRange"
                            class="time-slot-option"
                            @click="selectTimeSlot(timeRange)"
                        >
                            <div class="option-icon">{{ config.icon }}</div>
                            <div class="option-content">
                                <div class="option-title">{{ config.name }}</div>
                                <div class="option-time">{{ timeRange }}</div>
                                <div class="option-description">{{ config.description }}</div>
                            </div>
                        </div>
                    </div>
                </div>
        </main>
    </div>

        
    </div>

    <!-- å¼•å…¥Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- å¼•å…¥JSZipåº“ç”¨äºå¯¼å‡ºåŠŸèƒ½ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- å¼•å…¥ä»»åŠ¡ç¼–è¾‘å™¨ç»„ä»¶ -->
    <link rel="stylesheet" href="plugins/taskEditor/index.css">
    
    <!-- å¼•å…¥å·¥å…·ç±»ï¼ˆä½¿ç”¨ES6æ¨¡å—ï¼‰ -->
    <script type="module" src="/config.js"></script>
    <script type="module" src="/utils/index.js"></script>
    <script type="module" src="/utils/log.js"></script>
    <script type="module" src="/utils/baseView.js"></script>
    
    <script type="module" src="/utils/message.js"></script>
    
    <!-- å¼•å…¥APIæ¨¡å—ï¼ˆä½¿ç”¨ES6æ¨¡å—ï¼‰ -->
    <script type="module" src="/apis/index.js"></script>
    <script type="module" src="/apis/helper/checkStatus.js"></script>
    <script type="module" src="/apis/helper/requestHelper.js"></script>
    <script type="module" src="/apis/modules/crud.js"></script>
    
    <!-- å¼•å…¥æ•°æ®ï¼ˆå¿…é¡»åœ¨å…¶ä»–è„šæœ¬ä¹‹å‰åŠ è½½ï¼‰ -->
    <script type="module" src="/views/tasks/data/mockData.js"></script>
    
    <!-- å¼•å…¥hooksé€»è¾‘ -->
    <script type="module" src="/views/tasks/hooks/store.js"></script>
    <script type="module" src="/views/tasks/hooks/useComputed.js"></script>
    <script type="module" src="/views/tasks/hooks/useMethods.js"></script>
    
    <!-- å¼•å…¥æ–°ç»„ä»¶ï¼ˆä¼˜å…ˆå…¼å®¹ç°æœ‰ç»„ä»¶ï¼‰ -->
    <script type="module" src="/views/tasks/plugins/enhancedTaskList/index.js"></script>
    <script type="module" src="/views/tasks/plugins/timeSlotTracker/index.js"></script>

    <script type="module" src="/views/tasks/plugins/taskEditor/index.js"></script>

    
    <!-- å…¼å®¹ç°æœ‰ç»„ä»¶ -->
    <script type="module" src="/views/tasks/plugins/taskList/index.js"></script>

    
    <!-- å¼•å…¥é¡µé¢é€»è¾‘ -->
    <script type="module" src="/views/tasks/index.js"></script>
    
    
    
    <!-- å¿«æ·é”®æ”¯æŒ -->
    <script>
        // å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            // å¦‚æœå½“å‰ç„¦ç‚¹åœ¨è¾“å…¥æ¡†æˆ–æ–‡æœ¬åŒºåŸŸä¸­ï¼Œä¸é˜»æ­¢ä»»ä½•æŒ‰é”®
            const activeElement = document.activeElement;
            if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA')) {
                return;
            }
            
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const searchInput = document.querySelector('.global-search-input');
                if (searchInput) {
                    searchInput.focus();
                }
            }
        });
        
        // ç¦ç”¨å³é”®èœå•ï¼Œå¢å¼ºä¸“ä¸šæ€§
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
    </script>
    
    <!-- ç»„ä»¶æ³¨å†Œæµ‹è¯•è„šæœ¬ -->
    <script>
        // åœ¨é¡µé¢åŠ è½½å®Œæˆåæµ‹è¯•TaskEditorç»„ä»¶
        window.addEventListener('load', function() {
            console.log('[TaskEditor Test] é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æµ‹è¯•ç»„ä»¶...');
            
            // ç­‰å¾…ä¸€æ®µæ—¶é—´ç¡®ä¿æ‰€æœ‰è„šæœ¬åŠ è½½å®Œæˆ
            setTimeout(function() {
                console.log('[TaskEditor Test] æ£€æŸ¥TaskEditorç»„ä»¶çŠ¶æ€...');
                
                if (window.TaskEditor) {
                    console.log('[TaskEditor Test] âœ… TaskEditorç»„ä»¶å·²åŠ è½½:', {
                        name: window.TaskEditor.name,
                        hasTemplate: !!window.TaskEditor.template,
                        hasProps: !!window.TaskEditor.props,
                        hasMethods: !!window.TaskEditor.methods,
                        hasData: !!window.TaskEditor.data
                    });
                    
                    // æµ‹è¯•ç»„ä»¶ç»“æ„
                    const component = window.TaskEditor;
                    const hasMethods = !!(component.methods && typeof component.methods === 'object');
                    const hasProps = !!(component.props && typeof component.props === 'object');
                    const hasData = !!(component.data && typeof component.data === 'function');
                    
                    console.log('[TaskEditor Test] ç»„ä»¶ç»“æ„è¯¦æƒ…:', {
                        template: component.template ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨',
                        props: hasProps ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨',
                        methods: hasMethods ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨',
                        data: hasData ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'
                    });
                } else {
                    console.error('[TaskEditor Test] âŒ TaskEditorç»„ä»¶æœªæ‰¾åˆ°');
                }
                
                // æ£€æŸ¥Vueåº”ç”¨çŠ¶æ€
                if (window.TaskProApp && window.TaskProApp.app) {
                    const app = window.TaskProApp.app;
                    const hasComponents = !!(app._context && app._context.components);
                    const componentCount = hasComponents ? Object.keys(app._context.components).length : 0;
                    
                    console.log('[TaskEditor Test] Vueåº”ç”¨çŠ¶æ€:', {
                        hasApp: !!app,
                        hasComponents: hasComponents,
                        componentCount: componentCount
                    });
                }
            }, 1000);
        });
    </script>
</body>
</html> 









