<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YiTasks</title>
    
    <!-- 引入CSS文件 -->
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/views/tasks/index.css">
    <link rel="stylesheet" href="/plugins/searchHeader/index.css">

    <link rel="stylesheet" href="/views/tasks/plugins/enhancedGanttChart/index.css">
    <link rel="stylesheet" href="/views/tasks/plugins/calendarView/index.css">

    <link rel="stylesheet" href="/views/tasks/plugins/enhancedTaskList/index.css">

    <!-- 引入字体图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 元信息 -->
    <meta name="description" content="世界级专业任务管理系统，支持敏捷开发、项目管理、团队协作">
    <meta name="keywords" content="任务管理,项目管理,敏捷开发,团队协作,甘特图,专业版">
    <meta name="author" content="TaskPro Enterprise Team">
    

</head>
<body>
    

    <div id="app">
        <!-- 主要内容区域 -->
        <div class="main-layout">
            <!-- 主内容区 -->
        <main class="main-content" role="main">
                <!-- 高级工具栏 - 重构为与首页header-row一致的布局 -->
                <div class="advanced-toolbar">
                    <div class="toolbar-row">
                        <div class="toolbar-left">
                            <!-- 快速搜索 -->
                            <div class="search-box" role="search" aria-label="任务搜索">
                                <span class="search-logo" aria-hidden="true" @click="goToHome">
                                    <i class="fas fa-brain" aria-label="AI大脑图标"></i>
                                </span>
                                <div class="search-input-wrapper">
                                    <label for="taskSearchInput" class="visually-hidden">任务搜索输入框</label>
                                    <textarea 
                                        id="taskSearchInput" 
                                        v-model="searchQuery"
                                        @input="handleQuickSearch"
                                        placeholder="搜索任务内容，支持标题、描述、输入输出、步骤等..." 
                                        rows="1" 
                                        maxlength="2000"
                                        aria-label="任务搜索输入框"
                                        autocomplete="off"
                                        spellcheck="false"
                                        class="search-input"></textarea>
                                    
                                    <!-- 清除搜索按钮 -->
                                    <div class="search-clear" v-if="searchQuery">
                                        <button 
                                            @click="clearSearch"
                                            class="clear-search-btn"
                                            type="button"
                                            title="清除搜索"
                                            aria-label="清除搜索内容"
                                        >
                                            <i class="fas fa-times" aria-hidden="true"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="toolbar-right">
                            <!-- 视图切换 - 重构为与首页cascader一致的交互 -->
                            <div class="view-switcher">
                                <div class="view-cascader">
                                    <button v-for="view in availableViews" :key="view.key"
                                            @click="setCurrentView(view.key)"
                                            :class="['view-btn', { active: currentView === view.key }]"
                                            :title="view.description"
                                            :aria-label="`切换到${view.name}视图`">
                                        <i :class="view.icon" aria-hidden="true"></i>
                                        <span>{{ view.name }}</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 导出按钮 -->
                            <div class="export-item">
                                <button 
                                    @click="handleExportAllTasks"
                                    class="export-btn"
                                    type="button"
                                    title="导出所有任务数据"
                                    aria-label="导出所有任务数据">
                                    <i class="fas fa-download" aria-hidden="true"></i>
                                    <span>导出</span>
                                </button>
                            </div>

                            <!-- 创建任务按钮 - 与首页保持一致 -->
                            <div class="create-card-item">
                                <button 
                                    @click="createTask"
                                    class="create-card-btn"
                                    type="button"
                                    title="创建新任务"
                                    aria-label="创建新任务">
                                    <i class="fas fa-plus" aria-hidden="true"></i>
                                    <span>创建任务</span>
                                </button>
                            </div>



                        </div>
                    </div>
                </div>
                
                <!-- 任务视图内容区 -->
                <div class="content-area">
                    <!-- 任务列表视图 -->
                    <enhanced-task-list
                        v-if="currentView === 'list'"
                        :tasks="filteredTasks"
                        :loading="loading"
                        :error="error"
                        @task-click="handleTaskClick"
                        @task-update="handleTaskUpdate"
                        @task-delete="handleTaskDelete"
                        @task-edit="handleTaskEdit"
                        @create-task="createTask"
                        @retry="loadTasksData"
                    ></enhanced-task-list>
                    <!-- 甘特图视图 -->
                    <enhanced-gantt-chart
                        v-if="currentView === 'gantt'"
                        :tasks="filteredTasks"
                        @task-update="handleTaskUpdate"
                    ></enhanced-gantt-chart>
                </div>
                
                <!-- 任务编辑器 -->
                <task-editor
                    v-if="showTaskEditor"
                    :visible="showTaskEditor"
                    :task="editingTask"
                    @close="closeTaskEditor"
                    @save="handleTaskSave"
                    @refresh-data="loadTasksData"
                ></task-editor>
        </main>
    </div>

        
    </div>

    <!-- 引入Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- 引入JSZip库用于导出功能 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- 引入任务编辑器组件 -->
    <link rel="stylesheet" href="plugins/taskEditor/index.css">
    
    <!-- 引入工具类（使用ES6模块） -->
    <script type="module" src="/config.js"></script>
    <script type="module" src="/utils/index.js"></script>
    <script type="module" src="/utils/log.js"></script>
    <script type="module" src="/utils/baseView.js"></script>
    
    <script type="module" src="/utils/message.js"></script>
    
    <!-- 引入API模块（使用ES6模块） -->
    <script type="module" src="/apis/index.js"></script>
    <script type="module" src="/apis/helper/checkStatus.js"></script>
    <script type="module" src="/apis/helper/requestHelper.js"></script>
    <script type="module" src="/apis/modules/crud.js"></script>
    
    <!-- 引入数据（必须在其他脚本之前加载） -->
    <script type="module" src="/views/tasks/data/mockData.js"></script>
    
    <!-- 引入hooks逻辑 -->
    <script type="module" src="/views/tasks/hooks/store.js"></script>
    <script type="module" src="/views/tasks/hooks/useComputed.js"></script>
    <script type="module" src="/views/tasks/hooks/useMethods.js"></script>
    
    <!-- 引入新组件（优先兼容现有组件） -->
    <script type="module" src="/views/tasks/plugins/enhancedTaskList/index.js"></script>

    <script type="module" src="/views/tasks/plugins/enhancedGanttChart/index.js"></script>
    <script type="module" src="/views/tasks/plugins/taskEditor/index.js"></script>

    
    <!-- 兼容现有组件 -->
    <script type="module" src="/views/tasks/plugins/taskList/index.js"></script>
    <script type="module" src="/views/tasks/plugins/ganttChart/index.js"></script>

    
    <!-- 引入页面逻辑 -->
    <script type="module" src="/views/tasks/index.js"></script>
    
    
    
    <!-- 快捷键支持 -->
    <script>
        // 快捷键支持
        document.addEventListener('keydown', function(e) {
            // 如果当前焦点在输入框或文本区域中，不阻止任何按键
            const activeElement = document.activeElement;
            if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA')) {
                return;
            }
            
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const searchInput = document.querySelector('.global-search-input');
                if (searchInput) {
                    searchInput.focus();
                }
            }
        });
        
        // 禁用右键菜单，增强专业性
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
    </script>
    
    <!-- 组件注册测试脚本 -->
    <script>
        // 在页面加载完成后测试TaskEditor组件
        window.addEventListener('load', function() {
            console.log('[TaskEditor Test] 页面加载完成，开始测试组件...');
            
            // 等待一段时间确保所有脚本加载完成
            setTimeout(function() {
                console.log('[TaskEditor Test] 检查TaskEditor组件状态...');
                
                if (window.TaskEditor) {
                    console.log('[TaskEditor Test] ✅ TaskEditor组件已加载:', {
                        name: window.TaskEditor.name,
                        hasTemplate: !!window.TaskEditor.template,
                        hasProps: !!window.TaskEditor.props,
                        hasMethods: !!window.TaskEditor.methods,
                        hasData: !!window.TaskEditor.data
                    });
                    
                    // 测试组件结构
                    const component = window.TaskEditor;
                    const hasMethods = !!(component.methods && typeof component.methods === 'object');
                    const hasProps = !!(component.props && typeof component.props === 'object');
                    const hasData = !!(component.data && typeof component.data === 'function');
                    
                    console.log('[TaskEditor Test] 组件结构详情:', {
                        template: component.template ? '存在' : '不存在',
                        props: hasProps ? '存在' : '不存在',
                        methods: hasMethods ? '存在' : '不存在',
                        data: hasData ? '存在' : '不存在'
                    });
                } else {
                    console.error('[TaskEditor Test] ❌ TaskEditor组件未找到');
                }
                
                // 检查Vue应用状态
                if (window.TaskProApp && window.TaskProApp.app) {
                    const app = window.TaskProApp.app;
                    const hasComponents = !!(app._context && app._context.components);
                    const componentCount = hasComponents ? Object.keys(app._context.components).length : 0;
                    
                    console.log('[TaskEditor Test] Vue应用状态:', {
                        hasApp: !!app,
                        hasComponents: hasComponents,
                        componentCount: componentCount
                    });
                }
            }, 1000);
        });
    </script>
</body>
</html> 







