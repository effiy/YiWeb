<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskPro Enterprise | 世界级专业任务管理系统</title>
    
    <!-- 引入CSS文件 -->
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/views/tasks/index.css">
    <link rel="stylesheet" href="/plugins/searchHeader/index.css">
    <link rel="stylesheet" href="/views/tasks/plugins/kanbanBoard/index.css">
    <link rel="stylesheet" href="/views/tasks/plugins/enhancedGanttChart/index.css">
    <link rel="stylesheet" href="/views/tasks/plugins/calendarView/index.css">
    <link rel="stylesheet" href="/views/tasks/plugins/matrixView/index.css">

    <!-- 引入字体图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- 元信息 -->
    <meta name="description" content="世界级专业任务管理系统，支持敏捷开发、项目管理、团队协作">
    <meta name="keywords" content="任务管理,项目管理,敏捷开发,团队协作,看板,甘特图,专业版">
    <meta name="author" content="TaskPro Enterprise Team">
    

</head>
<body>
    <!-- 全局加载器 -->
    <div id="globalLoader" class="global-loader">
        <div class="loader-content">
            <div class="loader-logo">
                <i class="fas fa-layer-group"></i>
            </div>
            <div class="loader-text">TaskPro Enterprise</div>
            <div class="loader-progress">
                <div class="loader-bar"></div>
            </div>
        </div>
    </div>

    <div id="app">
        <!-- 主要内容区域 -->
        <div class="main-layout">
            <!-- 主内容区 -->
        <main class="main-content" role="main">
                <!-- 高级工具栏 - 重构为与首页header-row一致的布局 -->
                <div class="advanced-toolbar">
                    <div class="toolbar-row">
                        <div class="toolbar-left">
                            <!-- 快速搜索 -->
                            <div class="search-box" role="search" aria-label="任务搜索">
                                <span class="search-logo" aria-hidden="true" @click="goToHome">
                                    <i class="fas fa-brain" aria-label="AI大脑图标"></i>
                                </span>
                                <div class="search-input-wrapper">
                                    <label for="taskSearchInput" class="visually-hidden">任务搜索输入框</label>
                                    <textarea 
                                        id="taskSearchInput" 
                                        v-model="searchQuery"
                                        @input="handleQuickSearch"
                                        placeholder="搜索任务内容，支持标题、描述、输入输出、步骤等..." 
                                        rows="1" 
                                        maxlength="2000"
                                        aria-label="任务搜索输入框"
                                        autocomplete="off"
                                        spellcheck="false"
                                        class="search-input"></textarea>
                                    
                                    <!-- 清除搜索按钮 -->
                                    <div class="search-clear" v-if="searchQuery">
                                        <button 
                                            @click="clearSearch"
                                            class="clear-search-btn"
                                            type="button"
                                            title="清除搜索"
                                            aria-label="清除搜索内容"
                                        >
                                            <i class="fas fa-times" aria-hidden="true"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="toolbar-right">
                          <!-- 创建任务按钮 -->
                          <div class="create-task-section">
                              <button @click="createTask" class="option-btn primary">
                                  <i class="fas fa-plus"></i>
                                  <span>创建任务</span>
                              </button>
                          </div>
                          
                          <!-- 视图选项 -->
                          <div class="view-options">
                              <button @click="toggleFullscreen" class="option-btn">
                                  <i class="fas fa-expand"></i>
                                  <span>全屏</span>
                              </button>
                          </div>
                            <!-- 视图切换 - 重构为与首页cascader一致的交互 -->
                            <div class="view-switcher">
                                <div class="view-cascader">
                                    <button v-for="view in availableViews" :key="view.key"
                                            @click="setCurrentView(view.key)"
                                            :class="['view-btn', { active: currentView === view.key }]"
                                            :title="view.description"
                                            :aria-label="`切换到${view.name}视图`">
                                        <i :class="view.icon" aria-hidden="true"></i>
                                        <span>{{ view.name }}</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 批量操作 -->
                            <div v-if="selectedTasks.length > 0" class="batch-actions">
                                <span class="selected-count">已选择 {{ selectedTasks.length }} 项</span>
                                <button @click="batchUpdateStatus" class="batch-btn" title="批量更新状态">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button @click="batchDelete" class="batch-btn danger" title="批量删除">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            
                            <!-- 下载功能按钮 -->
                            <div class="download-section">
                                <button 
                                    type="button"
                                    class="option-btn"
                                    @click="handleDownloadTasks"
                                    :disabled="loading || !filteredTasks.length"
                                    :title="filteredTasks.length ? `下载 ${filteredTasks.length} 个任务数据` : '没有可下载的任务'">
                                    <i class="fas fa-download" aria-hidden="true"></i>
                                    <span>下载</span>
                                </button>
                            </div>
                            
                            <!-- 下载上传样例按钮 -->
                            <div class="download-sample-section">
                                <button 
                                    type="button"
                                    class="option-btn"
                                    @click="handleDownloadSample"
                                    :disabled="loading"
                                    title="下载上传样例数据，可直接上传使用">
                                    <i class="fas fa-file-code" aria-hidden="true"></i>
                                    <span>样例</span>
                                </button>
                            </div>
                            
                            <!-- 上传功能按钮 -->
                            <div class="upload-section">
                                <button 
                                    type="button"
                                    class="option-btn"
                                    @click="triggerUploadTasks"
                                    :disabled="loading"
                                    title="上传任务数据文件">
                                    <i class="fas fa-upload" aria-hidden="true"></i>
                                    <span>上传</span>
                                </button>
                                <input 
                                    id="tasksUploadInput"
                                    ref="uploadInput"
                                    type="file" 
                                    accept=".zip,.json"
                                    @change="handleUploadTasks"
                                    class="hidden" 
                                    aria-label="上传任务数据文件">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 任务视图内容区 -->
                <div class="content-area">
                    <!-- 任务列表视图 -->
                    <enhanced-task-list
                        v-if="currentView === 'list'"
                        :tasks="filteredTasks"
                        :loading="loading"
                        :error="error"
                        :selected-tasks="selectedTasks"
                        @task-select="handleTaskSelect"
                        @task-click="handleTaskClick"
                        @task-update="handleTaskUpdate"
                        @task-delete="handleTaskDelete"
                        @task-edit="handleTaskEdit"
                        @selection-change="handleSelectionChange"
                    ></enhanced-task-list>
                    
                    <!-- 看板视图 -->
                    <kanban-board
                        v-if="currentView === 'kanban'"
                        :tasks="filteredTasks"
                        @task-move="handleTaskMove"
                        @task-select="handleTaskSelect"
                        @task-create="handleTaskCreate"
                    ></kanban-board>
                    
                    <!-- 甘特图视图 -->
                    <enhanced-gantt-chart
                        v-if="currentView === 'gantt'"
                        :tasks="filteredTasks"
                        @task-update="handleTaskUpdate"
                    ></enhanced-gantt-chart>
                    
                    <!-- 周报视图 -->
                    <weekly-report
                        v-if="currentView === 'weekly'"
                        :tasks="filteredTasks"
                        :current-view="currentView"
                        :get-task-time-data="getTaskTimeData"
                        @task-select="handleTaskSelect"
                    ></weekly-report>
                    
                    <!-- 日报视图 -->
                    <daily-report
                        v-if="currentView === 'daily'"
                        :tasks="filteredTasks"
                        :current-view="currentView"
                        :get-task-time-data="getTaskTimeData"
                        @task-select="handleTaskSelect"
                    ></daily-report>
                    <!-- 矩阵视图 -->
                    <matrix-view
                        v-if="currentView === 'matrix'"
                        :tasks="filteredTasks"
                        @task-select="handleTaskSelect"
                    ></matrix-view>
                </div>
                
                <!-- 任务编辑器 -->
                <task-editor
                    v-if="showTaskEditor"
                    :visible="showTaskEditor"
                    :task="editingTask"
                    @close="closeTaskEditor"
                    @save="handleTaskSave"
                    @refresh-data="loadTasksData"
                ></task-editor>
        </main>
    </div>

        
    </div>

    <!-- 引入Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- 引入任务编辑器组件 -->
    <link rel="stylesheet" href="plugins/taskEditor/index.css">
    
    <!-- 引入工具类（使用ES6模块） -->
    <script type="module" src="/config.js"></script>
    <script src="/utils/index.js"></script>
    <script type="module" src="/utils/log.js"></script>
    <script type="module" src="/utils/baseView.js"></script>
    <script type="module" src="/utils/loading.js"></script>
    <script type="module" src="/utils/message.js"></script>
    
    <!-- 引入API模块（使用ES6模块） -->
    <script type="module" src="/apis/index.js"></script>
    <script type="module" src="/apis/helper/checkStatus.js"></script>
    <script type="module" src="/apis/helper/requestHelper.js"></script>
    <script type="module" src="/apis/modules/crud.js"></script>
    
    <!-- 引入数据（必须在其他脚本之前加载） -->
    <script src="/views/tasks/data/mockData.js"></script>
    
    <!-- 引入hooks逻辑 -->
    <script src="/views/tasks/hooks/store.js"></script>
    <script src="/views/tasks/hooks/useComputed.js"></script>
    <script src="/views/tasks/hooks/useMethods.js"></script>
    
    <!-- 引入新组件（优先兼容现有组件） -->
    <script src="/views/tasks/plugins/enhancedTaskList/index.js"></script>
    <script src="/views/tasks/plugins/kanbanBoard/index.js"></script>
    <script src="/views/tasks/plugins/enhancedGanttChart/index.js"></script>
    <script src="/views/tasks/plugins/taskEditor/index.js"></script>
    <script src="/views/tasks/plugins/matrixView/index.js"></script>
    
    <!-- 兼容现有组件 -->
    <script src="/views/tasks/plugins/taskList/index.js"></script>
    <script src="/views/tasks/plugins/ganttChart/index.js"></script>
    <script src="/views/tasks/plugins/weeklyReport/index.js"></script>
    <script src="/views/tasks/plugins/dailyReport/index.js"></script>
    
    <!-- 引入页面逻辑 -->
    <script src="/views/tasks/index.js"></script>
    
    <!-- 工具函数安全检查脚本 -->
    <script>
        // 确保必要的工具函数存在
        function ensureUtilityFunctions() {
            if (!window.showGlobalLoading) {
                window.showGlobalLoading = function(message) {};
            }
            
            if (!window.hideGlobalLoading) {
                window.hideGlobalLoading = function() {};
            }
            
            if (!window.showSuccess) {
                window.showSuccess = function(message) {};
            }
            
            if (!window.showError) {
                window.showError = function(message) {};
            }
        }
        
        // 在DOM加载完成后检查工具函数
        document.addEventListener('DOMContentLoaded', function() {
            ensureUtilityFunctions();
        });
        
        // 页面加载完成后的处理
        window.addEventListener('load', function() {
            // 隐藏加载器
            setTimeout(() => {
                const loader = document.getElementById('globalLoader');
                if (loader) {
                    loader.classList.add('hidden');
                    setTimeout(() => {
                        loader.style.display = 'none';
                    }, 500);
                }
            }, 1000);
        });
    </script>
    
    <!-- 快捷键支持 -->
    <script>
        // 快捷键支持
        document.addEventListener('keydown', function(e) {
            // 如果当前焦点在输入框或文本区域中，不阻止任何按键
            const activeElement = document.activeElement;
            if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA')) {
                return;
            }
            
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const searchInput = document.querySelector('.global-search-input');
                if (searchInput) {
                    searchInput.focus();
                }
            }
        });
        
        // 禁用右键菜单，增强专业性
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
    </script>
    
    <!-- 组件注册测试脚本 -->
    <script>
        // 在页面加载完成后测试TaskEditor组件
        window.addEventListener('load', function() {
            console.log('[TaskEditor Test] 页面加载完成，开始测试组件...');
            
            // 等待一段时间确保所有脚本加载完成
            setTimeout(function() {
                console.log('[TaskEditor Test] 检查TaskEditor组件状态...');
                
                if (window.TaskEditor) {
                    console.log('[TaskEditor Test] ✅ TaskEditor组件已加载:', {
                        name: window.TaskEditor.name,
                        hasTemplate: !!window.TaskEditor.template,
                        hasProps: !!window.TaskEditor.props,
                        hasMethods: !!window.TaskEditor.methods,
                        hasData: !!window.TaskEditor.data
                    });
                    
                    // 测试组件结构
                    console.log('[TaskEditor Test] 组件结构详情:', {
                        template: window.TaskEditor.template ? '存在' : '不存在',
                        props: window.TaskEditor.props,
                        methods: Object.keys(window.TaskEditor.methods || {}),
                        data: window.TaskEditor.data
                    });
                } else {
                    console.error('[TaskEditor Test] ❌ TaskEditor组件未找到');
                }
                
                // 检查Vue应用状态
                if (window.TaskProApp && window.TaskProApp.app) {
                    console.log('[TaskEditor Test] Vue应用状态:', {
                        hasApp: !!window.TaskProApp.app,
                        components: Object.keys(window.TaskProApp.app._context.components || {})
                    });
                }
            }, 1000);
        });
    </script>
</body>
</html> 




