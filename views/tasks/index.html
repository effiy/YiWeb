<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YiTasks</title>
    
    <!-- ÂºïÂÖ•CSSÊñá‰ª∂ -->
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/views/tasks/index.css">
    <link rel="stylesheet" href="/plugins/searchHeader/index.css">

    <link rel="stylesheet" href="/views/tasks/plugins/calendarView/index.css">

    <link rel="stylesheet" href="/views/tasks/plugins/enhancedTaskList/index.css">
    <link rel="stylesheet" href="/views/tasks/plugins/enhancedTaskList/list-view-bem.css">
    <link rel="stylesheet" href="/views/tasks/plugins/timeSlotTracker/index.css">

    <!-- ÂºïÂÖ•Â≠ó‰ΩìÂõæÊ†á -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- ÂÖÉ‰ø°ÊÅØ -->
    <meta name="description" content="‰∏ñÁïåÁ∫ß‰∏ì‰∏ö‰ªªÂä°ÁÆ°ÁêÜÁ≥ªÁªüÔºåÊîØÊåÅÊïèÊç∑ÂºÄÂèë„ÄÅÈ°πÁõÆÁÆ°ÁêÜ„ÄÅÂõ¢ÈòüÂçè‰Ωú">
    <meta name="keywords" content="‰ªªÂä°ÁÆ°ÁêÜ,È°πÁõÆÁÆ°ÁêÜ,ÊïèÊç∑ÂºÄÂèë,Âõ¢ÈòüÂçè‰Ωú,ÁîòÁâπÂõæ,‰∏ì‰∏öÁâà">
    <meta name="author" content="TaskPro Enterprise Team">
    

</head>
<body>
    

    <div id="app">
        <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
        <div class="main-layout">
            <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
        <main class="main-content" role="main">
                <!-- È´òÁ∫ßÂ∑•ÂÖ∑Ê†è - ÈáçÊûÑ‰∏∫‰∏éÈ¶ñÈ°µheader-row‰∏ÄËá¥ÁöÑÂ∏ÉÂ±Ä -->
                <div class="advanced-toolbar">
                    <div class="toolbar-row">
                        <div class="toolbar-left">
                            <!-- Âø´ÈÄüÊêúÁ¥¢ -->
                            <div class="search-box" role="search" aria-label="‰ªªÂä°ÊêúÁ¥¢">
                                <span class="search-logo" aria-hidden="true" @click="goToHome">
                                    <i class="fas fa-brain" aria-label="AIÂ§ßËÑëÂõæÊ†á"></i>
                                </span>
                                <div class="search-input-wrapper">
                                    <label for="taskSearchInput" class="visually-hidden">‰ªªÂä°ÊêúÁ¥¢ËæìÂÖ•Ê°Ü</label>
                                    <textarea 
                                        id="taskSearchInput" 
                                        v-model="searchQuery"
                                        @input="handleQuickSearch"
                                        placeholder="ÊêúÁ¥¢‰ªªÂä°ÂÜÖÂÆπÔºåÊîØÊåÅÊ†áÈ¢ò„ÄÅÊèèËø∞„ÄÅËæìÂÖ•ËæìÂá∫„ÄÅÊ≠•È™§Á≠â..." 
                                        rows="1" 
                                        maxlength="2000"
                                        aria-label="‰ªªÂä°ÊêúÁ¥¢ËæìÂÖ•Ê°Ü"
                                        autocomplete="off"
                                        spellcheck="false"
                                        class="search-input"></textarea>
                                    
                                    <!-- Ê∏ÖÈô§ÊêúÁ¥¢ÊåâÈíÆ -->
                                    <div class="search-clear" v-if="searchQuery">
                                        <button 
                                            @click="clearSearch"
                                            class="clear-search-btn"
                                            type="button"
                                            title="Ê∏ÖÈô§ÊêúÁ¥¢"
                                            aria-label="Ê∏ÖÈô§ÊêúÁ¥¢ÂÜÖÂÆπ"
                                        >
                                            <i class="fas fa-times" aria-hidden="true"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="toolbar-right">
                            <!-- ËßÜÂõæÂàáÊç¢ - ÈáçÊûÑ‰∏∫‰∏éÈ¶ñÈ°µcascader‰∏ÄËá¥ÁöÑ‰∫§‰∫í -->
                            <div class="view-switcher">
                                <div class="view-cascader">
                                    <button v-for="view in availableViews" :key="view.key"
                                            @click="setCurrentView(view.key)"
                                            :class="['view-btn', { active: currentView === view.key }]"
                                            :title="view.description"
                                            :aria-label="`ÂàáÊç¢Âà∞${view.name}ËßÜÂõæ`">
                                        <i :class="view.icon" aria-hidden="true"></i>
                                        <span>{{ view.name }}</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- ÂØºÂá∫ÊåâÈíÆ -->
                            <div class="export-item">
                                <button 
                                    @click="handleExportAllTasks"
                                    class="export-btn"
                                    type="button"
                                    title="ÂØºÂá∫ÊâÄÊúâ‰ªªÂä°Êï∞ÊçÆ"
                                    aria-label="ÂØºÂá∫ÊâÄÊúâ‰ªªÂä°Êï∞ÊçÆ">
                                    <i class="fas fa-download" aria-hidden="true"></i>
                                    <span>ÂØºÂá∫</span>
                                </button>
                            </div>

                            <!-- Êó∂Èó¥ÊÆµËøΩË∏™ÊåâÈíÆ -->
                            <div class="time-slot-tracker-item">
                                <button 
                                    @click="showTimeSlotSelector"
                                    class="time-slot-tracker-btn"
                                    type="button"
                                    title="Êó∂Èó¥ÊÆµËøΩË∏™"
                                    aria-label="Êó∂Èó¥ÊÆµËøΩË∏™">
                                    <i class="fas fa-clock" aria-hidden="true"></i>
                                    <span>Êó∂Èó¥ÊÆµËøΩË∏™</span>
                                </button>
                            </div>

                            <!-- ÂàõÂª∫‰ªªÂä°ÊåâÈíÆ - ‰∏éÈ¶ñÈ°µ‰øùÊåÅ‰∏ÄËá¥ -->
                            <div class="create-card-item">
                                <button 
                                    @click="createTask"
                                    class="create-card-btn"
                                    type="button"
                                    title="ÂàõÂª∫Êñ∞‰ªªÂä°"
                                    aria-label="ÂàõÂª∫Êñ∞‰ªªÂä°">
                                    <i class="fas fa-plus" aria-hidden="true"></i>
                                    <span>ÂàõÂª∫‰ªªÂä°</span>
                                </button>
                            </div>



                        </div>
                    </div>
                </div>
                
                <!-- ‰ªªÂä°ËßÜÂõæÂÜÖÂÆπÂå∫ -->
                <div class="content-area">
                    <!-- ‰ªªÂä°ÂàóË°®ËßÜÂõæ -->
                    <enhanced-task-list
                        v-if="currentView === 'card' || currentView === 'list'"
                        :tasks="filteredTasks"
                        :loading="loading"
                        :error="error"
                        :view-mode="currentView"
                        @task-click="handleTaskClick"
                        @task-update="handleTaskUpdate"
                        @task-delete="handleTaskDelete"
                        @task-edit="handleTaskEdit"
                        @create-task="createTask"
                        @retry="loadTasksData"
                    ></enhanced-task-list>
                </div>
                
                <!-- ‰ªªÂä°ÁºñËæëÂô® -->
                <task-editor
                    v-if="showTaskEditor"
                    :visible="showTaskEditor"
                    :task="editingTask"
                    @close="closeTaskEditor"
                    @save="handleTaskSave"
                    @refresh-data="loadTasksData"
                ></task-editor>

                <!-- Êó∂Èó¥ÊÆµËøΩË∏™Âô® -->
                <div id="time-slot-tracker" class="time-slot-tracker" v-if="showTimeSlotTracker">
                    <!-- Êó∂Èó¥ÊÆµÂ§¥ÈÉ® -->
                    <div class="time-slot-header">
                        <div class="time-slot-title">
                            <span class="time-slot-icon">{{ currentTimeSlot?.config?.icon || '‚è∞' }}</span>
                            <span>{{ currentTimeSlot?.config?.name || 'Êó∂Èó¥ÊÆµËøΩË∏™' }}</span>
                        </div>
                        <div class="time-slot-status">
                            <div class="status-indicator" :class="{ tracking: isTracking }"></div>
                            <span>{{ isTracking ? 'ËøΩË∏™‰∏≠' : 'ÂæÖÂºÄÂßã' }}</span>
                        </div>
                    </div>

                    <!-- Êó∂Èó¥ÊÆµÊèèËø∞ -->
                    <div class="time-slot-description" v-if="currentTimeSlot?.config?.description">
                        <p style="color: rgba(255, 255, 255, 0.9); margin-bottom: 15px;">
                            {{ currentTimeSlot.config.description }}
                        </p>
                    </div>

                    <!-- ‰ªªÂä°Ê∏ÖÂçï -->
                    <div class="time-slot-tasks" v-if="currentTimeSlot?.config?.tasks">
                        <h4>üìã ‰ªªÂä°Ê∏ÖÂçï</h4>
                        <div class="task-checklist">
                            <div 
                                v-for="(task, index) in currentTimeSlot.config.tasks" 
                                :key="index"
                                class="task-item"
                                @click="toggleTask(index)"
                            >
                                <div class="task-checkbox" :class="{ checked: completedTasks.has(index) }"></div>
                                <span>{{ task }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Êï∞ÊçÆËøΩË∏™ÊåáÊ†á -->
                    <div class="time-slot-metrics" v-if="currentTimeSlot?.config?.trackingMetrics">
                        <h4 class="metrics-title">üìä Êï∞ÊçÆËøΩË∏™</h4>
                        <div class="metrics-grid">
                            <div 
                                v-for="(metric, key) in currentTimeSlot.config.trackingMetrics" 
                                :key="key"
                                class="metric-item"
                            >
                                <label class="metric-label">{{ metric.label }}</label>
                                <div v-if="metric.type === 'rating'" class="rating-input">
                                    <span 
                                        v-for="i in metric.max" 
                                        :key="i"
                                        class="rating-star"
                                        :class="{ active: trackingMetrics[key] >= i }"
                                        @click="updateRating(key, i)"
                                    >
                                        {{ metric.unit }}
                                    </span>
                                </div>
                                <input 
                                    v-else
                                    v-model="trackingMetrics[key]"
                                    :type="metric.type === 'number' ? 'number' : 'text'"
                                    :placeholder="`ËØ∑ËæìÂÖ•${metric.label}`"
                                    class="metric-input"
                                    @input="updateMetric(key, $event.target.value)"
                                />
                            </div>
                        </div>
                    </div>

                    <!-- Êìç‰ΩúÊåâÈíÆ -->
                    <div class="time-slot-actions">
                        <button 
                            v-if="!isTracking" 
                            @click="startTracking" 
                            class="action-btn start-btn"
                        >
                            ‚ñ∂Ô∏è ÂºÄÂßãËøΩË∏™
                        </button>
                        <button 
                            v-if="isTracking" 
                            @click="stopTracking" 
                            class="action-btn stop-btn"
                        >
                            ‚èπÔ∏è ÂÅúÊ≠¢ËøΩË∏™
                        </button>
                        <button 
                            @click="saveTrackingData" 
                            class="action-btn save-btn"
                        >
                            üíæ ‰øùÂ≠òÊï∞ÊçÆ
                        </button>
                        <button 
                            @click="hideTimeSlotTracker" 
                            class="action-btn"
                            style="background: #6c757d; color: white;"
                        >
                            ‚ùå ÂÖ≥Èó≠
                        </button>
                    </div>

                    <!-- ÁªüËÆ°‰ø°ÊÅØ -->
                    <div class="time-slot-stats" v-if="timeSlotStats">
                        <h4 class="stats-title">üìà ÁªüËÆ°‰ø°ÊÅØ</h4>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value">{{ timeSlotStats.totalDays }}</div>
                                <div class="stat-label">ËøΩË∏™Â§©Êï∞</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ timeSlotStats.averageDuration.toFixed(1) }}</div>
                                <div class="stat-label">Âπ≥ÂùáÊó∂Èïø(h)</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ (timeSlotStats.completionRate * 100).toFixed(0) }}%</div>
                                <div class="stat-label">ÂÆåÊàêÁéá</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">{{ timeSlotStats.totalDuration.toFixed(1) }}</div>
                                <div class="stat-label">ÊÄªÊó∂Èïø(h)</div>
                            </div>
                        </div>
                    </div>

                    <!-- ÂéÜÂè≤ËÆ∞ÂΩï -->
                    <div class="time-slot-history" v-if="trackingHistory.length > 0">
                        <h4 class="history-title">üìÖ ÂéÜÂè≤ËÆ∞ÂΩï</h4>
                        <div class="history-list">
                            <div 
                                v-for="(record, index) in trackingHistory" 
                                :key="index"
                                class="history-item"
                            >
                                <span class="history-date">{{ formatDate(record.date) }}</span>
                                <span class="history-duration">{{ record.duration.toFixed(1) }}h</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Êó∂Èó¥ÊÆµÈÄâÊã©Âô® -->
                <div id="time-slot-selector" class="time-slot-selector" v-if="showTimeSlotSelector">
                    <div class="selector-header">
                        <h3>ÈÄâÊã©Ë¶ÅËøΩË∏™ÁöÑÊó∂Èó¥ÊÆµ</h3>
                        <button @click="hideTimeSlotSelector" class="close-btn">√ó</button>
                    </div>
                    <div class="time-slot-options">
                        <div 
                            v-for="(config, timeRange) in getAllTimeSlotConfigs()" 
                            :key="timeRange"
                            class="time-slot-option"
                            @click="selectTimeSlot(timeRange)"
                        >
                            <div class="option-icon">{{ config.icon }}</div>
                            <div class="option-content">
                                <div class="option-title">{{ config.name }}</div>
                                <div class="option-time">{{ timeRange }}</div>
                                <div class="option-description">{{ config.description }}</div>
                            </div>
                        </div>
                    </div>
                </div>
        </main>
    </div>

        
    </div>

    <!-- ÂºïÂÖ•Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- ÂºïÂÖ•JSZipÂ∫ìÁî®‰∫éÂØºÂá∫ÂäüËÉΩ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- ÂºïÂÖ•‰ªªÂä°ÁºñËæëÂô®ÁªÑ‰ª∂ -->
    <link rel="stylesheet" href="plugins/taskEditor/index.css">
    
    <!-- ÂºïÂÖ•Â∑•ÂÖ∑Á±ªÔºà‰ΩøÁî®ES6Ê®°ÂùóÔºâ -->
    <script type="module" src="/config.js"></script>
    <script type="module" src="/utils/index.js"></script>
    <script type="module" src="/utils/log.js"></script>
    <script type="module" src="/utils/baseView.js"></script>
    
    <script type="module" src="/utils/message.js"></script>
    
    <!-- ÂºïÂÖ•APIÊ®°ÂùóÔºà‰ΩøÁî®ES6Ê®°ÂùóÔºâ -->
    <script type="module" src="/apis/index.js"></script>
    <script type="module" src="/apis/helper/checkStatus.js"></script>
    <script type="module" src="/apis/helper/requestHelper.js"></script>
    <script type="module" src="/apis/modules/crud.js"></script>
    
    <!-- ÂºïÂÖ•Êï∞ÊçÆÔºàÂøÖÈ°ªÂú®ÂÖ∂‰ªñËÑöÊú¨‰πãÂâçÂä†ËΩΩÔºâ -->
    <script type="module" src="/views/tasks/data/mockData.js"></script>
    
    <!-- ÂºïÂÖ•hooksÈÄªËæë -->
    <script type="module" src="/views/tasks/hooks/store.js"></script>
    <script type="module" src="/views/tasks/hooks/useComputed.js"></script>
    <script type="module" src="/views/tasks/hooks/useMethods.js"></script>
    
    <!-- ÂºïÂÖ•Êñ∞ÁªÑ‰ª∂Ôºà‰ºòÂÖàÂÖºÂÆπÁé∞ÊúâÁªÑ‰ª∂Ôºâ -->
    <script type="module" src="/views/tasks/plugins/enhancedTaskList/index.js"></script>
    <script type="module" src="/views/tasks/plugins/timeSlotTracker/index.js"></script>

    <script type="module" src="/views/tasks/plugins/taskEditor/index.js"></script>

    
    <!-- ÂÖºÂÆπÁé∞ÊúâÁªÑ‰ª∂ -->
    <script type="module" src="/views/tasks/plugins/taskList/index.js"></script>

    
    <!-- ÂºïÂÖ•È°µÈù¢ÈÄªËæë -->
    <script type="module" src="/views/tasks/index.js"></script>
    
    
    
    <!-- Âø´Êç∑ÈîÆÊîØÊåÅ -->
    <script>
        // Âø´Êç∑ÈîÆÊîØÊåÅ
        document.addEventListener('keydown', function(e) {
            // Â¶ÇÊûúÂΩìÂâçÁÑ¶ÁÇπÂú®ËæìÂÖ•Ê°ÜÊàñÊñáÊú¨Âå∫Âüü‰∏≠Ôºå‰∏çÈòªÊ≠¢‰ªª‰ΩïÊåâÈîÆ
            const activeElement = document.activeElement;
            if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA')) {
                return;
            }
            
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const searchInput = document.querySelector('.global-search-input');
                if (searchInput) {
                    searchInput.focus();
                }
            }
        });
        
        // Á¶ÅÁî®Âè≥ÈîÆËèúÂçïÔºåÂ¢ûÂº∫‰∏ì‰∏öÊÄß
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
    </script>
    
    <!-- ÁªÑ‰ª∂Ê≥®ÂÜåÊµãËØïËÑöÊú¨ -->
    <script>
        // Âú®È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÊµãËØïTaskEditorÁªÑ‰ª∂
        window.addEventListener('load', function() {
            console.log('[TaskEditor Test] È°µÈù¢Âä†ËΩΩÂÆåÊàêÔºåÂºÄÂßãÊµãËØïÁªÑ‰ª∂...');
            
            // Á≠âÂæÖ‰∏ÄÊÆµÊó∂Èó¥Á°Æ‰øùÊâÄÊúâËÑöÊú¨Âä†ËΩΩÂÆåÊàê
            setTimeout(function() {
                console.log('[TaskEditor Test] Ê£ÄÊü•TaskEditorÁªÑ‰ª∂Áä∂ÊÄÅ...');
                
                if (window.TaskEditor) {
                    console.log('[TaskEditor Test] ‚úÖ TaskEditorÁªÑ‰ª∂Â∑≤Âä†ËΩΩ:', {
                        name: window.TaskEditor.name,
                        hasTemplate: !!window.TaskEditor.template,
                        hasProps: !!window.TaskEditor.props,
                        hasMethods: !!window.TaskEditor.methods,
                        hasData: !!window.TaskEditor.data
                    });
                    
                    // ÊµãËØïÁªÑ‰ª∂ÁªìÊûÑ
                    const component = window.TaskEditor;
                    const hasMethods = !!(component.methods && typeof component.methods === 'object');
                    const hasProps = !!(component.props && typeof component.props === 'object');
                    const hasData = !!(component.data && typeof component.data === 'function');
                    
                    console.log('[TaskEditor Test] ÁªÑ‰ª∂ÁªìÊûÑËØ¶ÊÉÖ:', {
                        template: component.template ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®',
                        props: hasProps ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®',
                        methods: hasMethods ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®',
                        data: hasData ? 'Â≠òÂú®' : '‰∏çÂ≠òÂú®'
                    });
                } else {
                    console.error('[TaskEditor Test] ‚ùå TaskEditorÁªÑ‰ª∂Êú™ÊâæÂà∞');
                }
                
                // Ê£ÄÊü•VueÂ∫îÁî®Áä∂ÊÄÅ
                if (window.TaskProApp && window.TaskProApp.app) {
                    const app = window.TaskProApp.app;
                    const hasComponents = !!(app._context && app._context.components);
                    const componentCount = hasComponents ? Object.keys(app._context.components).length : 0;
                    
                    console.log('[TaskEditor Test] VueÂ∫îÁî®Áä∂ÊÄÅ:', {
                        hasApp: !!app,
                        hasComponents: hasComponents,
                        componentCount: componentCount
                    });
                }
            }, 1000);
        });
    </script>
</body>
</html> 








